[{"title":"ä½¿ç”¨ Rust è¯­è¨€ç¼–å†™åŸºäº STM32 çš„æ™ºèƒ½è½¦ç¨‹åº","path":"/2025/11/16/ä½¿ç”¨-Rust-è¯­è¨€ç¼–å†™åŸºäº-STM32-çš„æ™ºèƒ½è½¦ç¨‹åº/","content":"è¿™ç¯‡ Blog å°†ç€é‡ä»‹ç»å¦‚ä½•ä½¿ç”¨ Rust è¯­è¨€å·¥å…·é“¾é…ç½® STM32 åµŒå…¥å¼å¼€å‘ç¯å¢ƒï¼Œå¹¶å°†æŒ‡å¯¼æ‚¨ä½¿ç”¨ Rust ç¼–å†™ä¸€ä¸ªç®€æ˜“çš„ã€åŸºäºç”µç£ä¼ æ„Ÿå™¨å¾ªè¿¹çš„æ™ºèƒ½è½¦ç¨‹åºã€‚ ğŸ’¡ è¿™é‡Œæ‰€ä½¿ç”¨çš„å•ç‰‡æœºèŠ¯ç‰‡ä¸º STM32F103RCT6ã€‚ä¸åŒçš„èŠ¯ç‰‡å¯èƒ½äº§ç”Ÿç»†å¾®ä½†ä¸å¤§çš„å·®åˆ«ã€‚ å®‰è£… Rust STM32 å·¥å…·é“¾è¿™é‡Œé»˜è®¤å·²ç»å®‰è£…å¥½äº†rustup ä¸cargo ç­‰å·¥å…·ï¼Œä»¥åŠ openocdè¿™ä¸€è°ƒè¯•å·¥å…·ã€‚ è¾“å…¥å‘½ä»¤ï¼š # æ³¨æ„ï¼šä¸åŒ STM32 èŠ¯ç‰‡å¯¹åº”çš„ç›®æ ‡å¯èƒ½ä¸åŒã€‚# rustup target add thumbv7em-none-eabihf # STM32F4xx / F7xx / L7xx / ...rustup target add thumbv7m-none-eabi # STM32F1xx / L1xx ğŸ’¡ è¿™é‡Œé™„ä¸Šä¸€å¼  MCU ä¸ä¸åŒ Rust æ„å»ºç›®æ ‡çš„å‚è€ƒè¡¨ã€‚ MCU ç³»åˆ— Rust target STM32F0/L0/G0 thumbv6m-none-eabi STM32F1/L1 thumbv7m-none-eabi STM32F2/F3/F4/F7/L4/H7 thumbv7em-none-eabi æˆ– thumbv7em-none-eabihfï¼ˆç¡¬æµ®ç‚¹ï¼‰ ä¸ºäº†ä½¿å¾— Rust å¯ä»¥æ­£å¸¸å®Œæˆäº¤å‰ç¼–è¯‘ï¼Œæˆ‘ä»¬ä»ç„¶éœ€è¦å®‰è£…äº¤å‰ç¼–è¯‘å·¥å…·é“¾ã€‚ è¾“å…¥å‘½ä»¤ï¼ˆè¿™é‡Œä»¥ Debian ä¸ºä¾‹ï¼‰ï¼š sudo apt install gcc-arm-none-eabi gdb-multiarch ä¸ºäº†ä½¿å¾—æˆ‘ä»¬å¯ä»¥è‡ªåŠ¨åŒ–çƒ§å½•ã€è¿è¡Œã€è°ƒè¯•è¿™ä¸€å…¨è¿‡ç¨‹ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å®‰è£… probe-rs å·¥å…·ã€‚ è¿è¡Œå‘½ä»¤ï¼š cargo install probe-rs ä½¿ç”¨ç®€æ˜“æ¨¡æ¿æ–¹å¼åˆ›å»º STM32 å·¥ç¨‹å…‹éš†æ¨¡æ¿ä»“åº“è¿™é‡Œæœ‰ä¸€ä¸ª Rust çš„ä»“åº“æ¨¡æ¿ï¼Œå°¤å…¶é€‚ç”¨äºåŸºäº VSCode çš„å¼€å‘ã€‚ è¾“å…¥å‘½ä»¤ï¼š git clone https://github.com/redstone6835/example-rust-stm32 ä»¥ä¸‹ä¸ºå™è¿°æ–¹ä¾¿ï¼Œå°†è½¯ä»¶ä»“åº“æ ¹ç›®å½•è§†ä¸º/ ç›®å½•ã€‚ è¿™é‡Œä½¿ç”¨ VSCode å¯ä»¥ç›´æ¥æ‰“å¼€è¿™ä¸ªæ–‡ä»¶å¤¹ã€‚åœ¨æ‰“å¼€æ–‡ä»¶å¤¹ä¹‹å‰ï¼Œè¯·å®‰è£… rust-analyzer ä¸Dependiæ’ä»¶ä»¥ç¡®ä¿æ›´åŠ å®Œç¾çš„ Coding ä½“éªŒã€‚ ğŸ’¡ å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯å…¶ä»–ç¼–è¾‘å™¨ï¼Œç†è®ºä¸Šå¯ä»¥åœ¨é…ç½®å¥½ Rust å¼€å‘ç¯å¢ƒä¹‹åç›´æ¥ä»¥æ‰“å¼€ä»»ä½•ä¸€ä¸ª Rust å·¥ç¨‹çš„å½¢å¼æ‰“å¼€æœ¬æ¨¡æ¿ã€‚ æ³¨æ„ï¼šæœ¬é¡¹ç›®é»˜è®¤ä½¿ç”¨ openocd è¿›è¡Œçƒ§å½•ã€è°ƒè¯•ã€‚ä½¿ç”¨å…¶ä»–æ–¹æ³•çƒ§å½•å¯èƒ½äº§ç”Ÿå…¶ä»–é—®é¢˜ã€‚ å…·ä½“ç»†èŠ‚è¯·å‚è€ƒé¡¹ç›®ä¸­çš„ /.vscode/launch.json ä¸ /.vscode/tasks.jsonã€‚ ä¿®æ”¹æœ‰å…³é…ç½®æ–‡ä»¶æ‰“å¼€ /Cargo.toml ï¼š [package]name = example-rust-stm32version = 0.1.0edition = 2024[dependencies]cortex-m = 0.7cortex-m-rt = 0.7embedded-hal = 1.0.0panic-halt = 1.0.0stm32f1xx-hal = version = 0.11.0, features = [stm32f103, medium] [profile.dev]opt-level = 0debug = truelto = falsecodegen-units = 1strip = false[profile.release]opt-level = zlto = truecodegen-units = 1strip = truedebug = falsepanic = abort å°† package ä¸­çš„ name é¡¹ä¿®æ”¹ä¸ºæœ¬å·¥ç¨‹é¡¹ç›®çš„åç§°ã€‚ [package]name = carversion = 0.1.0edition = 2024[dependencies]cortex-m = 0.7cortex-m-rt = 0.7embedded-hal = 1.0.0panic-halt = 1.0.0stm32f1xx-hal = version = 0.11.0, features = [stm32f103, medium] [profile.dev]opt-level = 0debug = truelto = falsecodegen-units = 1strip = false[profile.release]opt-level = zlto = truecodegen-units = 1strip = truedebug = falsepanic = abort ğŸ’¡ æ³¨æ„ï¼šåœ¨æœ¬æ¬¡ä¿®æ”¹é¡¹ç›®åç§°ä¹‹åï¼Œè¯·åŒæ­¥ä¿®æ”¹é¡¹ç›®æ ¹ç›®å½•æ–‡ä»¶å¤¹çš„åç§°ï¼Œä»¥ç¡®ä¿ VSCode å¯ä»¥æ­£å¸¸æ‰¾åˆ°å¯æ‰§è¡Œæ–‡ä»¶å¹¶æ‰§è¡Œç›¸å…³æ“ä½œï¼Œå¹¶ä¾¿äºç®¡ç†å„ä¸ªä¸åŒé¡¹ç›®ã€‚ ä¿®æ”¹é“¾æ¥è„šæœ¬ä¸ MCU å‹å· ğŸ’¡ æ³¨æ„ï¼šè¿™é‡Œéœ€è¦æå‰è·çŸ¥æ‚¨æ‰€æ­£åœ¨å¼€å‘çš„ MCU çš„å®é™…æƒ…å†µï¼ˆå¦‚ Flash å¤§å°ï¼ŒRAM å¤§å°ç­‰å‚æ•°ï¼‰ï¼Œå¦‚æœæ‚¨å¹¶ä¸çŸ¥æ™“ï¼Œè¯·æŸ¥é˜… STM32 å®˜æ–¹æä¾›çš„ç›¸å…³æ•°æ®æ‰‹å†Œè·çŸ¥æƒ…å†µï¼Œå¦åˆ™å¾ˆå¯èƒ½å¯¼è‡´çƒ§å½•å¤±è´¥ç”šè‡³ç¨‹åºæ— æ³•æ­£å¸¸é€šè¿‡ç¼–è¯‘çš„åæœã€‚ æ‰“å¼€ /memory.x ï¼š /* memory.x */MEMORY FLASH : ORIGIN = 0x08000000, LENGTH = 512K RAM : ORIGIN = 0x20000000, LENGTH = 64K_stack_start = ORIGIN(RAM) + LENGTH(RAM); å°†è¿™é‡Œçš„ FLASH ä¸ RAM çš„ LENGTH æ®µæ”¹ä¸ºç›¸åº” MCU çš„å‚æ•°ï¼Œå¦‚ STM32F103RCT6 : /* memory.x */MEMORY FLASH : ORIGIN = 0x08000000, LENGTH = 256K RAM : ORIGIN = 0x20000000, LENGTH = 48K_stack_start = ORIGIN(RAM) + LENGTH(RAM); æˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨äº† xpack æ–¹å¼è¿›è¡Œè¾…åŠ©ç¼–è¯‘ã€‚ä¿®æ”¹é“¾æ¥è„šæœ¬ä¹‹åï¼Œä»ç„¶éœ€è¦ä¿®æ”¹ xpack çš„ç›¸åº”é…ç½®ã€‚æ‰“å¼€ /xpack/src/main.rs ï¼Œ40 - 43 è¡Œå¤„ï¼š // è¾“å‡ºå ç”¨ç‡// STM32F103ZET6: Flash 512KB, RAM 64KBconst FLASH_TOTAL: f64 = 512.0 * 1024.0;const RAM_TOTAL: f64 = 64.0 * 1024.0; å°†è¿™é‡Œçš„ Flash å’Œ RAM å­—æ®µåŒæ­¥è¿›è¡Œä¿®æ”¹ï¼š // è¾“å‡ºå ç”¨ç‡// STM32F103ZET6: Flash 256KB, RAM 48KBconst FLASH_TOTAL: f64 = 256.0 * 1024.0;const RAM_TOTAL: f64 = 48.0 * 1024.0; ğŸ’¡ å¯é€‰ï¼šä¿®æ”¹è¿è¡Œé…ç½® æ‰“å¼€ /.cargo/config.toml ï¼š [build]target = thumbv7m-none-eabi[target.thumbv7m-none-eabi]runner = probe-rs run --chip STM32F103ZErustflags = [ -C, link-arg=-Tlink.x,] å°†runner å­—æ®µçš„ chip å‚æ•°æ”¹ä¸ºå…·ä½“çš„ MCU å‹å·ã€‚ [build]target = thumbv7m-none-eabi[target.thumbv7m-none-eabi]runner = probe-rs run --chip STM32F103RCrustflags = [ -C, link-arg=-Tlink.x,] Start coding !!!å®Œæˆä¸Šè¿°é…ç½®ä¹‹åï¼Œå¯ä»¥å¼€å§‹æ­£å¼å¼€å‘æ™ºèƒ½è½¦é¡¹ç›®äº†ã€‚æˆ‘ä»¬é¦–å…ˆç ”ç©¶ä¸€ä¸‹ MCU å„å¼•è„šçš„ç”¨æ³•ã€‚ å¼•è„šå®šä¹‰ å¼•è„š å¤ç”¨å¤–è®¾åŠŸèƒ½ ç¨‹åºä¸­çš„ç”¨é€” PA4 ADC1_CH4 å³ä¾§ç”µæ„Ÿ ADC é‡‡æ · PC5 ADC1_CH15 å·¦ä¾§ç”µæ„Ÿ ADC é‡‡æ · PA8 GPIO æ‹¨ç å¼€å…³ 1 PC9 GPIO æ‹¨ç å¼€å…³ 2 PC8 GPIO æ‹¨ç å¼€å…³ 3 PC7 GPIO æ‹¨ç å¼€å…³ 4 PA11 GPIO LED1 PA15 GPIO LED2 PC12 GPIO LED3 PB3 GPIO LED4 PA12 GPIO æ€»ä½¿èƒ½å¼€å…³ï¼ˆEnableï¼‰è¾“å…¥ PC13 GPIO ä½¿èƒ½è¾“å‡ºè‡³é©±åŠ¨æ¿ PB0 TIM3_CH3 èˆµæœº PWM è¾“å‡º PB8 GPIO å·¦è½®æ§åˆ¶æ¨æŒ½è¾“å‡º PB9 GPIO å³è½®æ§åˆ¶æ¨æŒ½è¾“å‡º PB6 TIM4_CH1 å·¦è½® PWM è¾“å‡º PB7 TIM4_CH2 å³è½® PWM è¾“å‡º PA9 USART1_TX è°ƒè¯•ç”¨ä¸²å£ PA10 USART1_RX è°ƒè¯•ç”¨ä¸²å£ æ¨¡æ¿åŸç”Ÿä»£ç åŠç›¸å…³å¥æŸ„çš„æ„ä¹‰æ‰“å¼€ /src/main.rs ï¼š #![no_std]#![no_main]use cortex_m_rt::entry;use panic_halt as _;use stm32f1xx_hal::pac, prelude::*;#[entry]fn main() - ! // è·å–å¤–è®¾è®¿é—®æ¥å£ let dp = pac::Peripherals::take().unwrap(); let cp = cortex_m::Peripherals::take().unwrap(); // é…ç½®æ—¶é’Ÿ let mut rcc = dp.RCC.constrain(); let mut delay = cp.SYST.delay(rcc.clocks); // GPIOB æ—¶é’Ÿå¼€å¯ let mut gpiob = dp.GPIOB.split(mut rcc); // PB5 è¿æ¥æ¿è½½ LED let mut led = gpiob.pb5.into_push_pull_output(mut gpiob.crl); loop led.toggle(); // ç¿»è½¬ç”µå¹³ delay.delay_ms(1000_u32); è¿™é‡Œç¨‹åºå®šä¹‰äº† PB5 å¼•è„šçš„å¤ç”¨ï¼ˆæ¨æŒ½è¾“å‡ºï¼‰ï¼Œå¹¶ç”¨ PB5 æ¥æ§åˆ¶ä¸€ä¸ª LED çš„é—ªçƒï¼Œæ¯æ¬¡çŠ¶æ€æŒç»­ 1s ä¹‹åç¿»è½¬ç”µå¹³çŠ¶æ€ã€‚ ğŸ’¡ ç›¸åº”å¥æŸ„çš„æ„ä¹‰ å¥æŸ„ æŠ½è±¡å±‚ å«ä¹‰ dp PAC æ‹¿åˆ°æ‰€æœ‰ç¡¬ä»¶å¯„å­˜å™¨çš„æ‰€æœ‰æƒï¼ˆå¤–è®¾çº§ï¼‰ cp æ ¸å¿ƒ PAC æ‹¿åˆ° Cortex-M å†…æ ¸å¤–è®¾ï¼ˆSysTickã€NVICï¼‰ rcc HAL å°†ä¸å®‰å…¨çš„ RCC å˜æˆæ˜“ç”¨çš„æ—¶é’Ÿé…ç½®å¯¹è±¡ delay HAL ä½¿ç”¨ SysTick ç”Ÿæˆå»¶æ—¶åŠŸèƒ½ ğŸ’¡ ä¸‹æ–‡ä¸­ï¼Œè‹¥æœªæ˜ç¡®æŒ‡å®šï¼Œé»˜è®¤å°†æåŠ Rust ä»£ç è§†ä½œ /src/main.rs çš„ä¸€éƒ¨åˆ†ã€‚ é…ç½® GPIO å¤ç”¨å¹¶ç¦ç”¨ JTAGç„¶è€Œæˆ‘ä»¬çš„ç¨‹åºè§„æ¨¡ç›¸è¾ƒäºç®€å•çš„ LED é—ªçƒç¨‹åºè¦å¤§å¤šäº†ï¼Œä¸€ä¸ª GPIOB é€šé“å®Œå…¨æ— æ³•æ»¡è¶³ï¼Œæˆ‘ä»¬éœ€è¦å¼€è¾Ÿæ›´å¤šé€šé“ï¼š let mut gpioa = dp.GPIOA.split(mut rcc);let mut gpiob = dp.GPIOB.split(mut rcc);let mut gpioc = dp.GPIOC.split(mut rcc); è¿™é‡Œä¼ å…¥rcc ä½œä¸ºå‚æ•°ï¼Œé¿å…äº†å¦‚åŒåœ¨ C è¯­è¨€çš„ STM32 å¼€å‘ä¸­ä»ç„¶éœ€è¦å•ç‹¬å¯ç”¨ GPIO æ—¶é’Ÿï¼Œå¤§å¹…æé«˜äº†ä»£ç å¯è¯»æ€§ã€‚ åŒæ—¶ï¼Œæˆ‘ä»¬æ³¨æ„åˆ°ï¼ŒPA15 ä¸ PB3 ä¸¤ä¸ªå¼•è„šé»˜è®¤è¢«å¤ç”¨ä¸ºäº† JTAG è°ƒè¯•ï¼Œæˆ‘ä»¬æ— æ³•ç›´æ¥å°†å…¶å¤ç”¨ä¸ºæ¨æŒ½è¾“å‡ºï¼Œéœ€è¦ç¦ç”¨ JTAG è°ƒè¯•ï¼Œé‡Šæ”¾è¿™ä¸¤ä¸ªå¼•è„šï¼Œæ‰èƒ½å¤Ÿå°†å…¶ç‰©ç†å¼•è„šæ­£å¸¸å¤ç”¨ã€‚è¿™é‡Œè¿˜éœ€è¦å¼•å…¥ä¸€ä¸ªæ–°çš„æŠ½è±¡å±‚ï¼š let mut afio = dp.AFIO.constrain(mut rcc); ğŸ’¡ afio å¥æŸ„æä¾›äº†é‡æ˜ å°„ã€JTAG é…ç½®ç­‰å®‰å…¨ APIã€‚ è¿™é‡Œå°±å¯ä»¥å°†ä¸¤ä¸ªæˆ‘ä»¬æ‰€éœ€è¦çš„ JTAG å¼•è„šæ­£å¸¸é‡Šæ”¾ï¼Œå¹¶è·å¾—ç›¸åº”å¥æŸ„ï¼š let (pa15_released, pb3_released, _) = afio.mapr.disable_jtag(gpioa.pa15, gpiob.pb3, gpiob.pb4); é…ç½®åŸºæœ¬è¾“å…¥è¾“å‡ºæ ¹æ®ä¸»æ¿çš„è®¾è®¡ï¼Œæ‹¨ç å¼€å…³å„ä¸ªå¼€å…³ä¸ä½¿èƒ½å¼€å…³å½“å¤„äºä½ç”µå¹³æ—¶è§†ä¸ºæ‰“å¼€ï¼Œå¤„äºé«˜ç”µå¹³æ—¶è§†ä¸ºå…³é—­ï¼Œå› æ­¤æˆ‘ä»¬å°†è¿™å‡ ä¸ªå¼•è„šé…ç½®ä¸ºä¸Šæ‹‰è¾“å…¥ã€‚å››ä¸ª LED ç¯ä¸ä½¿èƒ½è¾“å‡ºå¯ä»¥ä½¿ç”¨æ¨æŒ½è¾“å‡ºè¿›è¡Œæ§åˆ¶ã€‚ let switch1 = gpioa.pa8.into_pull_up_input(mut gpioa.crh);let switch2 = gpioc.pc9.into_pull_up_input(mut gpioc.crh);let switch3 = gpioc.pc8.into_pull_up_input(mut gpioc.crh);let switch4 = gpioc.pc7.into_pull_up_input(mut gpioc.crl);let mut led1_pa11 = gpioa.pa11.into_push_pull_output(mut gpioa.crh);let mut led2_pa15 = pa15_released.into_push_pull_output(mut gpioa.crh);let mut led3_pc12 = gpioc.pc12.into_push_pull_output(mut gpioc.crh);let mut led4_pb3 = pb3_released.into_push_pull_output(mut gpiob.crl);let enable_switch_pa12 = gpioa.pa12.into_pull_up_input(mut gpioa.crh);let mut enable_out_pc13 = gpioc.pc13.into_push_pull_output(mut gpioc.crh); è¿™é‡Œ mut gpioa.crh ç­‰ç±»ä¼¼å­—æ®µå¯æ ¹æ®å¼•è„šæ‰€åœ¨é¢‘é“ä¸ç¼–å·æ˜¯å¦ä¸ºé«˜å…«ä½æˆ–ä½å…«ä½è·çŸ¥ã€‚å¦‚ pa8 ä½äº gpioa é€šé“çš„é«˜å…«ä½ï¼ˆ8 - 15ä½è§†ä¸ºé«˜å…«ä½ï¼Œ0 - 7ä½è§†ä¸ºä½å…«ä½ï¼‰ï¼Œåˆ™ä¼ å…¥ mut gpioa.crh ï¼Œè‹¥ä½äºä½å…«ä½ï¼ˆå¦‚ pc7ï¼‰ï¼Œåˆ™ä¼ å…¥ mut gpioc.crl ã€‚ ğŸ’¡ æ³¨æ„ï¼šè¿™é‡Œ pa15 ä¸pb3 å¥æŸ„çš„è·å–éœ€è¦é€šè¿‡ä¹‹å‰è·å–çš„ pa15_released ä¸pb3_released å¥æŸ„è¿›è¡Œå®ç°ã€‚å¦‚pb3ï¼Œè‹¥ä½¿ç”¨ gpioa.pb3 ç­‰åŸç”Ÿå¥æŸ„ï¼Œç”±äºå…¶ç±»å‹ä¸ºPinB, 3, Debugger ï¼Œè€Œéæˆ‘ä»¬æ‰€é¢„æœŸçš„ PinB, 3, InputFloating ï¼Œå…¶ä¸å…·æœ‰ into_push_pull_output æ–¹æ³•ï¼Œæ— æ³•æˆåŠŸè·å– led4_pb3 å¥æŸ„ã€‚è€Œ pb3_released å¥æŸ„çš„ç±»å‹ä¸ºPinB, 3 ï¼Œæ˜¯é€šè¿‡ JTAG çš„é‡Šæ”¾æ‰€è·å–çš„æ–°å¥æŸ„ï¼Œå…·æœ‰è¯¥æ–¹æ³•ï¼Œå› æ­¤å¯ä»¥æˆåŠŸè·å–led4_pb3å¥æŸ„ã€‚ é…ç½® ADC é¢‘é“å¥æŸ„ä¸ºäº†è·å– PA4 å’Œ PC5 è¾“å…¥è¿›æ¥çš„ä¼ æ„Ÿå™¨ä¿¡æ¯ï¼Œæˆ‘ä»¬éœ€è¦æå‰é…ç½® ADC1 é€šé“çš„å¥æŸ„ï¼Œå¹¶å°† PA4 å’Œ PC5 é…ç½®ä¸ºæ¨¡æ‹Ÿä¿¡å·è¾“å…¥ã€‚ let mut adc1 = adc::Adc::new(dp.ADC1, mut rcc);let mut adc1_ch4_pa4 = gpioa.pa4.into_analog(mut gpioa.crl);let mut adc1_ch15_pc5 = gpioc.pc5.into_analog(mut gpioc.crl); æˆ‘ä»¬å¯ä»¥ä½¿ç”¨adc1.read(mut adc1_ch4_pa4).unwrap() çš„æ–¹å¼è¯»å– ADC é‡‡é›†è·å–çš„å€¼ï¼Œå¹¶ç”±è¿™ä¸ªå€¼æ¨ç†å¾—åˆ°è½¬å‘ç­–ç•¥ã€‚ é…ç½®èˆµæœº PWM è¾“å‡ºåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é¦–å…ˆå®šä¹‰æŸä¸€ PWM ä¸­å€¼ï¼Œä½¿å¾—èˆµæœºæ¥å—åˆ°è¯¥å ç©ºæ¯”çš„ PWM æ³¢æ—¶ï¼Œèˆµæœºè§’åº¦èƒ½å¤Ÿåˆšå¥½æœå‘æ­£å‰æ–¹ã€‚ä½†æ˜¯ä¸ºäº†é€‚åº” C è¯­è¨€çš„æŸä¸ªä¾‹ç¨‹ï¼Œè¿™é‡Œä½¿ç”¨çš„æ˜¯è®¤ä¸ºå ç©ºæ¯”æœ€å¤§å€¼ä¸º 9999 æ—¶çš„å ç©ºæ¯”è®¾ç½®ï¼Œæˆ‘ä»¬æš‚ä¸”ç§°å…¶ä¸ºç­‰æ•ˆå ç©ºæ¯”ã€‚ let steer_pwm_duty_center: u16 = 750 - 5; // èˆµæœº PWM ä¸­å€¼let steer_pwm_duty_max = steer_pwm_duty_center + 60; // èˆµæœº PWM æœ€å¤§å€¼let steer_pwm_duty_min = steer_pwm_duty_center - 60; // èˆµæœº PWM æœ€å°å€¼ åŒæ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°† PB0 é…ç½®ä¸ºå¤ç”¨æ¨æŒ½è¾“å‡ºï¼Œå¹¶é…ç½®ç›¸åº” PWM é¢‘é“ã€‚è¿™é‡Œæ˜¯ TIM3ã€‚ // å°† PB0 é…ç½®ä¸º TIM3_CH3 å¤ç”¨æ¨æŒ½è¾“å‡ºlet tim3_ch3 = gpiob.pb0.into_alternate_push_pull(mut gpiob.crl);// é…ç½® TIM3 ä¸º PWM è¾“å‡ºï¼Œé¢‘ç‡ 1kHzlet mut steer_pwm = dp.TIM3.pwm_hz::Tim3NoRemap, _, _( tim3_ch3, mut afio.mapr, 1.kHz(), mut rcc);// è®¾ç½®å ç©ºæ¯”ä¸º èˆµæœº PWM ä¸­å€¼steer_pwm.set_duty(Channel::C3, (steer_pwm_duty_center / 9999) * steer_pwm.get_max_duty());// ä½¿èƒ½èˆµæœº PWM è¾“å‡ºsteer_pwm.enable(Channel::C3); è¿™é‡Œï¼Œæˆ‘ä»¬æŒ‡å®š TIM3 é¢‘é“çš„é¢‘ç‡ä¸º 1kHzï¼Œå¹¶é€šè¿‡ç­‰æ•ˆå ç©ºæ¯”å°†å ç©ºæ¯”è®¾ç½®ä¸ºçœŸæ­£çš„ä¸­å€¼ã€‚ é…ç½®å·¦å³è½®æ§åˆ¶æµè¾“å‡ºå› ä¸ºå·¦å³è½®çš„é€Ÿåº¦æ§åˆ¶æ˜¯ PWM æ§åˆ¶çš„ï¼Œå› æ­¤æˆ‘ä»¬å®Œå…¨å¯ä»¥ä½¿ç”¨åŒæ ·çš„ä¸€ç§æ–¹å¼æ¥é…ç½®ç›¸åº”çš„å¥æŸ„ã€‚è€Œä¸åŒçš„æ˜¯ï¼Œå·¦å³è½®çš„è½¬å‘æ§åˆ¶æ˜¯é€šè¿‡ç»™é«˜ç”µå¹³æˆ–ä½ç”µå¹³å®ç°çš„ï¼Œå› æ­¤æˆ‘ä»¬è¿˜éœ€è¦é…ç½®ä¸¤ä¸ªæ¨æŒ½è¾“å‡ºçš„å¼•è„šè¿›è¡Œè½¬å‘çš„æ§åˆ¶ã€‚ let mut left_wheel_pb8 = gpiob.pb8.into_push_pull_output(mut gpiob.crh);let mut right_wheel_pb9 = gpiob.pb9.into_push_pull_output(mut gpiob.crh);let tim4_ch1 = gpiob.pb6.into_alternate_push_pull(mut gpiob.crl);let tim4_ch2 = gpiob.pb7.into_alternate_push_pull(mut gpiob.crl);let mut wheels_pwm = dp.TIM4.pwm_hz::Tim4NoRemap, _, _( (tim4_ch1, tim4_ch2), mut afio.mapr, 1.kHz(), mut rcc);wheels_pwm.set_duty(Channel::C2, 0);wheels_pwm.set_duty(Channel::C1, 0);wheels_pwm.enable(Channel::C2);wheels_pwm.enable(Channel::C1); é…ç½®è°ƒè¯•ä¿¡æ¯è¾“å‡ºåœ¨æ¯”èµ›çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦éœ€è¦è·çŸ¥ä¸€ä¸ªç‚¹å¤„å…·ä½“çš„ä¼ æ„Ÿå™¨è¾“å‡ºï¼Œä»è€Œå¯¹è½¦æœ¬èº«è¿›è¡Œç¡¬ä»¶æ–¹é¢çš„è°ƒè¯•ã€‚ä¸ºäº†å‡†ç¡®è·çŸ¥è½¯ä»¶æ–¹é¢çš„ä¼ æ„Ÿå™¨å€¼ï¼Œæˆ‘ä»¬é€šå¸¸ä½¿ç”¨ä¸²å£æ¥ç›´æ¥è¯»å–ã€‚è¿™é‡Œé…ç½®äº† USART1 ä¸²å£ï¼Œå®æ—¶å‘é€è¿™äº›ä¿¡æ¯ï¼Œä»¥ä¾¿æˆ‘ä»¬è¿›è¡Œè°ƒè¯•ã€‚ let usart1_tx = gpioa.pa9.into_alternate_push_pull(mut gpioa.crh);let usart1_rx = gpioa.pa10;let mut serial = dp.USART1 .serial( (usart1_tx, usart1_rx), Config::default().baudrate(115200.bps()), mut rcc ); ğŸ’¡ è¿™é‡Œä½¿ç”¨äº† VOFA+ çš„ JustFloat åè®®è¿›è¡Œå‘é€ã€‚VOFA+ æ˜¯ä¸€ä¸ªå¼ºå¤§çš„ä¸Šä½æœºè½¯ä»¶ã€‚ è¿›å…¥ä¸»å¾ªç¯Rust STM32 ç¨‹åºçš„ä¸»å¾ªç¯é€šå¸¸ä½¿ç”¨ loop æ­»å¾ªç¯ï¼Œå½¢å¦‚ï¼š loop // ä»£ç ... å¤„ç†ä¼ æ„Ÿå™¨è¾“å‡ºæ—¶é‡åˆ°çš„å›°éš¾æˆ‘ä»¬å¯ä»¥ä½¿ç”¨è¿™æ ·çš„ä»£ç è¯»å–ä¼ æ„Ÿå™¨çš„è¾“å‡ºï¼Œå¹¶è¿›è¡Œç›¸å…³çš„è¿ç®—ï¼š let adc_value_right = adc1.read(mut adc1_ch4_pa4).unwrap();let adc_value_left = adc1.read(mut adc1_ch15_pc5).unwrap(); ä½†æ˜¯ï¼Œåœ¨å®é™…çš„æ“ä½œä¸­ï¼Œæˆ‘ä»¬å‘ç°ï¼šè¿™æ ·ç›´æ¥è¯»å–å‡ºæ¥çš„ ADC å€¼å­˜åœ¨ç€é«˜è¾¾ 100 çš„å™ªå£°ã€‚ä¸ºäº†æ¶ˆé™¤å™ªå£°å¸¦æ¥çš„å½±å“ï¼Œæˆ‘ä»¬å¿…é¡»å¯¹æ•°æ®è¿›è¡Œåˆ†æï¼Œå°½å¯èƒ½é™ä½è¯¯å·®ã€‚ ä¸€ç§åŸºäºæ­£æ€åˆ†å¸ƒæ‹Ÿåˆçš„æ»¤æ³¢ç®—æ³• gauss_filteræˆ‘ä»¬é¦–å…ˆè€ƒè™‘å®ç°å¿«é€Ÿæ’åºç®—æ³•ï¼Œå¯¹æŸä¸€ç›®æ ‡æ•°ç»„è¿›è¡Œæ’åºã€‚ åˆ›å»ºå¹¶æ‰“å¼€/src/utils.rs ï¼š #[inline(always)]pub fn quicksort(arr: mut [i32]) let len = arr.len(); if len = 1 return; let pivot = arr[len - 1]; let mut i = 0; for j in 0..len - 1 if arr[j] = pivot arr.swap(i, j); i += 1; arr.swap(i, len - 1); if i 0 quicksort(mut arr[0..i]); if i + 1 len quicksort(mut arr[i+1..]); å…³äºå¿«é€Ÿæ’åºç®—æ³•çš„åŸç†ï¼Œè¿™é‡Œä¸è¿‡å¤šèµ˜è¿°ã€‚ æˆ‘ä»¬è€ƒè™‘ä½¿ç”¨ä¸€ç»„æµ‹å¾—çš„æ•°æ®è¿›è¡Œæ­£æ€åˆ†å¸ƒæ›²çº¿çš„æ‹Ÿåˆï¼Œå°†eçš„æŒ‡æ•°è§†ä¸ºå„ä¸ªæ•°æ®çš„æƒé‡ï¼Œè®¡ç®—å‡ºåŠ æƒå‡å€¼ï¼Œä»¥è¯¥å€¼ä½œä¸ºçœŸå®å€¼çš„é¢„ä¼°ã€‚ ä¸ºäº†èƒ½å¤Ÿè¿›è¡Œæ­£æ€åˆ†å¸ƒæ›²çº¿çš„æ‹Ÿåˆï¼Œæˆ‘ä»¬å¿…é¡»å¼•å…¥ä¸€ä¸ªæ•°å­¦å‡½æ•°åº“ã€‚åœ¨åµŒå…¥å¼å¹³å°ï¼Œlibm æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚æ‰“å¼€/Cargo.toml ï¼Œåœ¨dependencies ä¸­å†™å…¥ï¼š libm = 0.2.15â€ åˆ›å»ºå¹¶æ‰“å¼€ /src/gauss.rs ï¼š use crate::utils::quicksort;pub fn gauss_filter(x: [i32], n: usize) - f64 if n = 0 return 0.0; if n == 1 return x[0] as f64; // åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ•°ç»„æ¥å­˜å‚¨æ’åºåçš„æ•°æ® let mut sorted = [0i32; 64]; // å‡è®¾æœ€å¤§é•¿åº¦ä¸º64ï¼Œæ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´ for i in 0..n sorted[i] = x[i]; quicksort(mut sorted[0..n]); // --- åˆå§‹ä¼°è®¡ --- let mut sum: f64 = 0.0; for i in 0..n sum += sorted[i] as f64; let mut mu = sum / (n as f64); let mut var: f64 = 0.0; for i in 0..n let diff = sorted[i] as f64 - mu; var += diff * diff; var /= (n - 1) as f64; let mut sigma: f64 = libm::sqrt(var); if sigma 1e-6 sigma = 1e-6; // --- è¿­ä»£æ›´æ–° --- let max_iter = 30; let tol = 1e-6; for _iter in 0..max_iter let mut sum_w: f64 = 0.0; let mut sum_wx: f64 = 0.0; for i in 0..n let diff: f64 = (sorted[i] as f64 - mu) / sigma; let exponent: f64 = -0.5 * diff * diff; let mut weight = libm::exp(exponent); if weight 1e-10 weight = 1e-10; sum_w += weight; sum_wx += weight * sorted[i] as f64; let new_mu = sum_wx / sum_w; if libm::fabs(new_mu - mu) tol mu = new_mu; break; mu = new_mu; // æ›´æ–° sigma let mut sum_var = 0.0; let mut sum_var_w = 0.0; for i in 0..n let diff = sorted[i] as f64 - mu; let exponent = -0.5 * (diff / sigma) * (diff / sigma); let mut weight = libm::exp(exponent); if weight 1e-10 weight = 1e-10; sum_var += weight * diff * diff; sum_var_w += weight; sigma = libm::sqrt(sum_var / sum_var_w); if sigma 1e-6 sigma = 1e-6; return mu; ç†è®ºä¸Šè®¤ä¸ºï¼Œæˆ‘ä»¬åªè¦æœ‰äº†ä¸€ç»„åŠæ—¶æµ‹å¾—çš„ ADC å€¼æ•°æ®ï¼Œé€šè¿‡è¯¥æ»¤æ³¢ç®—æ³•ï¼Œå¯ä»¥è·å–ä¸€ä¸ªç›¸è¾ƒäºç›´æ¥è®¡ç®—å‡å€¼æ›´åŠ æ¥è¿‘çœŸå®å€¼çš„ä¼°è®¡å€¼ã€‚ å¤„ç†ä¼ æ„Ÿå™¨æ•°æ®å¹¶æ§åˆ¶è½¬å‘ä¸ºäº†æŒç»­åŒ–å­˜å‚¨æ¯æ¬¡ä¼ æ„Ÿå™¨è¯»å–çš„æ•°æ®ï¼Œåœ¨æ•´ä¸ªä¸»å¾ªç¯å‰é¢ï¼Œæˆ‘ä»¬åŠ å…¥ï¼š let mut adc_value_right_buffer = [0_i32; 33];let mut adc_value_left_buffer = [0_i32; 33]; ä½œä¸ºä¼ æ„Ÿå™¨å€¼çš„ç¼“å†²åŒºã€‚ä¸ºäº†èƒ½å¤ŸçœŸæ­£åšåˆ°åŠæ—¶è¯»å–æ•°æ®ï¼Œæˆ‘ä»¬åœ¨ä¸»å¾ªç¯ä¸­å†åŠ å…¥ä¸€ä¸ªå¾ªç¯ï¼Œä½¿å¾—åœ¨ä¸»å¾ªç¯çš„ä¸€æ¬¡å¾ªç¯ä¹‹ä¸‹ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥è·çŸ¥æœ€æ–°çš„æ•°æ®ã€‚ for i in (1..33).rev() let adc_value_right = adc1.read(mut adc1_ch4_pa4).unwrap(); let adc_value_left = adc1.read(mut adc1_ch15_pc5).unwrap(); adc_value_right_buffer[i] = adc_value_right; adc_value_left_buffer[i] = adc_value_left; send_adc(mut serial, adc_value_right as f64, adc_value_left as f64); delay.delay_us(33_u32);// è®¡ç®—é«˜æ–¯æ»¤æ³¢åçš„å€¼let filtered_right = gauss::gauss_filter(adc_value_right_buffer, 16);let filtered_left = gauss::gauss_filter(adc_value_left_buffer, 16); è¿™é‡Œçš„ send_adc å‡½æ•°ï¼Œæˆ‘ä»¬åœ¨/src/utils.rs ä¸­ç»™å‡ºäº†å®šä¹‰ï¼š pub fn send_adcW(serial : mut W, adc_right : f64, adc_left : f64)where W: _embedded_hal_serial_Writeu8 + core::fmt::Write let tail : [u8; 4] = [0x00, 0x00, 0x80, 0x7f]; for byte in adc_left.to_le_bytes().iter() serial.write(*byte).ok(); for byte in adc_right.to_le_bytes().iter() serial.write(*byte).ok(); for byte in tail.iter() serial.write(*byte).ok(); ç”¨äºå‘è°ƒè¯•ä¸²å£å‘é€æ¯ä¸€æ¬¡è¯»å–çš„ ADC å€¼æ•°æ®ï¼Œä»¥ä¾¿è°ƒè¯•ã€‚ é€šè¿‡å®é™…æµ‹è¯•ï¼Œæˆ‘ä»¬å‘ç°ï¼šç”µæ„Ÿè·ç¦»èµ›é“ä¸­å¿ƒè¶Šè¿‘ï¼ŒADC å€¼è¶Šå¤§ï¼Œåä¹‹è¶Šå°ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å·¦å³ ADC å€¼çš„å·®å€¼æ¥è¿‘ä¼¼æè¿°å°è½¦ç›¸å¯¹äºèµ›é“çš„åè½¬ç¨‹åº¦ï¼Œå†åˆ©ç”¨è¿™ä¸ª ADC å€¼å¯¹èˆµæœºçš„ç›¸å¯¹ä¸­å€¼å–ä¸€ä¸ªç‰¹æ®Šçš„åå·®ï¼Œä»è€Œå®ç°å°è½¦çš„æ•´ä½“è½¬å‘ã€‚ let diff = (filtered_right - filtered_left) as i32;let steer_pwm_diff = data_limit(diff as f64 * 0.3, steer_pwm_duty_min as f64, steer_pwm_duty_max as f64) as u16;let steer_pwm_duty = steer_pwm_duty_center - steer_pwm_diff; // è®¾ç½®èˆµæœº PWM å ç©ºæ¯”steer_pwm.set_duty(Channel::C3, (steer_pwm_duty / 9999) * steer_pwm.get_max_duty()); å…¶ä¸­ï¼Œdata_limit å‡½æ•°ç”¨äºå°†ä¸€ä¸ªå€¼é™å®šäºæŸä¸¤ä¸ªå€¼ä¹‹é—´ã€‚å…¶åœ¨/src/utils.rs ä¸­å®šä¹‰ä¸ºï¼š pub fn data_limit(x: f64, min: f64, max: f64) - f64 if x min min else if x max max else x æ§åˆ¶å·¦å³è½®çš„è½¬é€Ÿåœ¨æˆ‘ä»¬çš„åŸºæœ¬è®¾è®¡ä¸­ï¼Œä½¿èƒ½å¼€å…³ç”¨äºæ§åˆ¶å·¦å³è½®æ˜¯å¦è½¬åŠ¨ã€‚æˆ‘ä»¬è¯•å›¾å»ºç«‹ä¸€ä¸ªæ–°çš„â€œç›¸å¯¹è½¬é€Ÿâ€ï¼Œä½¿å¾—å·¦å³è½®çš„é€Ÿåº¦èƒ½å¤Ÿä»¥ä¸€ç§ç›´è§‚çš„æ•°å­—è¢«æè¿°å‡ºæ¥ï¼Œä¸ºæ­£æ—¶åˆ™æ­£è½¬ï¼Œåä¹‹åˆ™åè½¬ï¼Œä¸”è¿™ä¸ªæ•°å­—ä¸è¾“å‡ºçš„ PWM å€¼å¯ä»¥ä¸€ä¸€å¯¹åº”ã€‚æˆ‘ä»¬ä»¤ç›¸å¯¹è½¬é€Ÿçš„ç»å¯¹å€¼çš„æœ€å¤§å€¼ä¸º 4800ï¼Œè¡¨ç¤ºæœ€å¤§è½¬é€Ÿï¼›0 åˆ™è¡¨ç¤ºåœè½¬ã€‚å½“ä½¿èƒ½å¼€å…³æ‰“åˆ°äº†é«˜ç”µå¹³æ—¶ï¼Œæˆ‘ä»¬è®¤ä¸ºå°è½¦å¼€æœºï¼Œè½®å­åº”å½“è½¬èµ·æ¥ï¼›åä¹‹å°è½¦å…³æœºï¼Œè½®å­åœè½¬ã€‚ let mut wheel_speed_left = 0;let mut wheel_speed_right = 0;// æ ¹æ®ä½¿èƒ½å¼€å…³çŠ¶æ€æ§åˆ¶è¾“å‡ºif enable_switch_pa12.is_high() wheel_speed_left = 800; wheel_speed_right = 800; enable_out_pc13.set_high(); else enable_out_pc13.set_low(); ä¸”æˆ‘ä»¬å‘ç°ï¼Œä¸¤è½®çš„ç”µæœºè½¬å‘æ˜¯ç”±ä¸€ä¸ªâ€œå¼€å…³çŠ¶æ€â€æ¥æ§åˆ¶çš„ï¼Œå½“è¾“å…¥ä½ç”µå¹³æ—¶ä¸ºæ­£è½¬ï¼Œåä¹‹ä¸ºåè½¬ï¼Œä¸”åè½¬æ—¶çš„ç›¸å¯¹è½¬é€Ÿçš„ç»å¯¹å€¼ä¸æ­£è½¬æ—¶çš„äº’è¡¥ï¼ˆå³å’Œä¸º4800ï¼‰ã€‚ let wheel_left_pwm;let wheel_right_pwm;if wheel_speed_left = 0 wheel_left_pwm = wheel_speed_left as u16; left_wheel_pb8.set_low(); else wheel_left_pwm = (4800 + wheel_speed_left) as u16; left_wheel_pb8.set_high();if wheel_speed_right = 0 wheel_right_pwm = wheel_speed_right as u16; right_wheel_pb9.set_low(); else wheel_right_pwm = (4800 + wheel_speed_right) as u16; right_wheel_pb9.set_high();// è®¾ç½®å·¦å³è½® PWM å ç©ºæ¯”wheels_pwm.set_duty(Channel::C2, (wheel_left_pwm / 4800) * wheels_pwm.get_max_duty());wheels_pwm.set_duty(Channel::C1, (wheel_right_pwm / 4800) * wheels_pwm.get_max_duty()); ä½¿ç”¨æ‹¨ç å¼€å…³æ§åˆ¶æ¿è½½ LEDæˆ‘ä»¬å¯ä»¥ç›´æ¥è¯»å–æ‹¨ç å¼€å…³çš„ç”µå¹³å€¼ï¼Œä»è€Œå†³å®š LED çš„ç”µå¹³å€¼ã€‚ // é€šè¿‡æ‹¨ç å¼€å…³è°ƒæ•´æ¿å­ä¸Š LED ç¯çš„äº®ç­if switch1.is_low() led1_pa11.set_high(); else led1_pa11.set_low();if switch2.is_low() led2_pa15.set_high(); else led2_pa15.set_low();if switch3.is_low() led3_pc12.set_high(); else led3_pc12.set_low();if switch4.is_low() led4_pb3.set_high(); else led4_pb3.set_low(); å¤§åŠŸå‘Šæˆï¼æ•´ä¸ªå·¥ç¨‹çš„å®Œæ•´ä»£ç å¦‚ä¸‹ï¼š /src/main.rs #![no_std]#![no_main]mod gauss;mod utils;use cortex_m_rt::entry;use panic_halt as _;use stm32f1xx_hal::adc, pac::self, prelude::*, serial::Config, timer::Channel, Tim3NoRemap, Tim4NoRemap;use crate::utils::data_limit, send_adc;#[entry]fn main() - ! let steer_pwm_duty_center: u16 = 750 - 5; // èˆµæœº PWM ä¸­å€¼ let steer_pwm_duty_max = steer_pwm_duty_center + 60; // èˆµæœº PWM æœ€å¤§å€¼ let steer_pwm_duty_min = steer_pwm_duty_center - 60; // èˆµæœº PWM æœ€å°å€¼ // æ‹¿åˆ°ç¡¬ä»¶å¤–è®¾æŠ½è±¡å±‚å¥æŸ„ let dp = pac::Peripherals::take().unwrap(); let cp = cortex_m::Peripherals::take().unwrap(); // æ‹¿åˆ°RCCæ—¶é’Ÿå¥æŸ„ let mut rcc = dp.RCC.constrain(); let mut afio = dp.AFIO.constrain(mut rcc); // æ‹¿åˆ°å»¶æ—¶å®šæ—¶å™¨å¥æŸ„ let mut delay = cp.SYST.delay(rcc.clocks); // GPIO å¼€å¯ let mut gpioa = dp.GPIOA.split(mut rcc); let mut gpiob = dp.GPIOB.split(mut rcc); let mut gpioc = dp.GPIOC.split(mut rcc); // Release PB3 from JTAG to use it as GPIO let (pa15_released, pb3_released, _) = afio.mapr.disable_jtag(gpioa.pa15, gpiob.pb3, gpiob.pb4); let mut adc1 = adc::Adc::new(dp.ADC1, mut rcc); let mut adc1_ch4_pa4 = gpioa.pa4.into_analog(mut gpioa.crl); let mut adc1_ch15_pc5 = gpioc.pc5.into_analog(mut gpioc.crl); // é…ç½®å››ä¸ªæ‹¨ç å¼€å…³ä¸ºæ¨æŒ½è¾“å…¥ let switch1 = gpioa.pa8.into_pull_up_input(mut gpioa.crh); let switch2 = gpioc.pc9.into_pull_up_input(mut gpioc.crh); let switch3 = gpioc.pc8.into_pull_up_input(mut gpioc.crh); let switch4 = gpioc.pc7.into_pull_up_input(mut gpioc.crl); let mut led1_pa11 = gpioa.pa11.into_push_pull_output(mut gpioa.crh); let mut led2_pa15 = pa15_released.into_push_pull_output(mut gpioa.crh); let mut led3_pc12 = gpioc.pc12.into_push_pull_output(mut gpioc.crh); let mut led4_pb3 = pb3_released.into_push_pull_output(mut gpiob.crl); // é…ç½®ä½¿èƒ½å¼€å…³ä¸ºæ¨æŒ½è¾“å…¥ let enable_switch_pa12 = gpioa.pa12.into_pull_up_input(mut gpioa.crh); let mut enable_out_pc13 = gpioc.pc13.into_push_pull_output(mut gpioc.crh); // å°† PB0 é…ç½®ä¸º TIM3_CH3 å¤ç”¨æ¨æŒ½è¾“å‡º let tim3_ch3 = gpiob.pb0.into_alternate_push_pull(mut gpiob.crl); // é…ç½® TIM3 ä¸º PWM è¾“å‡ºï¼Œé¢‘ç‡ 1kHz let mut steer_pwm = dp.TIM3.pwm_hz::Tim3NoRemap, _, _( tim3_ch3, mut afio.mapr, 1.kHz(), mut rcc ); // è®¾ç½®å ç©ºæ¯”ä¸º èˆµæœº PWM ä¸­å€¼ steer_pwm.set_duty(Channel::C3, (steer_pwm_duty_center / 9999) * steer_pwm.get_max_duty()); // ä½¿èƒ½èˆµæœº PWM è¾“å‡º steer_pwm.enable(Channel::C3); // é…ç½®å·¦å³è½®æ§åˆ¶æµè¾“å‡º let mut left_wheel_pb8 = gpiob.pb8.into_push_pull_output(mut gpiob.crh); let mut right_wheel_pb9 = gpiob.pb9.into_push_pull_output(mut gpiob.crh); let tim4_ch1 = gpiob.pb6.into_alternate_push_pull(mut gpiob.crl); let tim4_ch2 = gpiob.pb7.into_alternate_push_pull(mut gpiob.crl); let mut wheels_pwm = dp.TIM4.pwm_hz::Tim4NoRemap, _, _( (tim4_ch1, tim4_ch2), mut afio.mapr, 1.kHz(), mut rcc ); wheels_pwm.set_duty(Channel::C2, 0); wheels_pwm.set_duty(Channel::C1, 0); wheels_pwm.enable(Channel::C2); wheels_pwm.enable(Channel::C1); // é…ç½® USART ä¸²å£é€šè¿‡ JustFloat åè®®è¾“å‡º ADC å€¼ä¿¡æ¯ let usart1_tx = gpioa.pa9.into_alternate_push_pull(mut gpioa.crh); let usart1_rx = gpioa.pa10; let mut serial = dp.USART1 .serial( (usart1_tx, usart1_rx), Config::default().baudrate(115200.bps()), mut rcc ); let mut adc_value_right_buffer = [0_i32; 33]; let mut adc_value_left_buffer = [0_i32; 33]; loop // è¯»å– ADC å€¼å…¥ç¼“å†²åŒº for i in (1..33).rev() let adc_value_right = adc1.read(mut adc1_ch4_pa4).unwrap(); let adc_value_left = adc1.read(mut adc1_ch15_pc5).unwrap(); adc_value_right_buffer[i] = adc_value_right; adc_value_left_buffer[i] = adc_value_left; send_adc(mut serial, adc_value_right as f64, adc_value_left as f64); delay.delay_us(33_u32); // è®¡ç®—é«˜æ–¯æ»¤æ³¢åçš„å€¼ let filtered_right = gauss::gauss_filter(adc_value_right_buffer, 16); let filtered_left = gauss::gauss_filter(adc_value_left_buffer, 16); let diff = (filtered_right - filtered_left) as i32; let steer_pwm_diff = data_limit(diff as f64 * 0.3, steer_pwm_duty_min as f64, steer_pwm_duty_max as f64) as u16; let steer_pwm_duty = steer_pwm_duty_center - steer_pwm_diff; // è®¾ç½®èˆµæœº PWM å ç©ºæ¯” steer_pwm.set_duty(Channel::C3, (steer_pwm_duty / 9999) * steer_pwm.get_max_duty()); let mut wheel_speed_left = 0; let mut wheel_speed_right = 0; // æ ¹æ®ä½¿èƒ½å¼€å…³çŠ¶æ€æ§åˆ¶è¾“å‡º if enable_switch_pa12.is_high() wheel_speed_left = 800; wheel_speed_right = 800; enable_out_pc13.set_high(); else enable_out_pc13.set_low(); let wheel_left_pwm; let wheel_right_pwm; if wheel_speed_left = 0 wheel_left_pwm = wheel_speed_left as u16; left_wheel_pb8.set_low(); else wheel_left_pwm = (4800 + wheel_speed_left) as u16; left_wheel_pb8.set_high(); if wheel_speed_right = 0 wheel_right_pwm = wheel_speed_right as u16; right_wheel_pb9.set_low(); else wheel_right_pwm = (4800 + wheel_speed_right) as u16; right_wheel_pb9.set_high(); // è®¾ç½®å·¦å³è½® PWM å ç©ºæ¯” wheels_pwm.set_duty(Channel::C2, (wheel_left_pwm / 4800) * wheels_pwm.get_max_duty()); wheels_pwm.set_duty(Channel::C1, (wheel_right_pwm / 4800) * wheels_pwm.get_max_duty()); // é€šè¿‡æ‹¨ç å¼€å…³è°ƒæ•´æ¿å­ä¸Š LED ç¯çš„äº®ç­ if switch1.is_low() led1_pa11.set_high(); else led1_pa11.set_low(); if switch2.is_low() led2_pa15.set_high(); else led2_pa15.set_low(); if switch3.is_low() led3_pc12.set_high(); else led3_pc12.set_low(); if switch4.is_low() led4_pb3.set_high(); else led4_pb3.set_low(); /src/utils.rs use cortex_m::prelude::_embedded_hal_serial_Write;pub fn data_limit(x: f64, min: f64, max: f64) - f64 if x min min else if x max max else x #[inline(always)]pub fn quicksort(arr: mut [i32]) let len = arr.len(); if len = 1 return; let pivot = arr[len - 1]; let mut i = 0; for j in 0..len - 1 if arr[j] = pivot arr.swap(i, j); i += 1; arr.swap(i, len - 1); if i 0 quicksort(mut arr[0..i]); if i + 1 len quicksort(mut arr[i+1..]); pub fn send_adcW(serial : mut W, adc_right : f64, adc_left : f64)where W: _embedded_hal_serial_Writeu8 + core::fmt::Write let tail : [u8; 4] = [0x00, 0x00, 0x80, 0x7f]; for byte in adc_left.to_le_bytes().iter() serial.write(*byte).ok(); for byte in adc_right.to_le_bytes().iter() serial.write(*byte).ok(); for byte in tail.iter() serial.write(*byte).ok(); /src/gauss.rs use crate::utils::quicksort;pub fn gauss_filter(x: [i32], n: usize) - f64 if n = 0 return 0.0; if n == 1 return x[0] as f64; // åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ•°ç»„æ¥å­˜å‚¨æ’åºåçš„æ•°æ® let mut sorted = [0i32; 64]; // å‡è®¾æœ€å¤§é•¿åº¦ä¸º64ï¼Œæ ¹æ®å®é™…éœ€æ±‚è°ƒæ•´ for i in 0..n sorted[i] = x[i]; quicksort(mut sorted[0..n]); // --- åˆå§‹ä¼°è®¡ --- let mut sum: f64 = 0.0; for i in 0..n sum += sorted[i] as f64; let mut mu = sum / (n as f64); let mut var: f64 = 0.0; for i in 0..n let diff = sorted[i] as f64 - mu; var += diff * diff; var /= (n - 1) as f64; let mut sigma: f64 = libm::sqrt(var); if sigma 1e-6 sigma = 1e-6; // --- è¿­ä»£æ›´æ–° --- let max_iter = 30; let tol = 1e-6; for _iter in 0..max_iter let mut sum_w: f64 = 0.0; let mut sum_wx: f64 = 0.0; for i in 0..n let diff: f64 = (sorted[i] as f64 - mu) / sigma; let exponent: f64 = -0.5 * diff * diff; let mut weight = libm::exp(exponent); if weight 1e-10 weight = 1e-10; sum_w += weight; sum_wx += weight * sorted[i] as f64; let new_mu = sum_wx / sum_w; if libm::fabs(new_mu - mu) tol mu = new_mu; break; mu = new_mu; // æ›´æ–° sigma let mut sum_var = 0.0; let mut sum_var_w = 0.0; for i in 0..n let diff = sorted[i] as f64 - mu; let exponent = -0.5 * (diff / sigma) * (diff / sigma); let mut weight = libm::exp(exponent); if weight 1e-10 weight = 1e-10; sum_var += weight * diff * diff; sum_var_w += weight; sigma = libm::sqrt(sum_var / sum_var_w); if sigma 1e-6 sigma = 1e-6; return mu; ç”±è¿™ä¸ªå·¥ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼šä½¿ç”¨ Rust å¼€å‘çš„å•ç‰‡æœºç¨‹åºï¼Œåœ¨æºä»£ç æ–¹é¢ï¼Œå¤§å¤§æå‡äº†ä»£ç çš„å¯è¯»æ€§ã€‚Rust çš„ HAL åº“çš„æŠ½è±¡ç¨‹åº¦è¿œé«˜äº C çš„ HAL åº“ï¼Œå› æ­¤ï¼Œåœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨ Rust æ— ç–‘æ˜¯æå…¶æ–¹ä¾¿çš„ã€‚ä¸” Rust çš„å„ä¸ªåµŒå…¥å¼åº“æ—¥è¶‹æˆç†Ÿï¼Œæ ‘è“æ´¾ Pico å·²ç»å°† Rust åˆ—ä¸ºäº†å’Œ CC++ï¼Œ MicroPython ç­‰åŒçº§çš„è¯­è¨€ã€‚åœ¨åµŒå…¥å¼æ–¹é¢ï¼ŒRust çš„å‘å±•æ— ç–‘æ˜¯å¦‚æ—¥ä¸­å¤©çš„ã€‚ä½†æ˜¯ï¼Œåœ¨é…ç½®æ–¹é¢ï¼ŒRust çš„é…ç½®ä»ç„¶ç›¸å¯¹è¾ƒä¸ºéº»çƒ¦ï¼Œæ²¡æœ‰ç±»ä¼¼äº CubeMX çš„å·¥å…·ï¼Œåœ¨è¿™æ–¹é¢ï¼ŒRust ä»ç„¶æ˜¯å…·æœ‰å¾ˆå¤§çš„çªç ´ç©ºé—´çš„ã€‚ å‚è€ƒèµ„æ–™[1] stm32f1xx-halexamples Rust åµŒå…¥å¼å®˜æ–¹ä¾‹ç¨‹ï¼› [2] doc.rust-lang.netstableembedded-book åµŒå…¥å¼ Rust Book [3] zhuanlan.zhihu.com Rust åµŒå…¥å¼å¼€å‘ STM32 RISC-V [4] kaisery.github.io Rust ç¨‹åºè®¾è®¡è¯­è¨€ - ç®€ä½“ä¸­æ–‡ç‰ˆ [5] ChatGPTã€Geminiã€GitHub Copilot ç­‰ AI å·¥å…·ğŸ˜‹","tags":["Rust"]},{"title":"sys_brk","path":"/2025/11/12/sys-brk/","content":"sys_brkï¼ˆå³è°ƒç”¨å·ä¸º12çš„brkç³»ç»Ÿè°ƒç”¨ï¼‰æ˜¯Linuxä¸­ä¸€ä¸ªç”¨äºåŠ¨æ€å†…å­˜ç®¡ç†çš„æ ¸å¿ƒç³»ç»Ÿè°ƒç”¨ã€‚å®ƒç›´æ¥æ“ä½œè¿›ç¨‹çš„ç¨‹åºä¸­æ–­ç‚¹ï¼ˆprogram breakï¼‰ï¼Œå³å †ï¼ˆheapï¼‰çš„ç»“æŸåœ°å€ã€‚é€šè¿‡æ”¹å˜è¿™ä¸ªä¸­æ–­ç‚¹çš„ä½ç½®ï¼Œç¨‹åºå¯ä»¥åŠ¨æ€åœ°å¢åŠ æˆ–å‡å°‘å…¶æ•°æ®æ®µçš„å¤§å°ã€‚å°½ç®¡ç°ä»£Cåº“ï¼ˆå¦‚glibcï¼‰é€šå¸¸ä½¿ç”¨mmapæ¥å®ç°æ›´çµæ´»çš„å†…å­˜åˆ†é…ï¼ˆå¦‚mallocï¼‰ï¼Œä½†åœ¨åº•å±‚ï¼Œsys_brkä»ç„¶æ˜¯æ‰©å±•å †ç©ºé—´çš„åŸºæœ¬æœºåˆ¶ã€‚äº†è§£sys_brkæœ‰åŠ©äºç†è§£è¿›ç¨‹åœ°å€ç©ºé—´çš„å¸ƒå±€ï¼Œä»¥åŠæ“ä½œç³»ç»Ÿå¦‚ä½•ä¸ºç¨‹åºæä¾›å¯å˜å¤§å°çš„å†…å­˜åŒºåŸŸã€‚ sys_brk å‡½æ•°åŸå‹ int brk(void *addr); å‚æ•° addr: æ–°çš„ç¨‹åºä¸­æ–­ç‚¹åœ°å€ã€‚å¦‚æœè¯¥åœ°å€æ¯”å½“å‰ä¸­æ–­ç‚¹é«˜ï¼Œåˆ™æ‰©å¤§å †ï¼›å¦‚æœæ¯”å½“å‰ä¸­æ–­ç‚¹ä½ï¼Œåˆ™ç¼©å°å †ã€‚å¦‚æœä¼ å…¥0ï¼Œç³»ç»Ÿè°ƒç”¨ä¼šè¿”å›å½“å‰ç¨‹åºä¸­æ–­ç‚¹çš„åœ°å€ã€‚ è¿”å›å€¼ æˆåŠŸæ—¶è¿”å›æ–°ç¨‹åºä¸­æ–­ç‚¹åœ°å€ï¼ˆå³å‚æ•°addrï¼‰ã€‚ä½†å¯¹äºç°ä»£x86_64 Linuxï¼Œä¸ºäº†ä¸æ—§ç‰ˆå†…æ ¸å…¼å®¹ï¼Œè¿”å›å€¼åœ¨raxä¸­ä¼šæ˜¯0ï¼Œå¤±è´¥æ—¶ä¼šæ˜¯1ã€‚ å¤±è´¥æ—¶è¿”å›-1ï¼Œå¹¶è®¾ç½®errnoï¼ˆå¦‚ENOMEMï¼‰ã€‚ ç”¨ä¾‹ .equ SYS_BRK, 12\t.equ SYS_WRITE, 1\t.equ SYS_EXIT, 60\t.equ STDOUT, 1\t.equ PAGE_SIZE, 4096\t.section .datainitial_brk:\t.quad 0x0message:\t.ascii New memory allocated with sys_brk. \\0\tmsg_len = . - message\t.section .text\t.globl _start_start:\t# è·å–å½“å‰ç¨‹åºä¸­æ–­ç‚¹åœ°å€\tmov $SYS_BRK, %rax\txor %rdi, %rdi\tsyscall\t# æ£€æŸ¥è¿”å›å€¼ä»¥ç¡®ä¿æˆåŠŸ\tcmp $0, %rax\tje exit_error\t# å°†å½“å‰ä¸­æ–­ç‚¹åœ°å€ä¿å­˜èµ·æ¥\tmov %rax, initial_brk(%rip)\t# è®¡ç®—æ–°çš„ä¸­æ–­ç‚¹åœ°å€ï¼ˆå¢åŠ ä¸€ä¸ªé¡µå¤§å°ï¼‰\tadd $PAGE_SIZE, %rax\t# è°ƒç”¨ sys_brk æ‰©å±•å †\tmov $SYS_BRK, %rax\tmov initial_brk(%rip), %rdi\tadd $PAGE_SIZE, %rdi\tsyscall\t# æ£€æŸ¥è¿”å›å€¼ï¼Œå¦‚æœå¤±è´¥åˆ™é€€å‡º\tcmp $0, %rax\tjne exit_error\t# å°†æ¶ˆæ¯å¤åˆ¶åˆ°æ–°åˆ†é…çš„å†…å­˜åŒºåŸŸ\tmov initial_brk(%rip), %rdi\tmov $message, %rsi\tmov $msg_len, %rcx\tcld\trep movsb\t# ä½¿ç”¨ sys_write æ‰“å°æ–°å†…å­˜ä¸­çš„æ¶ˆæ¯\tmov $SYS_WRITE, %rax\tmov $STDOUT, %rdi\tmov initial_brk(%rip), %rsi\tmov $msg_len, %rdx\tsyscall# é€€å‡ºç¨‹åºexit_success:\tmov $SYS_EXIT, %rax\txor %rdi, %rdi\tsyscallexit_error:\tmov $SYS_EXIT, %rax\tmov $1, %rdi\tsyscall åˆ†æï¼š ä¸Šè¿°ä»£ç æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨sys_brkç³»ç»Ÿè°ƒç”¨æ¥åŠ¨æ€åœ°æ‰©å¤§å †å†…å­˜ã€‚ é¦–å…ˆï¼Œç¨‹åºé€šè¿‡è°ƒç”¨brk(0)æ¥è·å–å½“å‰çš„ç¨‹åºä¸­æ–­ç‚¹åœ°å€ã€‚åœ¨æ±‡ç¼–ä¸­ï¼Œè¿™æ˜¯é€šè¿‡å°†ç³»ç»Ÿè°ƒç”¨å·12æ”¾å…¥%raxå¹¶å°†%rdiè®¾ç½®ä¸º0æ¥å®Œæˆçš„ã€‚è¿”å›çš„åœ°å€ä¼šä¿å­˜åœ¨%raxä¸­ï¼Œç¨‹åºå°†å…¶å­˜å‚¨åœ¨initial_brkå˜é‡ä¸­ã€‚ æ¥ç€ï¼Œç¨‹åºå°†initial_brkçš„å€¼å¢åŠ ä¸€ä¸ªé¡µé¢å¤§å°ï¼ˆ4096å­—èŠ‚ï¼‰ï¼Œå¾—åˆ°æ–°çš„ä¸­æ–­ç‚¹åœ°å€ã€‚ç„¶åï¼Œå®ƒå†æ¬¡è°ƒç”¨sys_brkï¼Œå¹¶å°†è¿™ä¸ªæ–°çš„åœ°å€ä½œä¸ºå‚æ•°ä¼ é€’ã€‚å¦‚æœè°ƒç”¨æˆåŠŸï¼Œå†…æ ¸ä¼šè°ƒæ•´å †çš„å¤§å°ï¼Œä½¿ç¨‹åºå¯ä»¥ä½¿ç”¨è¿™å—æ–°åˆ†é…çš„å†…å­˜ã€‚ æœ€åï¼Œç¨‹åºå°†ä¸€ä¸ªå­—ç¬¦ä¸²æ¶ˆæ¯å¤åˆ¶åˆ°è¿™ä¸ªæ–°åˆ†é…çš„å†…å­˜åŒºåŸŸï¼Œå¹¶ä½¿ç”¨sys_writeç³»ç»Ÿè°ƒç”¨å°†å…¶æ‰“å°åˆ°æ ‡å‡†è¾“å‡ºã€‚è¿™è¯æ˜äº†é€šè¿‡sys_brkåˆ†é…çš„å†…å­˜ç°åœ¨æ˜¯å¯è®¿é—®å’Œå¯å†™å…¥çš„ã€‚","tags":["Linux"]},{"title":"sys_mprotect","path":"/2025/11/12/sys-mprotect/","content":"sys_mprotectï¼ˆå³è°ƒç”¨å·ä¸º10çš„mprotectç³»ç»Ÿè°ƒç”¨ï¼‰æ˜¯Linuxå†…æ ¸æä¾›çš„ä¸€ä¸ªæ ¸å¿ƒåŠŸèƒ½ï¼Œå®ƒå…è®¸ç¨‹åºåŠ¨æ€åœ°ä¿®æ”¹å…¶è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­æŸä¸ªå†…å­˜åŒºåŸŸçš„è®¿é—®æƒé™ã€‚è¿™åœ¨å¾ˆå¤šåœºæ™¯ä¸­éƒ½è‡³å…³é‡è¦ï¼Œå¦‚å®ç°JITç¼–è¯‘å™¨ã€æ²™ç®±æœºåˆ¶ï¼Œæˆ–è€…é˜²æ­¢æŸäº›ç±»å‹çš„ç¼“å†²åŒºæº¢å‡ºæ”»å‡»ã€‚é€šè¿‡è°ƒç”¨sys_mprotectï¼Œç¨‹åºå¯ä»¥å°†ä¸€æ®µå†…å­˜è®¾ç½®ä¸ºåªè¯»ï¼Œä»¥ä¿æŠ¤é‡è¦æ•°æ®ä¸è¢«æ„å¤–ä¿®æ”¹ï¼›æˆ–è€…å°†ä¸€æ®µå†…å­˜è®¾ç½®ä¸ºå¯æ‰§è¡Œï¼Œä»¥å…è®¸åŠ¨æ€ç”Ÿæˆçš„ä»£ç è¿è¡Œã€‚ç†è§£è¿™ä¸ªç³»ç»Ÿè°ƒç”¨æœ‰åŠ©äºæ·±å…¥ç†è§£ç°ä»£æ“ä½œç³»ç»Ÿçš„å†…å­˜ç®¡ç†å’Œå®‰å…¨æœºåˆ¶ã€‚ sys_mprotect å‡½æ•°åŸå‹ int mprotect(const void *addr, size_t len, int prot); å‚æ•° addr: è¦ä¿®æ”¹æƒé™çš„å†…å­˜åŒºåŸŸçš„èµ·å§‹åœ°å€ã€‚è¿™ä¸ªåœ°å€å¿…é¡»æ˜¯é¡µå¯¹é½çš„ï¼Œå¦åˆ™ç³»ç»Ÿè°ƒç”¨ä¼šå¤±è´¥å¹¶è¿”å›EINVALé”™è¯¯ã€‚ len: è¦ä¿®æ”¹æƒé™çš„å†…å­˜åŒºåŸŸçš„é•¿åº¦ï¼ˆå­—èŠ‚ï¼‰ã€‚è¿™ä¸ªé•¿åº¦ä¹Ÿå¿…é¡»æ˜¯é¡µå¤§å°çš„æ•´æ•°å€ã€‚ protï¼šæ˜ å°„åŒºåŸŸçš„è®¿é—®æƒé™ï¼š PROT_NONEï¼šé¡µé¢ä¸å¯è®¿é—® PROT_READï¼šé¡µé¢å¯è¯» PROT_WRITEï¼šé¡µé¢å¯å†™ PROT_EXECï¼šé¡µé¢å¯æ‰§è¡Œ PROT_SEMï¼šé¡µé¢å¯ç”¨äºåŸå­æ“ä½œåŒæ­¥ï¼ˆè‡ª Linux 2.5.7 èµ·æ”¯æŒï¼‰ ğŸ’¡ å¤‡æ³¨ï¼šprot å–å€¼çš„å®å®šä¹‰å¦‚ä¸‹ï¼š #define PROT_NONE 0x0#define PROT_READ 0x1#define PROT_WRITE 0x2#define PROT_EXEC 0x4#define PROT_SEM 0x8#define PROT_GROWSDOWN 0x01000000#define PROT_GROWSUP 0x02000000 å„ä¸ªå®ä¹‹é—´ä½¿ç”¨æŒ‰ä½æˆ–è¿ç®—ç¬¦ | è¿›è¡Œè¿æ¥ã€‚ è¿”å›å€¼ æˆåŠŸæ—¶è¿”å›0ã€‚ å¤±è´¥æ—¶è¿”å›-1ï¼Œå¹¶è®¾ç½®errnoï¼ˆå¦‚ENOMEM, EFAULT, EINVAL, EACCESï¼‰ã€‚ ç”¨ä¾‹ .equ SYS_MPROTECT, 10\t.equ SYS_EXIT, 60\t.equ PROT_READ, 0x01\t.equ PROT_READ_WRITE, 0x03\t.equ PAGE_SIZE, 4096\t.section .data\t.p2align 12 # å¼ºåˆ¶é¡µå¯¹é½my_page:\t.ascii This is a memory page to be protected.\\ .space (PAGE_SIZE - (. - my_page)) # å¡«å……åˆ°é¡µå¤§å°\t.section .text\t.globl _start_start:\t# å°† my_page è®¾ç½®ä¸ºåªè¯»\tmov $SYS_MPROTECT, %rax\tlea my_page(%rip), %rdi # addr = my_page\tmov $PAGE_SIZE, %rsi # len = 4096\tmov $PROT_READ, %rdx # prot = PROT_READ\tsyscall\t# æ£€æŸ¥è¿”å›å€¼ï¼ˆ%raxï¼‰ï¼Œå¦‚æœå¤±è´¥åˆ™é€€å‡º\tcmp $0, %rax\tjne exit_error\t# è¿™é‡Œå¯ä»¥å°è¯•å‘ my_page ä¸­å†™å…¥å†…å®¹\t# call write_page # ç°åœ¨å°è¯•å°† my_page è®¾ç½®ä¸ºå¯è¯»å†™\tmov $SYS_MPROTECT, %rax\tlea my_page(%rip), %rdi # addr = my_page\tmov $PAGE_SIZE, %rsi # len = 4096\tmov $PROT_READ_WRITE, %rdx # prot = PROT_READ | PROT_WRITE\tsyscall\t# è¿™é‡Œå¯ä»¥å†æ¬¡å°è¯•å‘ my_page ä¸­å†™å…¥å†…å®¹\tcall write_page# é€€å‡ºç¨‹åºexit_success:\tmov $SYS_EXIT, %rax\txor %rdi, %rdi\tsyscallexit_error:\tmov $SYS_EXIT, %rax\tmov $1, %rdi\tsyscall# å°è¯•ä¿®æ”¹ my_page è¿™æ®µå†…å­˜ä¸­ç¬¬ä¸€ä¸ªå­—èŠ‚çš„å€¼write_page:\tlea my_page(%rip), %rdi\tmov $0, (%rdi)\tret åˆ†æï¼š ä¸Šè¿°ä»£ç æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨sys_mprotectæ¥åŠ¨æ€æ”¹å˜å†…å­˜åŒºåŸŸçš„æƒé™ã€‚ ç¨‹åºé¦–å…ˆåœ¨.dataæ®µå®šä¹‰äº†ä¸€ä¸ªåä¸ºmy_pageçš„å†…å­˜åŒºåŸŸï¼Œå¹¶ä½¿ç”¨.p2align 12æŒ‡ä»¤ç¡®ä¿å…¶åœ°å€æ˜¯4096å­—èŠ‚ï¼ˆå³ä¸€ä¸ªå†…å­˜é¡µï¼‰çš„æ•´æ•°å€å¯¹é½ã€‚ç„¶åï¼Œå®ƒç”¨.spaceæŒ‡ä»¤å¡«å……å‰©ä½™ç©ºé—´ï¼Œä½¿è¯¥åŒºåŸŸæ°å¥½ä¸ºä¸€ä¸ªé¡µçš„å¤§å°ã€‚ æ¥ä¸‹æ¥ï¼Œç¨‹åºè°ƒç”¨sys_mprotectï¼Œå°†my_pageçš„åœ°å€åŠ è½½åˆ°%rdiï¼Œé•¿åº¦PAGE_SIZEåŠ è½½åˆ°%rsiï¼Œå¹¶å°†æƒé™æ ‡å¿—PROT_READï¼ˆåªè¯»ï¼‰åŠ è½½åˆ°%rdxã€‚æ‰§è¡Œsyscallåï¼Œmy_pageè¿™å—å†…å­˜å°†å˜ä¸ºåªè¯»ã€‚ å¦‚ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªæ—¶å€™å°è¯•call write_page ï¼Œä½†æ˜¯ç”±äºå‰é¢å·²ç»å°†è¿™å—ç›®æ ‡å†…å­˜è®¾ç½®ä¸ºåªè¯»ï¼Œä¿®æ”¹æ“ä½œä¸ä¼šç”Ÿæ•ˆï¼Œä¸”ä¼šè§¦å‘æ®µé”™è¯¯SIGSEGV é€ æˆæ•´ä¸ªç¨‹åºçš„å¼ºåˆ¶æ€§å´©æºƒã€‚åä¹‹ï¼Œå¦‚æœæˆ‘ä»¬åœ¨å‰é¢ä¸è°ƒç”¨sys_mprotect ï¼Œè€Œåœ¨è¿™é‡Œå°è¯•call write_page ï¼Œç¨‹åºå¹¶ä¸ä¼šæŠ¥é”™ï¼Œä¸”å¯ä»¥å®ç°å¯¹å†…å­˜çš„æ­£å¸¸ä¿®æ”¹ã€‚ åœ¨è¿™ä¹‹åï¼Œç¨‹åºå†æ¬¡è°ƒç”¨sys_mprotectï¼Œå°†æƒé™æ ‡å¿—æ›´æ–°ä¸ºPROT_READ | PROT_WRITEï¼Œä»è€Œå°†my_pageçš„æƒé™ä»åªè¯»ä¿®æ”¹ä¸ºå¯è¯»å†™ã€‚æ­¤æ—¶å†å°è¯•call write_page ï¼Œå‘ç°å†…å­˜å¯ä»¥è¢«æ­£å¸¸ä¿®æ”¹ï¼Œä¸”ä¸ä¼šè§¦å‘æ®µé”™è¯¯ã€‚ æ•´ä¸ªè¿‡ç¨‹å±•ç¤ºäº†sys_mprotectå¦‚ä½•çµæ´»åœ°æ§åˆ¶å†…å­˜æƒé™ï¼Œè¿™åœ¨åº•å±‚ç¼–ç¨‹ä¸­éå¸¸æœ‰ç”¨ã€‚","tags":["Linux"]},{"title":"sys_mmap ä¸ sys_munmap","path":"/2025/11/12/sys-mmap-ä¸-sys-munmap/","content":"sys_mmapï¼ˆè°ƒç”¨å·ä¸º9ï¼‰å’Œsys_munmap ï¼ˆè°ƒç”¨å·ä¸º11ï¼‰æ˜¯ Linux ä¸­åŠŸèƒ½æœ€å¼ºå¤§çš„å†…å­˜ç®¡ç†æ¥å£ä¹‹ä¸€ã€‚äºŒè€…åˆ†åˆ«å¯ç”¨äºå°†æ–‡ä»¶æˆ–åŒ¿åå†…å­˜æ˜ å°„åˆ°è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä»¥åŠå–æ¶ˆå‰è€…æ‰€å»ºç«‹çš„æ˜ å°„ï¼Œä»è€Œå®ç°æ–‡ä»¶ IO çš„å†…å­˜è¯­ä¹‰ã€å †å¤–å¤§å—å†…å­˜åˆ†é…ã€å…±äº«å†…å­˜ã€çº¿ç¨‹æ ˆç©ºé—´åˆ†é…ç­‰åŠŸèƒ½ã€‚ sys_mmap å‡½æ•°åŸå‹ void *mmap(void *addr, size_t length, int prot, int flags, int fd, off_t offset); å‚æ•° addrï¼šå»ºè®®çš„æ˜ å°„èµ·å§‹åœ°å€ï¼ˆé€šå¸¸ä¼  NULLï¼Œå³è®©å†…æ ¸è‡ªåŠ¨é€‰æ‹©åˆé€‚çš„åœ°å€ï¼‰ã€‚ å¦‚æœä¸ MAP_FIXED æ ‡å¿—ä¸€èµ·ä½¿ç”¨ï¼Œåˆ™å¿…é¡»æ˜¯é¡µå¯¹é½åœ°å€ï¼Œä¸”ä¼šè¦†ç›–è¯¥å¤„åŸæœ‰æ˜ å°„ã€‚ lengthï¼šæ˜ å°„çš„å­—èŠ‚æ•°ã€‚å†…æ ¸ä¼šå‘ä¸Šå–æ•´åˆ°é¡µå¤§å°çš„å€æ•°ã€‚ protï¼šæ˜ å°„åŒºåŸŸçš„è®¿é—®æƒé™ï¼ˆå¯æŒ‰ä½æˆ–ç»„åˆï¼‰ï¼š PROT_NONEï¼šé¡µé¢ä¸å¯è®¿é—® PROT_READï¼šé¡µé¢å¯è¯» PROT_WRITEï¼šé¡µé¢å¯å†™ PROT_EXECï¼šé¡µé¢å¯æ‰§è¡Œ PROT_SEMï¼šé¡µé¢å¯ç”¨äºåŸå­æ“ä½œåŒæ­¥ï¼ˆè‡ª Linux 2.5.7 èµ·æ”¯æŒï¼‰ flagsï¼šæ˜ å°„çš„ç±»å‹å’Œå±æ€§ï¼ˆå¯æŒ‰ä½æˆ–ç»„åˆï¼‰ï¼š åŸºæœ¬å±æ€§ MAP_SHAREDï¼šä¿®æ”¹å…±äº«åˆ°æ–‡ä»¶æˆ–å…¶å®ƒè¿›ç¨‹ MAP_PRIVATEï¼šå†™æ—¶å¤åˆ¶ï¼ˆCOWï¼‰ï¼Œä¿®æ”¹ä¸ä¼šå½±å“åº•å±‚æ–‡ä»¶ åœ°å€æ§åˆ¶ MAP_FIXEDï¼šå¼ºåˆ¶åœ¨ addr æŒ‡å®šä½ç½®æ˜ å°„ï¼Œè‹¥å†²çªåˆ™è¦†ç›–ï¼ˆå±é™©ï¼‰ MAP_FIXED_NOREPLACEï¼šå¼ºåˆ¶æ˜ å°„ä½†ä¸è¦†ç›–å·²æœ‰åŒºåŸŸï¼ˆLinux 4.17+ï¼‰ MAP_32BITï¼šå°†æ˜ å°„æ”¾åœ¨ä½ 2GB åœ°å€ç©ºé—´ MAP_STACKï¼šæç¤ºå†…æ ¸å°†åŒºåŸŸå½“ä½œæ ˆï¼ˆè‡ªåŠ¨å¢é•¿ï¼‰ åŒ¿åç‰¹æ®Š MAP_ANONYMOUSï¼šåŒ¿åæ˜ å°„ï¼ˆä¸ä¾èµ–æ–‡ä»¶ï¼‰ï¼Œfd å¿…é¡»ä¸º 1 MAP_GROWSDOWNï¼šå‘ä¸‹å¢é•¿ï¼ˆæ ˆä½¿ç”¨ï¼‰ MAP_HUGETLBï¼šä½¿ç”¨å¤§é¡µå†…å­˜ï¼ˆHugeTLBï¼‰ æ€§èƒ½æ§åˆ¶ MAP_POPULATEï¼šç«‹å³é¢„å–ï¼ˆè§¦å‘ç¼ºé¡µåŠ è½½ï¼‰ MAP_NONBLOCKï¼šç»“åˆ MAP_POPULATEï¼Œåå°åŠ è½½ MAP_NORESERVEï¼šä¸ä¸ºäº¤æ¢åŒºé¢„ç•™ç©ºé—´ MAP_LOCKEDï¼šå°†æ˜ å°„é”å®šåœ¨ç‰©ç†å†…å­˜ä¸­ MAP_SYNCï¼šä¸æŒä¹…åŒ–å­˜å‚¨åŒæ­¥ï¼ˆéœ€ DAX æ”¯æŒï¼‰ MAP_UNINITIALIZEDï¼šå…è®¸è¿”å›æœªæ¸…é›¶å†…å­˜ï¼ˆä»…æŸäº›å†…æ ¸é…ç½®ï¼‰ ğŸ’¡ å¤‡æ³¨ï¼šprot å’Œ flags çš„å®å®šä¹‰å¦‚ä¸‹ï¼š #define PROT_NONE 0x0#define PROT_READ 0x1#define PROT_WRITE 0x2#define PROT_EXEC 0x4#define PROT_SEM 0x8#define PROT_GROWSDOWN 0x01000000#define PROT_GROWSUP 0x02000000#define MAP_SHARED 0x01#define MAP_PRIVATE 0x02#define MAP_FIXED 0x10#define MAP_ANONYMOUS 0x20#define MAP_32BIT 0x40#define MAP_GROWSDOWN 0x0100#define MAP_DENYWRITE 0x0800#define MAP_EXECUTABLE 0x1000#define MAP_LOCKED 0x2000#define MAP_NORESERVE 0x4000#define MAP_POPULATE 0x8000#define MAP_NONBLOCK 0x10000#define MAP_STACK 0x20000#define MAP_HUGETLB 0x40000#define MAP_SYNC 0x80000#define MAP_FIXED_NOREPLACE 0x100000#define MAP_UNINITIALIZED 0x200000 åœ¨ C è¯­è¨€çš„ç¨‹åºå®ç°ä¸­ï¼Œå„ä¸ªå®ä½¿ç”¨æŒ‰ä½æˆ–è¿ç®—ç¬¦ | è¿æ¥ã€‚ fdï¼šæ–‡ä»¶æè¿°ç¬¦ã€‚å¦‚æœæ˜¯åŒ¿åæ˜ å°„ï¼Œåˆ™å¿…é¡»ä¸º 1ã€‚ offsetï¼šæ–‡ä»¶ä¸­æ˜ å°„çš„èµ·å§‹åç§»ï¼Œå¿…é¡»æ˜¯é¡µå¤§å°çš„æ•´æ•°å€ã€‚ è¿”å›å€¼ æˆåŠŸæ—¶è¿”å›æ˜ å°„åŒºçš„èµ·å§‹åœ°å€ï¼ˆvoid * æŒ‡é’ˆï¼‰ã€‚ å¤±è´¥æ—¶è¿”å›-1 å¹¶è®¾ç½®errnoã€‚ sys_munmap å‡½æ•°åŸå‹ int munmap(void *addr, size_t length); å‚æ•° addrï¼šè¦å–æ¶ˆçš„æ˜ å°„åŒºçš„èµ·å§‹åœ°å€ã€‚ lengthï¼šæ˜ å°„çš„å­—èŠ‚æ•°ã€‚ è¿”å›å€¼ æˆåŠŸæ—¶è¿”å›0 ã€‚ å¤±è´¥æ—¶è¿”å›-1 å¹¶è®¾ç½®errno ã€‚ ç”¨ä¾‹ .equ MAP_SHARED, 0x01\t.equ PROT_READ, 0x01\t.equ PROT_WRITE, 0x02\t.equ PROT_READ_WRITE, 0x03\t.section .datafilename:\t.ascii /tmp/test.txt\\0mmap_msg:\t.ascii Data from mmap \\0\tmmap_msg_len = . - mmap_msgwrite_msg:\t.ascii \\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\\0\twrite_msg_len = . - write_msgerrmsg:\t.ascii Error \\0\terrmsg_len = . - errmsg\t.section .bss\t.lcomm mapped_addr, 8 # å­˜å‚¨æ˜ å°„çš„åœ°å€\t.lcomm fd, 4\t.section .text\t.globl _start_start:\t# å¼€å¯ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ %r12 è¯»å– /tmp/test.txt\tmov $2, %rax\tlea filename(%rip), %rdi\tmov $0x242, %rsi\tmov $0644, %rdx\tsyscall\tmov %rax, fd(%rip)\t# è°ƒç”¨ write å¾€æ–‡ä»¶ä¸­å†™å…¥æ•°æ®\tmov $1, %rax\tmov fd(%rip), %rdi\tlea write_msg(%rip), %rsi\tmov $write_msg_len, %rdx\tsyscall\t# è°ƒç”¨ mmap å°†æ–‡ä»¶æ˜ å°„åˆ°å†…å­˜\tmov $9, %rax\txor %rdi, %rdi # addr = NULL\tmov $mmap_msg_len, %rsi # length = msg_len\tmov $PROT_READ_WRITE, %rdx # prot = PROT_READ | PROT_WRITE\tmov $MAP_SHARED, %r10 # flags = MAP_SHARED\tmov fd(%rip), %r8 # fd\txor %r9, %r9 # offset = 0\tsyscall\t# æ£€æŸ¥ mmap æ˜¯å¦å‡ºé”™\tcmp $-1, %rax\tjle exit_error\t# å°† mmap è¿”å›çš„åœ°å€ä¿å­˜åˆ° mapped_addr\tmov %rax, mapped_addr(%rip)\t# å°†æ•°æ®ä» msg å¤åˆ¶åˆ°æ˜ å°„çš„å†…å­˜åŒºåŸŸ\tmov mapped_addr(%rip), %rdi # ç›®æ ‡åœ°å€ (dst) = mapped_addr\tlea mmap_msg(%rip), %rsi # æºåœ°å€ (src) = message\tmov $mmap_msg_len, %rcx # å¤åˆ¶é•¿åº¦ (count) = msg_len\tcld # æ¸…é™¤æ–¹å‘æ ‡å¿—\trep movsb # å¾ªç¯å¤åˆ¶å­—èŠ‚\t# å…³é—­æ˜ å°„\tmov $11, %rax\tmov mapped_addr(%rip), %rdi\tmov $mmap_msg_len, %rsi\tsyscall\t# å…³é—­æ–‡ä»¶æè¿°ç¬¦\tmov $3, %rax\tmov fd(%rip), %rdi\tsyscall\t# é€€å‡ºç¨‹åº\tmov $60, %rax\txor %rdi, %rdi\tsyscallexit_error:\tmov %rax, %r12\tmov $1, %rax\tmov $2, %rdi\tlea errmsg(%rip), %rsi\tmov $errmsg_len, %rdx\tsyscall\tmov $60, %rax\tmov %r12, %rdi\tsyscall åˆ†æï¼š ä¸Šè¿°ä»£ç æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨sys_mmap ä¸sys_munmap å°†ä¸€ä¸ªæ–‡ä»¶æ˜ å°„åˆ°è¿›ç¨‹çš„å†…å­˜ç©ºé—´ã€‚ ç¨‹åºæœ€å¼€å§‹é€šè¿‡è°ƒç”¨open å’Œwrite ï¼Œå…ˆæ˜¯åˆ›å»ºäº†ç›®æ ‡æ–‡ä»¶ï¼Œç„¶åå‘è¯¥æ–‡ä»¶ä¸­å†™å…¥äº†ä¸€æ®µè¾ƒé•¿çš„å­—ç¬¦ä¸²ï¼Œå†…å®¹ä¸ºåå››ä¸ªç©ºä½\\0 ï¼Œç›®çš„æ˜¯ä¸ºäº†å…ˆå¡«å……æ–‡ä»¶å¤§å°è‡³14ä¸ªå­—èŠ‚ï¼Œä»¥é˜²æ­¢çˆ†å‡ºæ€»çº¿é”™è¯¯SIGBUSã€‚ ç¨‹åºåœ¨è°ƒç”¨mmap æ—¶å°†ç³»ç»Ÿè°ƒç”¨å·9ï¼ˆsys_mmapï¼‰å­˜å…¥%raxã€‚ç„¶åï¼Œå®ƒä¾æ¬¡å°†å„ä¸ªå‚æ•°åŠ è½½åˆ°ç›¸åº”çš„å¯„å­˜å™¨ï¼šaddr (%rdi)è®¾ä¸º0ï¼ˆNULLï¼‰ï¼Œè®©å†…æ ¸è‡ªåŠ¨é€‰æ‹©åœ°å€ï¼›length (%rsi)è®¾ä¸ºmsg_lenï¼›prot (%rdx)è®¾ä¸ºå¯è¯»å†™æƒé™ï¼›flags (%r10)è®¾ä¸ºMAP_SHAREDï¼›fd (%r8)è®¾ç½®ä¸ºå…ˆå‰æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ï¼›offset (%r9)è®¾ä¸º0ã€‚ç­‰æ•ˆä¸ºï¼š void * mapped_addr = mmap(NULL, msg_len, PROT_READ|PROT_WRITE, MAP_SHARED, fd, 0); æ‰§è¡Œsyscallåï¼Œå¦‚æœæˆåŠŸï¼Œ%raxä¸­å°†åŒ…å«æ˜ å°„åŒºåŸŸçš„èµ·å§‹åœ°å€ã€‚ç¨‹åºå°†è¿™ä¸ªåœ°å€ä¿å­˜èµ·æ¥ï¼Œç„¶åå¯ä»¥ä½¿ç”¨å®ƒæ¥è¯»å†™æ–‡ä»¶ï¼Œå°±åƒè¯»å†™æ™®é€šå†…å­˜ä¸€æ ·ã€‚ åœ¨æ‰§è¡Œå®Œä¸Šè¿°æ“ä½œä¹‹åï¼Œç¨‹åºåˆè°ƒç”¨äº†munmap å…³é—­äº†å‰é¢å»ºç«‹çš„æ˜ å°„ï¼Œå¹¶å…³é—­äº†æ•´ä¸ªç¨‹åºã€‚","tags":["Linux"]},{"title":"sys_lseek","path":"/2025/11/12/sys-lseek/","content":"sys_lseek ï¼ˆè°ƒç”¨å·ä¸º8ï¼‰æ˜¯ Linux ä¸­ä¸€ä¸ªç”¨äºæ“ä½œæ–‡ä»¶æè¿°ç¬¦è¯»å†™ä½ç½®çš„ç³»ç»Ÿè°ƒç”¨ã€‚å®ƒçš„æ ¸å¿ƒåŠŸèƒ½æ˜¯é‡æ–°å®šä½ï¼ˆç§»åŠ¨ï¼‰ä¸€ä¸ªå·²æ‰“å¼€æ–‡ä»¶çš„è¯»å†™åç§»é‡ï¼ˆoffsetï¼‰ã€‚è¿™ä¸ªåç§»é‡å†³å®šäº†ä¸‹ä¸€æ¬¡è¯»æˆ–å†™æ“ä½œå°†ä»æ–‡ä»¶çš„ä»€ä¹ˆä½ç½®å¼€å§‹ã€‚é€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥å®ç°æ–‡ä»¶çš„éšæœºè®¿é—®ï¼ˆå³è·³è½¬åˆ°æ–‡ä»¶ä»»æ„ä½ç½®è¿›è¡Œè¯»å†™ï¼‰ï¼Œè€Œä¸ä»…ä»…æ˜¯é¡ºåºè¯»å†™ã€‚ sys_lseek å‡½æ•°åŸå‹ off_t lseek(int fd, off_t offset, int whence); å‚æ•° fd: æ–‡ä»¶æè¿°ç¬¦ï¼ŒæŒ‡å‘ä¸€ä¸ªå·²æ‰“å¼€çš„æ–‡ä»¶ã€‚ offset: ç›¸å¯¹äº whence å‚æ•°çš„åç§»é‡ï¼Œä»¥å­—èŠ‚ä¸ºå•ä½ã€‚ whence: å†³å®šåç§»é‡è®¡ç®—èµ·ç‚¹çš„ä½ç½®ï¼Œå¯å–ä»¥ä¸‹å€¼ï¼š SEEK_SET (0): å°†åç§»é‡è®¾ç½®ä¸ºä»æ–‡ä»¶å¼€å§‹ç®—èµ·çš„ offset å­—èŠ‚ã€‚ SEEK_CUR (1): å°†åç§»é‡è®¾ç½®ä¸ºä»å½“å‰ä½ç½®ç®—èµ·åŠ ä¸Š offset å­—èŠ‚ï¼ˆoffset å¯ä¸ºè´Ÿæ•°ï¼Œè¡¨ç¤ºå‘å‰ç§»åŠ¨ï¼‰ã€‚ SEEK_END (2): å°†åç§»é‡è®¾ç½®ä¸ºä»æ–‡ä»¶æœ«å°¾ç®—èµ·åŠ ä¸Š offset å­—èŠ‚ï¼ˆoffset å¯ä¸ºè´Ÿæ•°ï¼Œè¡¨ç¤ºå‘å‰ç§»åŠ¨ï¼‰ã€‚ è¿”å›å€¼ æˆåŠŸæ—¶è¿”å›æ–°çš„ã€ç§»åŠ¨åçš„æ–‡ä»¶åç§»é‡ï¼ˆä»æ–‡ä»¶å¼€å¤´è®¡ç®—çš„å­—èŠ‚æ•°ï¼‰ã€‚ å¤±è´¥æ—¶è¿”å› -errnoï¼ˆå¦‚ EBADF ï¼ŒEINVAL ï¼‰ã€‚ ç”¨ä¾‹ .section .datafilename:\t.ascii /tmp/text.txt\\0content:\t.ascii HelloWorld\\0 # æ–‡ä»¶å†…å®¹\tlen = . - contentbuffer:\t.space 5 # ç”¨äºè¯»å–æ•°æ®çš„ç¼“å†²åŒº.section .text.globl _start_start:\t# 1. æ‰“å¼€æ–‡ä»¶ (sys_open)\tmov $2, %rax # ç³»ç»Ÿè°ƒç”¨å· (2 = sys_open)\tlea filename(%rip), %rdi # æ–‡ä»¶å\tmov $0101, %si # æ ‡å¿—ä½ (O_CREAT | O_WRONLY)\tmov $0666, %dx # æ¨¡å¼\tsyscall\tmov %rax, %r8 # ä¿å­˜æ–‡ä»¶æè¿°ç¬¦åˆ° %r8\t# 2. å†™å…¥å†…å®¹ content (sys_write)\tmov $1, %rax # ç³»ç»Ÿè°ƒç”¨å· (1 = sys_write)\tmov %r8, %rdi # æ–‡ä»¶æè¿°ç¬¦\tlea content(%rip), %rsi # è¦å†™å…¥çš„æ•°æ®\tmov $len, %rdx # æ•°æ®é•¿åº¦\tsyscall\t# 3. å…³é—­æ–‡ä»¶ (sys_close)\tmov $3, %rax # ç³»ç»Ÿè°ƒç”¨å· (3 = sys_close)\tmov %r8, %rdi\tsyscall\t# 4. é‡æ–°ä»¥åªè¯»æ–¹å¼æ‰“å¼€æ–‡ä»¶ (sys_open)\tmov $2, %rax\tlea filename(%rip), %rdi\txor %rsi, %rsi # æ ‡å¿—ä½ (O_RDONLY)\tsyscall\tmov %rax, %r8 # ä¿å­˜æ–°çš„æ–‡ä»¶æè¿°ç¬¦\t# 5. ä½¿ç”¨ sys_lseek è·³è½¬åˆ°ç¬¬6ä¸ªå­—èŠ‚ï¼ˆWçš„ä½ç½®ï¼‰\tmov $8, %rax # ç³»ç»Ÿè°ƒç”¨å· (8 = sys_lseek)\tmov %r8, %rdi # æ–‡ä»¶æè¿°ç¬¦\tmov $5, %rsi # offset = 5 (ä»èµ·ç‚¹åç¬¬5ä¸ªå­—èŠ‚ï¼Œå³ç¬¬6ä¸ª)\tmov $0, %rdx # whence = SEEK_SET (0)\tsyscall\t# 6. ä»æ–°ä½ç½®è¯»å–5ä¸ªå­—èŠ‚ (sys_read)\tmov $0, %rax # ç³»ç»Ÿè°ƒç”¨å· (0 = sys_read)\tmov %r8, %rdi\tlea buffer(%rip), %rsi # è¯»å–ç¼“å†²åŒº\tmov $5, %rdx # è¯»å–5ä¸ªå­—èŠ‚\tsyscall\t# 7. å°†è¯»å–åˆ°çš„å†…å®¹è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡º (sys_write)\tmov $1, %rax\tmov $1, %rdi # æ–‡ä»¶æè¿°ç¬¦ (1 = stdout)\tlea buffer(%rip), %rsi\tmov $5, %rdx\tsyscall\t# 8. å…³é—­æ–‡ä»¶å¹¶é€€å‡º\tmov $3, %rax # sys_close\tmov %r8, %rdi\tsyscall\tmov $60, %rax # sys_exit\txor %rdi, %rdi\tsyscall åˆ†æï¼š ä¸Šè¿°ä»£ç æ¼”ç¤ºäº† sys_lseek çš„ä¸€ä¸ªå…¸å‹ç”¨æ³•ï¼šè·³è½¬åˆ°æ–‡ä»¶ä¸­é—´è¿›è¡Œè¯»å–ã€‚ ç¨‹åºé¦–å…ˆåˆ›å»ºå¹¶æ‰“å¼€ä¸€ä¸ªåä¸º test.txt çš„æ–‡ä»¶ï¼Œå†™å…¥å­—ç¬¦ä¸² HelloWorldï¼ˆå…± 10 å­—èŠ‚ï¼‰ï¼Œç„¶åå…³é—­å®ƒã€‚ç„¶åï¼Œé‡æ–°ä»¥åªè¯»æ¨¡å¼æ‰“å¼€è¯¥æ–‡ä»¶ã€‚æ­¤æ—¶æ–‡ä»¶åç§»é‡åœ¨å¼€å¤´ (0)ã€‚æ­¤æ—¶ï¼Œç¨‹åºå¼€å§‹è°ƒç”¨ sys_lseekã€‚æˆ‘ä»¬é¦–å…ˆå°†ï¼Œç³»ç»Ÿè°ƒç”¨å· 8 å­˜å…¥ %rax ï¼Œæ–‡ä»¶æè¿°ç¬¦å­˜å…¥ %rdi ï¼Œåç§»é‡ 5 å­˜å…¥ %rsiï¼ˆæˆ‘ä»¬å¸Œæœ›è·³è¿‡å‰5ä¸ªå­—èŠ‚ Helloï¼‰ï¼Œwhence å‚æ•° SEEK_SET (0) å­˜å…¥ %rdxï¼Œè¡¨ç¤ºä»æ–‡ä»¶å¼€å¤´è®¡ç®—åç§»ã€‚ æ‰§è¡Œåï¼Œæ–‡ä»¶åç§»é‡è¢«è®¾ç½®ä¸º 5ã€‚ç´§æ¥ç€è°ƒç”¨ sys_readï¼Œå®ƒä¼šä»æ–°çš„åç§»é‡ï¼ˆç¬¬ 5 å­—èŠ‚åï¼Œå³ç¬¬ 6 ä¸ªå­—èŠ‚ï¼‰å¼€å§‹è¯»å–ã€‚è¿™é‡Œè¯»å–äº† 5 ä¸ªå­—èŠ‚ï¼Œå†…å®¹å°†æ˜¯ Worldã€‚éšåï¼Œç¨‹åºå¼€å§‹å°†è¿™ä¸ªç»“æœ World å†™å…¥æ ‡å‡†è¾“å‡ºã€‚æœ€ç»ˆæ•ˆæœæ˜¯ï¼Œç¨‹åºæ²¡æœ‰è¯»å–æ–‡ä»¶çš„å¼€å¤´ï¼Œè€Œæ˜¯ç›´æ¥è¯»å–å¹¶è¾“å‡ºäº†æ–‡ä»¶çš„ååŠéƒ¨åˆ†ã€‚","tags":["Linux"]},{"title":"sys_poll","path":"/2025/11/12/sys-poll/","content":"sys_poll ï¼ˆå³è°ƒç”¨å·ä¸º7çš„pollç³»ç»Ÿè°ƒç”¨ï¼‰æ˜¯ Linux ä¸­ä¸€ä¸ªéå¸¸é‡è¦çš„ç³»ç»Ÿè°ƒç”¨ï¼Œç”¨äºæ£€æµ‹å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œçœ‹å®ƒä»¬æ˜¯å¦å‡†å¤‡å¥½å»è¿›è¡ŒæŸç§ç±»å‹çš„ IO æ“ä½œï¼ˆæ¯”å¦‚æ˜¯å¦å¯è¯»ã€å¯å†™ç­‰ï¼‰ã€‚å®ƒæ˜¯ä¸€ç§å®ç° IO å¤šè·¯å¤ç”¨çš„é«˜æ•ˆæ–¹æ³•ï¼Œå…è®¸ä¸€ä¸ªç¨‹åºåŒæ—¶ç­‰å¾…å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè€Œä¸éœ€è¦ä¸ºæ¯ä¸ªæ–‡ä»¶æè¿°ç¬¦åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ã€‚ sys_poll å‡½æ•°åŸå‹ int poll(struct pollfd *fds, nfds_t nfds, int timeout); å‚æ•° fds: æŒ‡å‘ struct pollfd æ•°ç»„çš„æŒ‡é’ˆï¼Œæ¯ä¸ªå…ƒç´ ä½œä¸ºä¸€ä¸ªç»“æ„ä½“æè¿°ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦åŠå…¶å…³å¿ƒçš„äº‹ä»¶ã€‚è¿™ä¸ªç»“æ„ä½“æœ¬èº«è¢«å®šä¹‰ä¸ºï¼š struct pollfd int fd; // è¦ç›‘æ§çš„æ–‡ä»¶æè¿°ç¬¦*short events; //* å…³æ³¨çš„äº‹ä»¶ä½æ©ç *short revents; //* å†…æ ¸è¿”å›çš„äº‹ä»¶ä½æ©ç ï¼ˆç”±ç³»ç»Ÿè°ƒç”¨å¡«å†™ï¼‰; å…¶ä¸­ï¼Œevents å¸¸å¸¸ä½¿ç”¨å®æ¥å¡«å†™ã€‚è¿™äº›è¡¨ç¤ºäº‹ä»¶çš„å®å®šä¹‰å¦‚ä¸‹ï¼š å® å€¼ (16 è¿›åˆ¶) è¯´æ˜ POLLIN 0x0001 æ–‡ä»¶å¯è¯»ï¼ˆåŒ…æ‹¬æ™®é€šæ•°æ®æˆ–é«˜ä¼˜å…ˆçº§æ•°æ®ï¼‰ POLLPRI 0x0002 é«˜ä¼˜å…ˆçº§æ•°æ®å¯è¯»ï¼ˆä¾‹å¦‚å¸¦å¤–æ•°æ®ï¼‰ POLLOUT 0x0004 æ–‡ä»¶å¯å†™ POLLERR 0x0008 é”™è¯¯æ¡ä»¶å‘ç”Ÿï¼ˆç³»ç»Ÿè®¾ç½®ï¼‰ POLLHUP 0x0010 å¯¹ç«¯æŒ‚æ–­æˆ– FIFO æ–‡ä»¶å…³é—­ POLLNVAL 0x0020 æ–‡ä»¶æè¿°ç¬¦æ— æ•ˆ POLLRDNORM 0x0040 æ™®é€šæ•°æ®å¯è¯»ï¼ˆç±»ä¼¼ POLLINï¼‰ POLLRDBAND 0x0080 å¸¦å¤–ä¼˜å…ˆçº§æ•°æ®å¯è¯» POLLWRNORM 0x0100 æ™®é€šå¯å†™ï¼ˆç±»ä¼¼ POLLOUTï¼‰ POLLWRBAND 0x0200 å¸¦å¤–ä¼˜å…ˆçº§æ•°æ®å¯å†™ POLLMSG 0x0400 æ¶ˆæ¯å¯ç”¨ï¼ˆä¸»è¦ç”¨äºæ¶ˆæ¯é˜Ÿåˆ—ï¼ŒPOSIXï¼‰ POLLREMOVE 0x1000 ç›‘æ§å¯¹è±¡è¢«ç§»é™¤ï¼ˆå†…æ ¸ä½¿ç”¨ï¼‰ POLLONESHOT 0x8000 ä»…è§¦å‘ä¸€æ¬¡äº‹ä»¶ï¼Œä¹‹åè‡ªåŠ¨æ¸…é™¤ï¼ˆå†…æ ¸ä½¿ç”¨ï¼‰ nfds: ä¼ å…¥çš„æ•°ç»„ä¸­å…ƒç´ çš„æ•°é‡ timeout: ç­‰å¾…äº‹ä»¶çš„è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ï¼Œ-1 è¡¨ç¤ºæ— é™ç­‰å¾…ï¼Œ0 è¡¨ç¤ºç«‹å³è¿”å› è¿”å›å€¼ æˆåŠŸæ—¶è¿”å›å‘ç”Ÿäº‹ä»¶çš„æ–‡ä»¶æè¿°ç¬¦æ•°é‡ï¼ˆéè´Ÿæ•´æ•°ï¼‰ å¤±è´¥æ—¶è¿”å› -errnoï¼ˆå¦‚ EINVAL, EFAULT, EBADFï¼‰ ç”¨ä¾‹ .equ POLLIN, 0x0001 .section .datafds:\t# å®šä¹‰ä¸€ä¸ª pollfd æ•°ç»„ï¼Œç›‘æ§æ–‡ä»¶æè¿°ç¬¦ 0 (stdin) æ˜¯å¦å¯è¯»\t.long 0 # fd = 0 (stdin)\t.short POLLIN # events = POLLIN (å¯è¯»äº‹ä»¶)\t.short 0x0000 # revents (å†…æ ¸å¡«å†™ï¼Œåˆå§‹ä¸º 0)timeout:\t.long 5000 # ç­‰å¾… 5000 æ¯«ç§’ï¼ˆ5 ç§’ï¼‰\t.section .text\t.globl _start_start:\t# è°ƒç”¨ sys_poll ç›‘æ§ stdin æ˜¯å¦æœ‰å¯è¯»äº‹ä»¶\tmov $7, %rax # ç³»ç»Ÿè°ƒç”¨å· (7 = sys_poll)\tlea fds(%rip), %rdi # struct pollfd *fds\tmov $1, %rsi # nfds = 1 (æ•°ç»„ä¸­åªæœ‰ä¸€ä¸ªå…ƒç´ )\tlea timeout(%rip), %rdx # timeout = 5000 ms\tsyscall # æ‰§è¡Œç³»ç»Ÿè°ƒç”¨\t# é€€å‡ºç¨‹åº\tmov $60, %rax # ç³»ç»Ÿè°ƒç”¨å· (60 = sys_exit)\txor %rdi, %rdi # return 0\tsyscall åˆ†æï¼š ä¸Šè¿°ä»£ç æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ sys_poll ç›‘æ§æ ‡å‡†è¾“å…¥ï¼ˆstdinï¼Œæ–‡ä»¶æè¿°ç¬¦ 0ï¼‰æ˜¯å¦å¯è¯»ã€‚ ç¨‹åºé¦–å…ˆåœ¨ .data æ®µå®šä¹‰äº†ä¸€ä¸ª struct pollfd æ•°ç»„ fdsï¼š fd å­—æ®µè®¾ä¸º 0ï¼Œè¡¨ç¤ºæ ‡å‡†è¾“å…¥ events å­—æ®µè®¾ä¸º POLLINï¼Œè¡¨ç¤ºå…³æ³¨å¯è¯»äº‹ä»¶ revents å­—æ®µåˆå§‹åŒ–ä¸º 0ï¼Œç³»ç»Ÿè°ƒç”¨è¿”å›æ—¶å†…æ ¸ä¼šå†™å…¥å®é™…å‘ç”Ÿçš„äº‹ä»¶ timeout å­—æ®µè¢«è®¾ä¸º 5000ï¼Œè¡¨ç¤ºæœ€å¤šç­‰å¾… 5 ç§’ã€‚ç”±äºæˆ‘ä»¬åªå®šä¹‰äº†ä¸€ä¸ªç»“æ„ä½“ï¼Œfds ä»…ä»…æ˜¯ä¸€ä¸ªæŒ‡å‘ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œè€Œä¸æŒ‡å‘ä¸€ä¸ªæ•°ç»„ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†æ•°ç»„é•¿åº¦nfds è®¾ç½®ä¸º1 ã€‚è¿™æ ·ä¸€æ¥ï¼Œè¿è¡Œåˆ°ç¬¬ä¸€ä¸ªsyscall æ—¶ï¼Œç³»ç»Ÿè°ƒç”¨å¤§è‡´ä¸Šå¯ä»¥ç­‰æ•ˆä¸ºï¼š poll(fds, 1, 5000); ç¨‹åºæœ€åè°ƒç”¨ sys_exit ç³»ç»Ÿè°ƒç”¨æ­£å¸¸é€€å‡ºï¼Œè¿”å›å€¼ 0 è¡¨ç¤ºæˆåŠŸã€‚ é€šè¿‡è¿™ç§æ–¹å¼ï¼Œsys_poll å¯ä»¥æœ‰æ•ˆåœ°åœ¨å•çº¿ç¨‹ä¸­åŒæ—¶ç›‘æ§å¤šä¸ª IO äº‹ä»¶ï¼Œå¸¸ç”¨äºå®ç°äº‹ä»¶å¾ªç¯æˆ–éé˜»å¡ IOã€‚","tags":["Linux"]},{"title":"sys_stat, sys_fstat ä»¥åŠ sys_lstat","path":"/2025/11/12/sys-stat-sys-fstat-ä»¥åŠ-sys-lstat/","content":"sys_stat ï¼ˆè°ƒç”¨å·ä¸º4ï¼‰ã€sys_fstat ï¼ˆè°ƒç”¨å·ä¸º5ï¼‰å’Œ sys_lstat ï¼ˆè°ƒç”¨å·ä¸º6ï¼‰æ˜¯ Linux ç³»ç»Ÿä¸­çš„ä¸‰ä¸ªåŸºæœ¬æ–‡ä»¶çŠ¶æ€æŸ¥è¯¢ç³»ç»Ÿè°ƒç”¨ï¼Œç”¨äºè·å–æ–‡ä»¶çš„å…ƒä¿¡æ¯ï¼ˆå¦‚å¤§å°ã€æƒé™ã€æ—¶é—´æˆ³ç­‰ï¼‰ã€‚ è¿™ä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨è™½ç„¶éƒ½ç”¨äºè·å–æ–‡ä»¶å…ƒä¿¡æ¯ï¼Œä½†ä¸‰è€…ä»ç„¶å­˜åœ¨æ˜æ˜¾çš„ä¸åŒã€‚sys_stat å’Œsys_lstatéƒ½æ˜¯é€šè¿‡æ–‡ä»¶çš„è·¯å¾„å¯¹æ–‡ä»¶è¿›è¡Œè®¿é—®çš„ï¼Œè€Œsys_fstat å´æ˜¯é€šè¿‡æ–‡ä»¶æè¿°ç¬¦fd å¯¹æŸä¸€æ–‡ä»¶è¿›è¡Œè®¿é—®ã€‚ä¸sys_statç›¸æ¯”ï¼Œsys_lstat è™½ç„¶ä¹Ÿé€šè¿‡æ–‡ä»¶çš„è·¯å¾„å¯¹æ–‡ä»¶è¿›è¡Œè®¿é—®ï¼Œä½†åœ¨å¤„ç†ç¬¦å·é“¾æ¥çš„æ–¹å¼ä¸Šæœ‰å¾ˆå¤§çš„åŒºåˆ«ã€‚å‰è€…æŸ¥è¯¢åˆ°ç¬¦å·é“¾æ¥æ—¶ï¼Œä¼šå¯¹å…¶æ‰€æŒ‡å‘çš„é‚£ä¸ªç›®æ ‡æ–‡ä»¶è¿›è¡ŒæŸ¥è¯¢ï¼›è€Œåè€…åˆ™ä¼šå¯¹ç¬¦å·é“¾æ¥è¿™ä¸ªæ–‡ä»¶æœ¬èº«è¿›è¡ŒæŸ¥è¯¢ï¼Œå¹¶ä¸ä¼šé‡å®šå‘è‡³ç¬¦å·é“¾æ¥æ‰€æŒ‡å‘çš„é‚£ä¸ªæ–‡ä»¶ã€‚ æ— è®ºæ˜¯è¿™ä¸‰è€…ä¸­çš„å“ªä¸€ä¸ªï¼Œè¿”å›å…ƒä¿¡æ¯çš„ç»“æ„ä½“struct stat çš„å®šä¹‰éƒ½æ˜¯ä¸€è‡´çš„ã€‚struct stat è¢«å®šä¹‰ä¸ºï¼š struct stat dev_t st_dev; /* æ–‡ä»¶æ‰€åœ¨è®¾å¤‡å· */ ino_t st_ino; /* æ–‡ä»¶ i-node å· */ nlink_t st_nlink; /* ç¡¬é“¾æ¥æ•° */ mode_t st_mode; /* æ–‡ä»¶ç±»å‹ä¸æƒé™æ¨¡å¼ */ uid_t st_uid; /* æ‰€æœ‰è€…ç”¨æˆ· ID */ gid_t st_gid; /* æ‰€æœ‰è€…ç»„ ID */ dev_t st_rdev; /* ç‰¹æ®Šæ–‡ä»¶çš„è®¾å¤‡å·ï¼ˆå­—ç¬¦/å—è®¾å¤‡ï¼‰ */ off_t st_size; /* æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰ */ blksize_t st_blksize; /* æ–‡ä»¶ç³»ç»Ÿ I/O å—å¤§å° */ blkcnt_t st_blocks; /* åˆ†é…çš„å—æ•° */ /* æ—¶é—´æˆ³ */ struct timespec st_atim; /* æœ€åè®¿é—®æ—¶é—´ */ struct timespec st_mtim; /* æœ€åä¿®æ”¹æ—¶é—´ */ struct timespec st_ctim; /* i-node çŠ¶æ€æ”¹å˜æ—¶é—´ */; sys_stat å‡½æ•°åŸå‹ int stat(const char *pathname, struct stat *statbuf); å‚æ•° pathname: è¦æŸ¥è¯¢çš„æ–‡ä»¶è·¯å¾„ï¼ˆå­—ç¬¦ä¸²ï¼‰ statbuf: æŒ‡å‘ struct stat ç»“æ„çš„æŒ‡é’ˆï¼Œç”¨äºå­˜å‚¨æ–‡ä»¶ä¿¡æ¯ è¿”å›å€¼ æˆåŠŸæ—¶è¿”å› 0 å¤±è´¥æ—¶è¿”å› errnoï¼ˆå¦‚ ENOENT, EACCES, ENOTDIRï¼‰ sys_fstat å‡½æ•°åŸå‹ int fstat(int fd, struct stat *statbuf); å‚æ•° fd: å·²æ‰“å¼€æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ statbuf: æŒ‡å‘ struct stat ç»“æ„çš„æŒ‡é’ˆï¼Œç”¨äºå­˜å‚¨æ–‡ä»¶ä¿¡æ¯ è¿”å›å€¼ æˆåŠŸæ—¶è¿”å› 0 å¤±è´¥æ—¶è¿”å› errnoï¼ˆå¦‚ EBADF, EFAULTï¼‰ sys_lstat å‡½æ•°åŸå‹ int lstat(const char *pathname, struct stat *statbuf); å‚æ•° pathname: è¦æŸ¥è¯¢çš„æ–‡ä»¶è·¯å¾„ï¼ˆå­—ç¬¦ä¸²ï¼‰ statbuf: æŒ‡å‘ struct stat ç»“æ„çš„æŒ‡é’ˆï¼Œç”¨äºå­˜å‚¨æ–‡ä»¶ä¿¡æ¯ è¿”å›å€¼ æˆåŠŸæ—¶è¿”å› 0 å¤±è´¥æ—¶è¿”å› errnoï¼ˆå¦‚ ENOENT, EACCES, ENOTDIRï¼‰ ç”¨ä¾‹ .equ SYS_STAT, 4 # sys_stat ç³»ç»Ÿè°ƒç”¨å·\t.equ SYS_FSTAT, 5 # sys_fstat ç³»ç»Ÿè°ƒç”¨å·\t.equ SYS_LSTAT, 6 # sys_lstat ç³»ç»Ÿè°ƒç”¨å·\t.section .datafilename:\t.ascii /tmp/test.txtstatbuf:\t.space 144 # struct stat é€šå¸¸ä¸º 144 å­—èŠ‚ï¼ˆx86-64ï¼‰\t.section .text\t.globl _start_start:\t# ä½¿ç”¨ sys_stat æŸ¥è¯¢æ–‡ä»¶çŠ¶æ€\tmov $SYS_STAT, %rax\tlea filename(%rip), %rdi\tlea statbuf(%rip), %rsi\tsyscall\t# ä½¿ç”¨ sys_fstat æŸ¥è¯¢å·²æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦çŠ¶æ€\t# å‡è®¾æ–‡ä»¶æè¿°ç¬¦ä¿å­˜åœ¨ %r8\tmov $SYS_FSTAT, %rax\tmov %r8, %rdi\tlea statbuf(%rip), %rsi\tsyscall\t# ä½¿ç”¨ sys_lstat æŸ¥è¯¢ç¬¦å·é“¾æ¥çŠ¶æ€\tmov $SYS_LSTAT, %rax\tlea filename(%rip), %rdi\tlea statbuf(%rip), %rsi\tsyscall\t# é€€å‡º\tmov $60, %rax\txor %rdi, %rdi\tsyscall åˆ†æï¼š sys_stat æ ¹æ®æ–‡ä»¶è·¯å¾„è·å–ç›®æ ‡æ–‡ä»¶çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¦‚æœè·¯å¾„æ˜¯ç¬¦å·é“¾æ¥ï¼Œå®ƒè¿”å›é“¾æ¥æŒ‡å‘æ–‡ä»¶çš„ä¿¡æ¯ã€‚ sys_fstat ç›´æ¥é€šè¿‡æ–‡ä»¶æè¿°ç¬¦è·å–æ–‡ä»¶çŠ¶æ€ï¼Œä¸ä¾èµ–æ–‡ä»¶è·¯å¾„ã€‚ sys_lstat ç±»ä¼¼äº statï¼Œä½†å¦‚æœè·¯å¾„æ˜¯ç¬¦å·é“¾æ¥ï¼Œå®ƒè¿”å›é“¾æ¥æœ¬èº«çš„ä¿¡æ¯è€Œä¸æ˜¯ç›®æ ‡æ–‡ä»¶ã€‚ åœ¨æ±‡ç¼–ä¸­ï¼Œè¿™ä¸‰ä¸ªç³»ç»Ÿè°ƒç”¨éƒ½é€šè¿‡ %rax æŒ‡å®šç³»ç»Ÿè°ƒç”¨å·ï¼Œæ–‡ä»¶è·¯å¾„æˆ–æ–‡ä»¶æè¿°ç¬¦é€šè¿‡ %rdiï¼Œstruct stat ç»“æ„æŒ‡é’ˆé€šè¿‡ %rsiï¼Œè°ƒç”¨ syscall æŒ‡ä»¤æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ï¼Œè¿”å›å€¼å­˜æ”¾åœ¨ %raxï¼šæˆåŠŸä¸º 0ï¼Œå¤±è´¥ä¸º -errnoã€‚","tags":["Linux"]},{"title":"sys_open ä¸ sys_close","path":"/2025/11/12/sys-open-ä¸-sys-close/","content":"sys_openï¼ˆå³è°ƒç”¨å·ä¸º2çš„ç³»ç»Ÿè°ƒç”¨ï¼‰ä¸sys_closeï¼ˆå³è°ƒç”¨å·ä¸º3çš„ç³»ç»Ÿè°ƒç”¨ï¼‰æ˜¯ Linux ä¸­çš„ä¸¤ä¸ªåŸºæœ¬ç³»ç»Ÿè°ƒç”¨ï¼Œç”¨äºå¯¹æ–‡ä»¶æè¿°ç¬¦è¿›è¡Œç›¸å…³æ“ä½œã€‚ sys_openä¼šå°†è¢«æ‰“å¼€çš„æ–‡ä»¶è·¯å¾„è½¬æ¢ä¸ºæ–‡ä»¶æè¿°ç¬¦int fdï¼Œè¯¥æè¿°ç¬¦å¯ç”¨äºåç»­çš„è¯»å†™æ“ä½œã€‚ sys_open å‡½æ•°åŸå‹ int open(const char * pathname, int flags, mode_t mode); å‚æ•° pathname: è¦æ‰“å¼€çš„æ–‡ä»¶è·¯å¾„ï¼ˆå­—ç¬¦ä¸²ï¼‰ flags: æ‰“å¼€æ ‡å¿—ï¼ŒæŒ‡å®šæ–‡ä»¶çš„æ‰“å¼€æ–¹å¼ï¼ˆå…·ä½“è¯´æ˜è§ä¸‹ï¼‰ mode: åˆ›å»ºæ–‡ä»¶æ—¶çš„æƒé™æ¨¡å¼ï¼ˆä»…åœ¨ä½¿ç”¨O_CREATæ—¶æœ‰æ•ˆï¼‰ï¼ˆå…·ä½“è¯´æ˜è§ä¸‹ï¼‰ è¿”å›å€¼ æˆåŠŸæ—¶è¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼ˆéè´Ÿæ•´æ•°fdï¼‰ å¤±è´¥æ—¶è¿”å›-errnoï¼ˆå¦‚ENOENT, EACCES, EMFILEï¼‰ sys_close å‡½æ•°åŸå‹ int close(int fd); å‚æ•° fd : è¦å…³é—­çš„æ–‡ä»¶æè¿°ç¬¦ è¿”å›å€¼ æˆåŠŸæ—¶è¿”å›0 å¤±è´¥æ—¶è¿”å›-errnoï¼ˆå¦‚EBADF, EINTR, EIOï¼‰ flagsçš„å®šä¹‰ flags çš„èµ‹å€¼é€šå¸¸æ˜¯ç”±â€œåŸºæœ¬è®¿é—®æ¨¡å¼â€ä¸â€œé™„åŠ æ ‡å¿—â€é€šè¿‡æˆ–é€»è¾‘æ‰€é™„åŠ è€Œæ¥çš„ã€‚åœ¨ Linux çš„å¤´æ–‡ä»¶fcntl.h ä¸­ï¼Œè¿™äºŒè€…çš„å®šä¹‰å¦‚ä¸‹ï¼š åŸºæœ¬è®¿é—®æ¨¡å¼ å®å®šä¹‰ å€¼ å«ä¹‰ O_RDONLY 0 åªè¯»æ‰“å¼€ O_WRONLY 1 åªå†™æ‰“å¼€ O_RDWR 2 è¯»å†™æ‰“å¼€ é™„åŠ æ ‡å¿— å®å®šä¹‰ å€¼ï¼ˆå…«è¿›åˆ¶ï¼‰ å€¼ï¼ˆåå…­è¿›åˆ¶ï¼‰ è¯´æ˜ O_CREAT 0000100 0x40 æ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»º O_EXCL 0000200 0x80 å’ŒO_CREAT ä¸€èµ·ç”¨ï¼Œæ–‡ä»¶å­˜åœ¨åˆ™å¤±è´¥ O_NOCTTY 0000400 0x100 ä¸æŠŠæ–‡ä»¶ä½œä¸ºæ§åˆ¶ç»ˆç«¯ O_TRUNC 0001000 0x200 æˆªæ–­å·²å­˜åœ¨æ–‡ä»¶ä¸º0é•¿åº¦ O_APPEND 0002000 0x400 å†™æ“ä½œè¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ O_NONBLOCK 0004000 0x800 éé˜»å¡ IO O_NDELAY 0004000 0x800 ä¸O_NONBLOCKç›¸åŒ O_DSYNC 0010000 0x1000 æ•°æ®åŒæ­¥å†™å…¥ O_SYNC 04010000 0x101000 æ•°æ®+å…ƒæ•°æ®åŒæ­¥å†™å…¥ O_RSYNC 04010000 0x101000 ä¸O_SYNCç›¸åŒï¼ˆå…¼å®¹ï¼‰ FASYNC 0020000 0x2000 å¼‚æ­¥é€šçŸ¥ O_DIRECT 0040000 0x4000 ç›´æ¥ IOï¼Œç»•è¿‡å†…æ ¸ç¼“å­˜ O_LARGEFILE 00100000 0x8000 å¤§æ–‡ä»¶æ”¯æŒï¼ˆ32ä½ï¼‰ O_DIRECTORY 00200000 0x10000 å¿…é¡»æ˜¯ç›®å½•ï¼Œå¦åˆ™å‡ºé”™ O_NOFOLLOW 00400000 0x20000 ä¸è·Ÿéšç¬¦å·é“¾æ¥ O_NOATIME 01000000 0x40000 ä¸æ›´æ–°æ—¶é—´æˆ³ O_CLOEXEC 02000000 0x80000 è®¾ç½®FD_CLOEXECï¼Œexec æ—¶å…³é—­ O_PATH 010000000 0x200000 åªè·å–è·¯å¾„å¼•ç”¨ï¼Œä¸æ‰“å¼€æ–‡ä»¶ O_TMPFILE 020000000 0x400000 åˆ›å»ºåŒ¿åä¸´æ—¶æ–‡ä»¶ï¼ˆéœ€O_DIRECTORYï¼‰ O_TMPFILE_MASK 03777700000 - å†…éƒ¨æ©ç ï¼Œç”¨äºå±è”½O_TMPFILE ä¸Šè¿°æ‰€æœ‰å®åœ¨ç»™æŸä¸€flags èµ‹å€¼æ—¶ï¼Œä½¿ç”¨æŒ‰ä½æˆ–è¿ç®—ç¬¦|è¿›è¡Œè¿æ¥ã€‚å¦‚ï¼š int flags = O_WRONLY | O_CREAT; è¯¥flags æ„ä¸ºï¼šæ‰“å¼€æ–‡ä»¶æ—¶é‡‡ç”¨åªå†™æ¨¡å¼ï¼›ä¸”å¦‚æœæ–‡ä»¶ä¸å­˜åœ¨ï¼Œåˆ™è‡ªåŠ¨åˆ›å»ºä¹‹ã€‚ å¯ä»¥æƒ³åˆ°ï¼ŒåŸºæœ¬è®¿é—®æ¨¡å¼è¿™ä¸‰è€…åªèƒ½ç‹¬ç«‹å­˜åœ¨ï¼Œä¸èƒ½åŒæ—¶å­˜åœ¨äºä¸€ä¸ªè¡¨è¾¾å¼ä¸­ã€‚ æƒé™æ¨¡å¼çš„å®šä¹‰ Unix ç³»ç»Ÿçš„æƒé™æ¨¡å¼ç”±ä¸‰ä¸ªéƒ¨åˆ†æ‰€ç»„æˆï¼šæ‰€æœ‰è€…ï¼ˆownerï¼‰çš„æƒé™ã€æ‰€æœ‰è€…æ‰€åœ¨ç”¨æˆ·ç»„ä¸­çš„å…¶ä»–ç”¨æˆ·ï¼ˆgroupï¼‰çš„æƒé™ã€éä»¥ä¸Šç”¨æˆ·çš„å…¶ä»–ç”¨æˆ·ï¼ˆothersï¼‰çš„æƒé™ï¼Œé€šè¿‡æ•°å­—è¿›è¡ŒåŒºåˆ†ã€‚ Unix ç³»ç»Ÿçš„æƒé™ä¸»è¦æœ‰ä¸‰ç§ï¼šè¯»ï¼ˆrï¼‰ã€å†™ï¼ˆwï¼‰ã€æ‰§è¡Œï¼ˆxï¼‰ã€‚å¦‚ä¸‹ï¼š æƒé™ äºŒè¿›åˆ¶ å…«è¿›åˆ¶ --- 000 0 --x 001 1 -w- 010 2 -wx 011 3 r-- 100 4 r-x 101 5 rw- 110 6 rwx 111 7 å…¶ä¸­- è¡¨ç¤ºç”¨æˆ·ä¸å…·æœ‰æŸä¸€ç§æƒé™ã€‚æ¯ä¸€ç±»ç”¨æˆ·é€šè¿‡å…«è¿›åˆ¶æ•°æ¥è¡¨ç¤ºè‡ªèº«çš„æƒé™ã€‚ä¸‰ç±»ç”¨æˆ·çš„æ’åˆ—é¡ºåºä¸ºï¼šowner-group-others ã€‚ å¦‚ä¸€ä¸ªæ–‡ä»¶å¯¹æ‰€æœ‰ç”¨æˆ·å¯è¯»ã€å¯å†™ã€å¯æ‰§è¡Œï¼Œé‚£ä¹ˆå®ƒçš„æƒé™æ¨¡å¼ä¸ºï¼š rwxrwxrwx ï¼Œäº¦å³0777ã€‚ ç”¨ä¾‹ .equ FLAGS, 0x241 # O_WRONLY | O_CREAT | O_TRUNC .section .datafilename:\t.asciz /tmp/test.txt # è¦æ‰“å¼€çš„æ–‡ä»¶è·¯å¾„buffer:\t.ascii Hello from sys_open! \\0\tbuffer_len = . - buffer\t.section .text\t.globl _start_start: # è°ƒç”¨ sys_open åˆ›å»º/æ‰“å¼€æ–‡ä»¶ mov $2, %rax # ç³»ç»Ÿè°ƒç”¨å· (2 = sys_open) lea filename(%rip), %rdi # const char *pathname = filename mov $FLAGS, %rsi # é€šè¿‡å®å®šä¹‰ç»™ flags èµ‹å€¼ mov $0644, %rdx # mode = 0644 (rw-r--r--) syscall # æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ # ä¿å­˜æ–‡ä»¶æè¿°ç¬¦ mov %rax, %r8 # ä¿å­˜æ–‡ä»¶æè¿°ç¬¦åˆ° %r8 # ä½¿ç”¨ sys_write å‘æ–‡ä»¶å†™å…¥æ•°æ® mov $1, %rax # ç³»ç»Ÿè°ƒç”¨å· (1 = sys_write) mov %r8, %rdi # ä½¿ç”¨åˆšæ‰æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ lea buffer(%rip), %rsi # const void *buf = buffer mov $buffer_len, %rdx # count = buffer_len syscall # æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ # ä½¿ç”¨ sys_close å…³é—­æ–‡ä»¶ mov $3, %rax # ç³»ç»Ÿè°ƒç”¨å· (3 = sys_close) mov %r8, %rdi # å…³é—­æ–‡ä»¶æè¿°ç¬¦ syscall # æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ # é€€å‡º mov $60, %rax # ç³»ç»Ÿè°ƒç”¨å· (60 = sys_exit) xor %rdi, %rdi # return 0 syscall åˆ†æï¼š ä¸Šè¿°ä»£ç æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨sys_openç³»ç»Ÿè°ƒç”¨åˆ›å»ºå¹¶æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œå†™å…¥æ“ä½œã€‚ ç¨‹åºé¦–å…ˆå®šä¹‰äº†è¦æ‰“å¼€çš„æ–‡ä»¶è·¯å¾„filenameå’Œè¦å†™å…¥çš„æ•°æ®bufferã€‚åœ¨_startæ ‡ç­¾å¤„ï¼Œç¨‹åºå°†ç³»ç»Ÿè°ƒç”¨å·2ï¼ˆsys_openï¼‰å­˜å…¥%raxå¯„å­˜å™¨ï¼Œå°†æ–‡ä»¶è·¯å¾„åœ°å€åŠ è½½åˆ°%rdiï¼Œè®¾ç½®æ‰“å¼€æ ‡å¿—ä¸º0x241ï¼ˆO_WRONLY | O_CREAT | O_TRUNCï¼Œè¡¨ç¤ºåªå†™ã€å¦‚ä¸å­˜åœ¨åˆ™åˆ›å»ºã€æˆªæ–­ä¸º0é•¿åº¦ï¼‰ï¼Œå¹¶è®¾ç½®æ–‡ä»¶æƒé™ä¸º0644ã€‚è¿™ä¸ªæ“ä½œï¼Œç”¨ C è¯­è¨€æ¥å†™çš„è¯ï¼Œå°±æ˜¯ï¼š int fd = open(/tmp/test.txt, O_WRONLY | O_CREAT | O_TRUNC, 0644); åœ¨æ‰§è¡ŒsyscallæŒ‡ä»¤åï¼Œç³»ç»Ÿè°ƒç”¨ä¼šå°è¯•æ‰“å¼€æŒ‡å®šçš„è¿™ä¸ªæ–‡ä»¶ã€‚å¦‚æœæˆåŠŸï¼Œæ–‡ä»¶æè¿°ç¬¦ä¼šå­˜å‚¨åœ¨%raxä¸­ï¼›å¦‚æœå¤±è´¥ï¼Œ%raxå°†åŒ…å«è´Ÿå€¼ã€‚ æˆåŠŸæ‰“å¼€æ–‡ä»¶åï¼Œæˆ‘ä»¬å°†æ–‡ä»¶æè¿°ç¬¦å¤‡ä»½åˆ°%r8å¯„å­˜å™¨ï¼Œä»¥é˜²æ­¢åœ¨åé¢è°ƒç”¨åˆ°å…¶ä»–ç³»ç»Ÿè°ƒç”¨æ—¶è¦†ç›–äº†åŸæœ¬çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨sys_writeå‘è¯¥æ–‡ä»¶ä¸­å†™å…¥æˆ‘ä»¬å‡†å¤‡å¥½çš„æ•°æ®ã€‚æœ€åï¼Œç¨‹åºä½¿ç”¨sys_closeï¼ˆç³»ç»Ÿè°ƒç”¨å·ä¸º3ï¼‰å…³é—­æ–‡ä»¶æè¿°ç¬¦ï¼Œé‡Šæ”¾ç³»ç»Ÿèµ„æºï¼Œå¹¶è°ƒç”¨sys_exitæ­£å¸¸é€€å‡ºã€‚","tags":["Linux"]},{"title":"sys_write","path":"/2025/11/12/sys-write/","content":"sys_writeï¼ˆå³è°ƒç”¨å·ä¸º1çš„writeç³»ç»Ÿè°ƒç”¨ï¼‰æ˜¯ Linux ä¸­çš„ä¸€ä¸ªåŸºæœ¬ç³»ç»Ÿè°ƒç”¨ï¼Œç”¨äºå‘æŸä¸€æ–‡ä»¶æè¿°ç¬¦ä¸­å†™å…¥æ•°æ®ã€‚å®ƒä»æŒ‡å®šçš„æŸä¸€å†…å­˜åŒºåŸŸè¯»å–æ•°æ®ï¼Œå¹¶å°†å…¶å†™å…¥åˆ°ç›®æ ‡ï¼Œè¿”å›å€¼ä¸ºå®é™…å†™å…¥çš„å­—èŠ‚æ•°ã€‚ sys_write å‡½æ•°åŸå‹ ssize_t write(int fd, const void *buf, size_t count); å‚æ•° fd: æ–‡ä»¶æè¿°ç¬¦ï¼Œå³å†™å…¥çš„ä½ç½®æ‰€åœ¨ buf: ç¼“å†²åŒºæŒ‡é’ˆï¼Œè¦å†™å…¥çš„æ•°æ®æ¥æº count: è¦å†™å…¥å¤šå°‘å­—èŠ‚ è¿”å›å€¼ æˆåŠŸæ—¶è¿”å›å®é™…å†™å…¥çš„å­—èŠ‚æ•° å¤±è´¥æ—¶è¿”å›-errnoï¼ˆå¦‚EBADF, EPIPE, ENOSPCï¼‰ ç”¨ä¾‹ .section .datamessage:\t.ascii Hello, World! msg_len = . - message\t.section .text\t.globl _start_start: # è°ƒç”¨ sys_write è¾“å‡ºæ¶ˆæ¯ mov $1, %rax # ç³»ç»Ÿè°ƒç”¨å· (1 = sys_write) mov $1, %rdi # æ–‡ä»¶æè¿°ç¬¦ (1 = stdout) lea message(%rip), %rsi # ä½¿å¾— const void * buf = message mov $msg_len, %rdx # count = msg_len (æ¶ˆæ¯é•¿åº¦) syscall # æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ # é€€å‡ºç¨‹åº mov $60, %rax # ç³»ç»Ÿè°ƒç”¨å· (60 = sys_exit) xor %rdi, %rdi # return 0 syscall åˆ†æï¼š ä¸Šè¿°ä»£ç æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ sys_writeå‘æ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼Œæ–‡ä»¶æè¿°ç¬¦1ï¼‰å†™å…¥æ•°æ®ã€‚ ç¨‹åºé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªå­—ç¬¦ä¸²messageï¼Œå¹¶è®¡ç®—å…¶é•¿åº¦msg_lenã€‚åœ¨_startæ ‡ç­¾å¤„ï¼Œç¨‹åºå°†ç³»ç»Ÿè°ƒç”¨å·1ï¼ˆsys_writeï¼‰å­˜å…¥%raxå¯„å­˜å™¨ï¼Œå°†æ–‡ä»¶æè¿°ç¬¦1ï¼ˆstdoutï¼‰å­˜å…¥%rdiï¼Œå°†messageçš„åœ°å€åŠ è½½åˆ°%rsiï¼Œå¹¶è®¾ç½®è¦å†™å…¥çš„å­—èŠ‚æ•°ä¸ºmsg_lenã€‚äº¦å³ï¼š write(1, message, msg_len); æ‰§è¡ŒsyscallæŒ‡ä»¤åï¼Œç³»ç»Ÿè°ƒç”¨ä¼šå°†æ¶ˆæ¯æ•°æ®å†™å…¥åˆ°æ ‡å‡†è¾“å‡ºï¼Œç”¨æˆ·å¯ä»¥åœ¨ç»ˆç«¯çœ‹åˆ°è¾“å‡ºçš„æ–‡å­—ã€‚å®é™…å†™å…¥çš„å­—èŠ‚æ•°ä¼šå­˜å‚¨åœ¨%raxä¸­ã€‚ æœ€åï¼Œç¨‹åºè°ƒç”¨sys_exitï¼ˆç³»ç»Ÿè°ƒç”¨å·ä¸º60ï¼‰æ­£å¸¸é€€å‡ºï¼Œè¿”å›å€¼ä¸º0è¡¨ç¤ºæˆåŠŸæ‰§è¡Œã€‚","tags":["Linux"]},{"title":"sys_read","path":"/2025/11/12/sys-read/","content":"sys_readï¼ˆå³è°ƒç”¨å·ä¸º0çš„readç³»ç»Ÿè°ƒç”¨ï¼‰æ˜¯ Linux ä¸­çš„ä¸€ä¸ªåŸºæœ¬ç³»ç»Ÿè°ƒç”¨ï¼Œç”¨äºä»æ–‡ä»¶æè¿°ç¬¦ä¸­è¯»å–æ•°æ®ï¼Œå¹¶å­˜å‚¨åœ¨ä¸€æ®µæŒ‡å®šçš„å†…å­˜åŒºåŸŸä¸­ï¼Œè¿”å›å€¼ä¸ºè¯»å–åˆ°çš„å­—èŠ‚æ•°ã€‚ sys_read å‡½æ•°åŸå‹ ssize_t read(int fd, void *buf, size_t count); å‚æ•° fd: æ–‡ä»¶æè¿°ç¬¦ï¼Œå³æŒ‡å®šè¯»å–çš„â€œæºâ€ä¹‹æ‰€åœ¨ buf: ç¼“å†²åŒºæŒ‡é’ˆï¼Œæ•°æ®å°†è¢«è¯»å–åˆ°è¿™é‡Œ count: è¦è¯»å–çš„æœ€å¤§å­—èŠ‚æ•° è¿”å›å€¼ æˆåŠŸæ—¶è¿”å›å®é™…è¯»å–çš„å­—èŠ‚æ•° è¿”å›0è¡¨ç¤ºå·²åˆ°è¾¾æ–‡ä»¶æœ«å°¾(EOF) å¤±è´¥æ—¶è¿”å›-errnoï¼ˆå¦‚EINTR, EBADFï¼‰ ç”¨ä¾‹ .section .databuffer: .space 128\t.section .text\t.globl _start_start: # è°ƒç”¨ sys_read è¯»å–æ•°æ® mov $0, %rax # ç³»ç»Ÿè°ƒç”¨å· (0 = sys_read) mov $0, %rdi # æ–‡ä»¶æè¿°ç¬¦ (0 = stdin) lea buffer(%rip), %rsi # ä½¿å¾— void * buf = buffer mov $128, %rdx # count = 128 (å‰é¢å®šä¹‰ buffer çš„é•¿åº¦) syscall # æ‰§è¡Œç³»ç»Ÿè°ƒç”¨ # æ•°æ®è¯»å–å®Œæ¯•ï¼Œå­˜å‚¨åœ¨ buffer ä¸­ # è¿”å›å€¼ %rax ä¸ºè¯»å–çš„å­—èŠ‚é•¿åº¦ mov %rax, %r12 # å¤‡ä»½ %rax è‡³ %r12 # è°ƒç”¨ sys_write å°†åˆšåˆšè¾“å…¥çš„æ•°æ®æ‰“å°å‡ºæ¥\tmov $1, %rax # ç³»ç»Ÿè°ƒç”¨å· (1 = sys_write) mov $1, %rdi # æ–‡ä»¶æè¿°ç¬¦ (1 = stdout) lea buffer(%rip), %rsi # ä½¿å¾—void * buf = buffer\tmov %r12, %rdx # ä½¿å¾— sys_write è¾“å‡ºçš„é•¿åº¦ä¸ºå‰é¢è¯»å–çš„å­—èŠ‚é•¿åº¦\tsyscall # é€€å‡ºç¨‹åº mov $60, %rax # ç³»ç»Ÿè°ƒç”¨å· (60 = sys_exit) xor %rdi, %rdi # return 0 syscall åˆ†æï¼š ä¸Šè¿°ä»£ç æ¼”ç¤ºäº†å¦‚ä½•ä½¿ç”¨ sys_readç³»ç»Ÿè°ƒç”¨ä»æ ‡å‡†è¾“å…¥ï¼ˆstdinï¼Œæ–‡ä»¶æè¿°ç¬¦0ï¼‰è¯»å–æ•°æ®ã€‚ ç¨‹åºé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ª128å­—èŠ‚çš„bufferä½œä¸ºå­˜å‚¨è¯»å–æ•°æ®çš„ç¼“å†²åŒºã€‚åœ¨_startæ ‡ç­¾å¤„ï¼Œç¨‹åºå°†ç³»ç»Ÿè°ƒç”¨å·0ï¼ˆsys_readï¼‰å­˜å…¥ %raxå¯„å­˜å™¨ï¼Œå°†æ–‡ä»¶æè¿°ç¬¦0ï¼ˆstdinï¼‰å­˜å…¥%rdiï¼Œå°†bufferçš„åœ°å€åŠ è½½åˆ°%rsiï¼Œå¹¶è®¾ç½®è¦è¯»å–çš„æœ€å¤§å­—èŠ‚æ•°ä¸º128ã€‚æ­¤å³ä¸ºä»¥ä¸‹ä»£ç æ‰€æŒ‡çš„è°ƒç”¨ï¼š read(0, buffer, 128); æ‰§è¡ŒsyscallæŒ‡ä»¤åï¼Œç³»ç»Ÿè°ƒç”¨ä¼šä»æ ‡å‡†è¾“å…¥è¯»å–ç”¨æˆ·è¾“å…¥çš„æ•°æ®ï¼Œå¹¶å°†å®é™…è¯»å–çš„å­—èŠ‚æ•°å­˜å‚¨åœ¨%raxä¸­ã€‚ éšåï¼Œç¨‹åºå°†è¿”å›å€¼ï¼ˆè¯»å–çš„å­—èŠ‚æ•°ï¼‰å¤‡ä»½åˆ°%r12å¯„å­˜å™¨ï¼Œç„¶åå‡†å¤‡è°ƒç”¨sys_writeï¼ˆç³»ç»Ÿè°ƒç”¨å·ä¸º1ï¼‰å°†è¯»å–çš„æ•°æ®è¾“å‡ºåˆ°æ ‡å‡†è¾“å‡ºï¼ˆstdoutï¼Œæ–‡ä»¶æè¿°ç¬¦1ï¼‰ã€‚æœ€åï¼Œç¨‹åºè°ƒç”¨sys_exitï¼ˆç³»ç»Ÿè°ƒç”¨å·ä¸º60ï¼‰é€€å‡ºï¼Œè¿”å›å€¼ä¸º0è¡¨ç¤ºæˆåŠŸæ‰§è¡Œã€‚","tags":["Linux"]},{"title":"Linux x86_64 ç³»ç»Ÿè°ƒç”¨è¡¨","path":"/2025/11/12/Linux-x86-64-ç³»ç»Ÿè°ƒç”¨è¡¨/","content":"è¯´æ˜ï¼š è°ƒç”¨å·å­˜æ”¾åœ¨ %rax å‰å…­ä¸ªå‚æ•°ä¾æ¬¡åœ¨ %rdi, %rsi, %rdx, %r10, %r8, %r9 è¿”å›å€¼å­˜æ”¾åœ¨ %rax é”™è¯¯æ—¶è¿”å› -1 å¹¶è®¾ç½® errno ç³»ç»Ÿè°ƒç”¨å· åç§° å‡½æ•°åŸå‹ è¯´æ˜ 0 read ssize_t read(int fd, void *buf, size_t count); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºä»æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦ fd æ‰€ä»£è¡¨çš„è®¾å¤‡æˆ–æ–‡ä»¶ä¸­è¯»å–æ•°æ®ã€‚å®ƒå°†æœ€å¤š count å­—èŠ‚çš„æ•°æ®ä¼ è¾“è‡³ç”± buf æŒ‡å‘çš„ç”¨æˆ·ç©ºé—´ç¼“å†²åŒºã€‚è¿”å›å€¼ä¸ºå®é™…è¯»å–çš„å­—èŠ‚æ•°ï¼Œè‹¥åˆ°è¾¾æ–‡ä»¶æœ«å°¾åˆ™è¿”å› 0ï¼Œè‹¥å‘ç”Ÿé”™è¯¯åˆ™è¿”å› -1ã€‚è¯¥è°ƒç”¨æ˜¯ä¸€ä¸ªé˜»å¡å¼æ“ä½œï¼Œé™¤éæ–‡ä»¶æè¿°ç¬¦è¢«è®¾ç½®ä¸ºéé˜»å¡æ¨¡å¼ã€‚ 1 write ssize_t write(int fd, const void *buf, size_t count); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†æœ€å¤š count å­—èŠ‚çš„æ•°æ®ä»ç”¨æˆ·ç©ºé—´ç¼“å†²åŒº buf å†™å…¥ç”±æ–‡ä»¶æè¿°ç¬¦ fd æ‰€ä»£è¡¨çš„æ–‡ä»¶æˆ–è®¾å¤‡ä¸­ã€‚è¿”å›å€¼ä¸ºå®é™…å†™å…¥çš„å­—èŠ‚æ•°ï¼Œè‹¥å‘ç”Ÿé”™è¯¯åˆ™è¿”å› -1ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå†™å…¥çš„å­—èŠ‚æ•°å¯èƒ½å°äºè¯·æ±‚çš„ countã€‚ 2 open int open(const char *pathname, int flags, mode_t mode); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæ‰“å¼€ä¸€ä¸ªç”± pathname æŒ‡å®šçš„æ–‡ä»¶ï¼Œå¹¶è¿”å›ä¸€ä¸ªå¯ç”¨äºåç»­æ“ä½œï¼ˆå¦‚ read æˆ– writeï¼‰çš„æ–‡ä»¶æè¿°ç¬¦ã€‚flags å‚æ•°æ§åˆ¶æ‰“å¼€æ¨¡å¼ï¼ˆå¦‚åªè¯»ã€åªå†™æˆ–è¯»å†™ï¼‰ï¼Œmode å‚æ•°åˆ™åœ¨åˆ›å»ºæ–°æ–‡ä»¶æ—¶æŒ‡å®šå…¶æƒé™ã€‚è‹¥æˆåŠŸåˆ™è¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥åˆ™è¿”å› -1ã€‚ 3 close int close(int fd); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå…³é—­æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦ fdï¼Œä½¿å…¶ä¸å†å¼•ç”¨ä»»ä½•æ–‡ä»¶ï¼Œå¹¶é‡Šæ”¾è¯¥æè¿°ç¬¦æ‰€å…³è”çš„ç³»ç»Ÿèµ„æºã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 4 stat int stat(const char *pathname, struct stat *statbuf); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–ç”± pathname æŒ‡å®šçš„æ–‡ä»¶çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨ statbuf ç»“æ„ä½“ä¸­ã€‚è¿™äº›ä¿¡æ¯åŒ…æ‹¬æ–‡ä»¶ç±»å‹ã€æƒé™ã€å¤§å°ã€æœ€åä¿®æ”¹æ—¶é—´ç­‰ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 5 fstat int fstat(int fd, struct stat *statbuf); æ­¤ç³»ç»Ÿè°ƒç”¨ä¸ stat ç±»ä¼¼ï¼Œä½†å®ƒé€šè¿‡æ–‡ä»¶æè¿°ç¬¦ fd æ¥è·å–å·²æ‰“å¼€æ–‡ä»¶çš„çŠ¶æ€ä¿¡æ¯ã€‚è¿™é¿å…äº†æ–‡ä»¶è·¯å¾„è§£æè¿‡ç¨‹ä¸­çš„æ½œåœ¨ç«æ€æ¡ä»¶ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 6 lstat int lstat(const char *pathname, struct stat *statbuf); æ­¤ç³»ç»Ÿè°ƒç”¨ç±»ä¼¼äº statï¼Œä½†å¦‚æœ pathname æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼Œå®ƒä¼šè¿”å›ç¬¦å·é“¾æ¥æœ¬èº«çš„çŠ¶æ€ä¿¡æ¯ï¼Œè€Œä¸æ˜¯å®ƒæ‰€æŒ‡å‘çš„æ–‡ä»¶çš„çŠ¶æ€ä¿¡æ¯ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 7 poll int poll(struct pollfd *fds, nfds_t nfds, int timeout); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºç›‘è§†ä¸€ç»„æ–‡ä»¶æè¿°ç¬¦ï¼Œä»¥ç­‰å¾…å…¶ä¸­ä¸€ä¸ªæˆ–å¤šä¸ªæè¿°ç¬¦å‡†å¤‡å¥½è¿›è¡Œ IO æ“ä½œã€‚å®ƒæ£€æŸ¥æ¯ä¸ª pollfd ç»“æ„ä½“ä¸­çš„ eventsï¼Œå¹¶åœ¨ç›¸åº”çš„ revents å­—æ®µä¸­è¿”å›å°±ç»ªäº‹ä»¶ã€‚timeout å‚æ•°æŒ‡å®šäº†ç­‰å¾…çš„æ¯«ç§’æ•°ã€‚è¿”å›å€¼ä¸ºå°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦æ€»æ•°ï¼Œè¶…æ—¶è¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 8 lseek off_t lseek(int fd, off_t offset, int whence); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºé‡æ–°å®šä½æ–‡ä»¶æè¿°ç¬¦ fd çš„è¯»å†™ä½ç½®ã€‚offset å‚æ•°æŒ‡å®šåç§»é‡ï¼Œwhence åˆ™æŒ‡å®šåç§»çš„èµ·å§‹ä½ç½®ï¼ˆå¦‚æ–‡ä»¶å¼€å¤´ SEEK_SETã€å½“å‰ä½ç½® SEEK_CUR æˆ–æ–‡ä»¶æœ«å°¾ SEEK_ENDï¼‰ã€‚è¿”å›å€¼ä¸ºæ–°çš„æ–‡ä»¶ä½ç½®ï¼Œå¤±è´¥è¿”å› -1ã€‚ 9 mmap void *mmap(void *addr, size_t length, int prot, int flags, int fd, off_t offset); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†ä¸€ä¸ªæ–‡ä»¶æˆ–è®¾å¤‡çš„ä¸€éƒ¨åˆ†æ˜ å°„åˆ°è¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚å®ƒå…è®¸è¿›ç¨‹åƒè®¿é—®å†…å­˜ä¸€æ ·è®¿é—®æ–‡ä»¶å†…å®¹ï¼Œä»è€Œé¿å…äº† readwrite è°ƒç”¨å¸¦æ¥çš„å¼€é”€ã€‚æˆåŠŸè¿”å›æ˜ å°„åŒºåŸŸçš„èµ·å§‹åœ°å€ï¼Œå¤±è´¥è¿”å› MAP_FAILEDã€‚ 10 mprotect int mprotect(void *addr, size_t len, int prot); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºä¿®æ”¹ä¸€ä¸ªè¿›ç¨‹å†…å­˜åŒºåŸŸçš„ä¿æŠ¤æƒé™ã€‚addr å’Œ len æŒ‡å®šäº†è¦ä¿®æ”¹çš„å†…å­˜åŒºåŸŸï¼Œprot å‚æ•°åˆ™è®¾ç½®æ–°çš„æƒé™ï¼Œå¦‚å¯è¯»ã€å¯å†™æˆ–å¯æ‰§è¡Œã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 11 munmap int munmap(void *addr, size_t length); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå–æ¶ˆè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´ä¸­çš„æ˜ å°„ã€‚å®ƒé‡Šæ”¾äº†ç”± mmap åˆ›å»ºçš„å†…å­˜åŒºåŸŸï¼Œä½¿å…¶ä¸å†å¯è®¿é—®ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 12 brk int brk(void *addr); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæ”¹å˜è¿›ç¨‹æ•°æ®æ®µçš„ç»“æŸä½ç½®ï¼Œé€šå¸¸ç§°ä¸º program breakã€‚å®ƒå¯ä»¥é€šè¿‡è°ƒæ•´ brk çš„å€¼æ¥åŠ¨æ€åœ°åˆ†é…æˆ–é‡Šæ”¾å†…å­˜ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 13 rt_sigaction int rt_sigaction(int signum, const struct sigaction *act, struct sigaction *oldact, size_t sigsetsize); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæ£€æŸ¥æˆ–æ”¹å˜ä¸ç‰¹å®šä¿¡å· signum ç›¸å…³çš„å¤„ç†è¡Œä¸ºã€‚å®ƒæ˜¯ä¸€ä¸ªæ›´å…ˆè¿›å’Œæ›´å¥å£®çš„ä¿¡å·å¤„ç†ç‰ˆæœ¬ï¼Œæ”¯æŒå®æ—¶ä¿¡å·ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 14 rt_sigprocmask int rt_sigprocmask(int how, const sigset_t *set, sigset_t *oldset, size_t sigsetsize); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæ£€æŸ¥æˆ–æ”¹å˜è¿›ç¨‹çš„ä¿¡å·é˜»å¡æ©ç ã€‚å®ƒå¯ä»¥ç”¨äºé˜»å¡ï¼ˆSIG_BLOCKï¼‰ã€è§£é™¤é˜»å¡ï¼ˆSIG_UNBLOCKï¼‰æˆ–è®¾ç½®ï¼ˆSIG_SETMASKï¼‰ä¿¡å·é›†ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 15 rt_sigreturn int rt_sigreturn(void); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºä»ä¿¡å·å¤„ç†å‡½æ•°ä¸­è¿”å›ã€‚å®ƒæ¢å¤äº†åœ¨è¿›å…¥ä¿¡å·å¤„ç†å‡½æ•°ä¹‹å‰ä¿å­˜çš„è¿›ç¨‹ä¸Šä¸‹æ–‡ï¼ŒåŒ…æ‹¬å¯„å­˜å™¨å’Œä¿¡å·æ©ç ã€‚è¯¥è°ƒç”¨é€šå¸¸ç”±å†…æ ¸è‡ªåŠ¨ç”Ÿæˆï¼Œè€Œä¸æ˜¯ç”±ç”¨æˆ·ç›´æ¥è°ƒç”¨ã€‚ 16 ioctl int ioctl(int fd, unsigned long request, ...); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå¯¹è®¾å¤‡æ‰§è¡Œç‰¹å®šçš„ IO æ§åˆ¶æ“ä½œã€‚fd æ˜¯è®¾å¤‡çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œrequest æŒ‡å®šè¦æ‰§è¡Œçš„æ“ä½œã€‚å…¶åçš„å‚æ•°å–å†³äºå…·ä½“è¯·æ±‚ã€‚è¯¥è°ƒç”¨æä¾›äº†å¯¹è®¾å¤‡åº•å±‚åŠŸèƒ½çš„è®¿é—®ï¼Œå¦‚é…ç½®ç»ˆç«¯ã€è°ƒæ•´é©±åŠ¨ç¨‹åºå‚æ•°ç­‰ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 17 pread64 ssize_t pread64(int fd, void *buf, size_t count, off64_t offset); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºä»æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦ fd ä¸­è¯»å–æ•°æ®ï¼Œä½†å®ƒåœ¨ offset å¤„å¼€å§‹è¯»å–ï¼Œå¹¶ä¸”ä¸æ”¹å˜æ–‡ä»¶æè¿°ç¬¦çš„å½“å‰è¯»å†™ä½ç½®ã€‚è¿™å¯¹äºå¤šçº¿ç¨‹æˆ–å¹¶å‘è®¿é—®åŒä¸€ä¸ªæ–‡ä»¶éå¸¸æœ‰ç”¨ã€‚è¿”å›å€¼ä¸ºå®é™…è¯»å–çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 18 pwrite64 ssize_t pwrite64(int fd, const void *buf, size_t count, off64_t offset); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå‘æŒ‡å®šçš„æ–‡ä»¶æè¿°ç¬¦ fd å†™å…¥æ•°æ®ï¼Œä½†å®ƒåœ¨ offset å¤„å¼€å§‹å†™å…¥ï¼Œå¹¶ä¸”ä¸æ”¹å˜æ–‡ä»¶æè¿°ç¬¦çš„å½“å‰è¯»å†™ä½ç½®ã€‚è¿™ä¸ pread64 ç±»ä¼¼ï¼Œæä¾›äº†åŸå­æ€§çš„å†™å…¥æ“ä½œï¼Œé¿å…äº†æ–‡ä»¶æŒ‡é’ˆçš„ç«äº‰ã€‚è¿”å›å€¼ä¸ºå®é™…å†™å…¥çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 19 readv ssize_t readv(int fd, const struct iovec *iov, int iovcnt); æ­¤ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œä¸€ä¸ªåˆ†æ•£è¯»å–æ“ä½œã€‚å®ƒä»æ–‡ä»¶æè¿°ç¬¦ fd ä¸­è¯»å–æ•°æ®ï¼Œå¹¶æŒ‰é¡ºåºå°†æ•°æ®åˆ†æ•£åˆ°ç”± iov æ•°ç»„ï¼ˆiovec ç»“æ„ä½“ï¼‰æŒ‡å®šçš„å¤šä¸ªç¼“å†²åŒºä¸­ã€‚iovcnt æ˜¯ iov æ•°ç»„ä¸­å…ƒç´ çš„æ•°é‡ã€‚è¿”å›å€¼ä¸ºè¯»å–çš„æ€»å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 20 writev ssize_t writev(int fd, const struct iovec *iov, int iovcnt); æ­¤ç³»ç»Ÿè°ƒç”¨æ‰§è¡Œä¸€ä¸ªé›†ä¸­å†™å…¥æ“ä½œã€‚å®ƒå°†ç”± iov æ•°ç»„ï¼ˆiovec ç»“æ„ä½“ï¼‰æŒ‡å®šçš„å¤šä¸ªç¼“å†²åŒºä¸­çš„æ•°æ®ï¼ŒæŒ‰é¡ºåºé›†ä¸­å†™å…¥åˆ°æ–‡ä»¶æè¿°ç¬¦ fd ä¸­ã€‚iovcnt æ˜¯ iov æ•°ç»„ä¸­å…ƒç´ çš„æ•°é‡ã€‚è¿”å›å€¼ä¸ºå†™å…¥çš„æ€»å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 21 access int access(const char *pathname, int mode); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæ£€æŸ¥è°ƒç”¨è¿›ç¨‹æ˜¯å¦å…·æœ‰å¯¹ pathname æŒ‡å®šçš„æ–‡ä»¶æˆ–ç›®å½•çš„è®¿é—®æƒé™ã€‚mode å‚æ•°æŒ‡å®šè¦æ£€æŸ¥çš„æƒé™ç±»å‹ï¼Œå¦‚ R_OKï¼ˆå¯è¯»ï¼‰ã€W_OKï¼ˆå¯å†™ï¼‰ã€X_OKï¼ˆå¯æ‰§è¡Œï¼‰æˆ– F_OKï¼ˆæ–‡ä»¶å­˜åœ¨ï¼‰ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 22 pipe int pipe(int pipefd[2]); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€ä¸ªç®€å•çš„ç®¡é“ï¼Œç”¨äºè¿›ç¨‹é—´çš„é€šä¿¡ã€‚å®ƒåˆ›å»ºä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œpipefd[0] ç”¨äºè¯»å–ï¼Œpipefd[1] ç”¨äºå†™å…¥ã€‚å†™å…¥ pipefd[1] çš„æ•°æ®å¯ä»¥ä» pipefd[0] ä¸­è¯»å–ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 23 select int select(int nfds, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, struct timeval *timeout); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºç›‘è§†å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦é›†ï¼Œä»¥ç­‰å¾…å…¶ä¸­ä»»ä½•ä¸€ä¸ªæè¿°ç¬¦å‡†å¤‡å¥½è¿›è¡Œ IO æ“ä½œã€‚å®ƒèƒ½å¤ŸåŒæ—¶ç›‘è§†å¯è¯»ã€å¯å†™å’Œå¼‚å¸¸æƒ…å†µã€‚è¿”å›å€¼ä¸ºå°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦æ€»æ•°ï¼Œè¶…æ—¶è¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 24 sched_yield int sched_yield(void); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè‡ªæ„¿åœ°æ”¾å¼ƒ CPUï¼Œå…è®¸å…¶ä»–å…·æœ‰ç›¸åŒæˆ–æ›´é«˜ä¼˜å…ˆçº§çš„çº¿ç¨‹æˆ–è¿›ç¨‹è¿è¡Œã€‚å®ƒå°†è°ƒç”¨è¿›ç¨‹ä»è¿è¡Œé˜Ÿåˆ—ä¸­ç§»åˆ°å°±ç»ªé˜Ÿåˆ—çš„æœ«å°¾ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 25 mremap void *mremap(void *old_address, size_t old_size, size_t new_size, int flags, ... /* void *new_address */); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè°ƒæ•´ç°æœ‰å†…å­˜æ˜ å°„çš„å¤§å°ã€‚å®ƒå°† old_address å¼€å§‹çš„ old_size å­—èŠ‚å†…å­˜æ˜ å°„é‡æ–°æ˜ å°„åˆ° new_size å­—èŠ‚ã€‚å¯ä»¥ç”¨äºæ‰©å¤§æˆ–ç¼©å°ä¸€ä¸ªå†…å­˜åŒºåŸŸã€‚æˆåŠŸè¿”å›æ–°æ˜ å°„çš„èµ·å§‹åœ°å€ï¼Œå¤±è´¥è¿”å› MAP_FAILEDã€‚ 26 msync int msync(void *addr, size_t length, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†å†…å­˜æ˜ å°„åŒºåŸŸä¸­çš„ä¿®æ”¹æ•°æ®åŒæ­¥åˆ°æ–‡ä»¶ã€‚å®ƒç¡®ä¿å¯¹å†…å­˜ä¸­çš„æ›´æ”¹è¢«å†™å…¥åˆ°åº•å±‚æ–‡ä»¶ç³»ç»Ÿï¼Œä»è€Œä¿æŒæ–‡ä»¶å’Œå†…å­˜çš„åŒæ­¥ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 27 mincore int mincore(void *addr, size_t length, unsigned char *vec); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºç¡®å®šè™šæ‹Ÿå†…å­˜åŒºåŸŸçš„å“ªäº›é¡µé¢å½“å‰ä½äºç‰©ç†å†…å­˜ï¼ˆRAMï¼‰ä¸­ã€‚å®ƒå°†ç»“æœå­˜å‚¨åœ¨ vec æ•°ç»„ä¸­ï¼Œå…¶ä¸­æ¯ä¸ªå­—èŠ‚å¯¹åº”ä¸€ä¸ªé¡µé¢ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 28 madvise int madvise(void *addr, size_t length, int advice); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå‘ŠçŸ¥å†…æ ¸å¦‚ä½•å¤„ç†ä¸€ä¸ªè¿›ç¨‹çš„å†…å­˜åŒºåŸŸã€‚advice å‚æ•°å¯ä»¥æä¾›å…³äºæœªæ¥å†…å­˜è®¿é—®æ¨¡å¼çš„å»ºè®®ï¼Œä¾‹å¦‚ MADV_SEQUENTIALï¼ˆæŒ‰é¡ºåºè®¿é—®ï¼‰æˆ– MADV_WILLNEEDï¼ˆå³å°†è®¿é—®ï¼‰ï¼Œä»è€Œå¸®åŠ©å†…æ ¸è¿›è¡Œæ€§èƒ½ä¼˜åŒ–ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 29 shmget int shmget(key_t key, size_t size, int shmflg); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„å…±äº«å†…å­˜æ®µæˆ–è·å–ä¸€ä¸ªå·²æœ‰çš„å…±äº«å†…å­˜æ®µã€‚key ç”¨äºæ ‡è¯†å…±äº«å†…å­˜æ®µï¼Œsize æŒ‡å®šæ®µçš„å¤§å°ï¼Œshmflg åˆ™æ§åˆ¶åˆ›å»ºæ ‡å¿—å’Œæƒé™ã€‚æˆåŠŸè¿”å›å…±äº«å†…å­˜æ ‡è¯†ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 30 shmat void *shmat(int shmid, const void *shmaddr, int shmflg); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†ç”± shmid æ ‡è¯†çš„å…±äº«å†…å­˜æ®µé™„åŠ åˆ°è°ƒç”¨è¿›ç¨‹çš„åœ°å€ç©ºé—´ã€‚shmaddr å¯ç”¨äºæŒ‡å®šé™„åŠ åœ°å€ï¼Œå¦‚æœä¸º NULL åˆ™ç”±å†…æ ¸é€‰æ‹©ã€‚æˆåŠŸè¿”å›é™„åŠ çš„åœ°å€ï¼Œå¤±è´¥è¿”å› -1ã€‚ 31 shmctl int shmctl(int shmid, int cmd, struct shmid_ds *buf); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå¯¹ç”± shmid æ ‡è¯†çš„å…±äº«å†…å­˜æ®µæ‰§è¡Œæ§åˆ¶æ“ä½œã€‚cmd å‚æ•°æŒ‡å®šè¦æ‰§è¡Œçš„æ“ä½œï¼Œä¾‹å¦‚åˆ é™¤å…±äº«å†…å­˜æ®µï¼ˆIPC_RMIDï¼‰æˆ–è·å–çŠ¶æ€ä¿¡æ¯ï¼ˆIPC_STATï¼‰ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 32 dup int dup(int oldfd); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå®ƒæ˜¯ oldfd çš„ä¸€ä¸ªå‰¯æœ¬ã€‚æ–°çš„æ–‡ä»¶æè¿°ç¬¦æŒ‡å‘ä¸ oldfd ç›¸åŒçš„åº•å±‚æ–‡ä»¶æˆ–è®¾å¤‡ï¼Œå¹¶ä¸”å…±äº«æ–‡ä»¶æŒ‡é’ˆã€æ–‡ä»¶çŠ¶æ€æ ‡å¿—ç­‰ã€‚è¿”å›å€¼ä¸ºæ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 33 dup2 int dup2(int oldfd, int newfd); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°† newfd é‡å®šå‘ä¸º oldfd çš„å‰¯æœ¬ã€‚å¦‚æœ newfd å·²ç»æ‰“å¼€ï¼Œå®ƒä¼šå…ˆè¢«å…³é—­ã€‚æ­¤æ“ä½œæ˜¯åŸå­æ€§çš„ã€‚dup2 æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„æŠ€å·§ï¼Œä¾‹å¦‚ç”¨äºé‡å®šå‘æ ‡å‡†è¾“å…¥è¾“å‡ºã€‚æˆåŠŸè¿”å› newfdï¼Œå¤±è´¥è¿”å› -1ã€‚ 34 pause int pause(void); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºä½¿è°ƒç”¨è¿›ç¨‹è¿›å…¥ç¡çœ çŠ¶æ€ï¼Œç›´åˆ°æ¥æ”¶åˆ°ä¸€ä¸ªä¿¡å·ä¸ºæ­¢ã€‚å®ƒä¸ä¼šè¿”å›ï¼Œé™¤éä¿¡å·å¤„ç†å‡½æ•°è¿”å›ï¼Œæˆ–è€…è¿›ç¨‹è¢«ä¸€ä¸ªæœªè¢«å¿½ç•¥çš„ä¿¡å·ç»ˆæ­¢ã€‚è¿”å›å€¼ä¸º -1 å¹¶è®¾ç½® errno ä¸º EINTRã€‚ 35 nanosleep int nanosleep(const struct timespec *req, struct timespec *rem); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®©è°ƒç”¨è¿›ç¨‹ç²¾ç¡®åœ°æš‚åœæŒ‡å®šçš„çº³ç§’çº§æ—¶é—´ã€‚req æŒ‡å®šè¯·æ±‚çš„ç¡çœ æ—¶é—´ï¼Œrem å¯ç”¨äºè·å–å‰©ä½™çš„ç¡çœ æ—¶é—´ï¼Œå¦‚æœè°ƒç”¨è¢«ä¿¡å·ä¸­æ–­ã€‚æˆåŠŸè¿”å› 0ï¼Œè¢«ä¿¡å·ä¸­æ–­è¿”å› -1ã€‚ 36 getitimer int getitimer(int which, struct itimerval *curr_value); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–æŒ‡å®šé—´éš”å®šæ—¶å™¨çš„å½“å‰å€¼ã€‚which å‚æ•°æŒ‡å®šå®šæ—¶å™¨çš„ç±»å‹ï¼Œä¾‹å¦‚ ITIMER_REALï¼ˆå®æ—¶å®šæ—¶å™¨ï¼‰ã€‚å½“å‰å€¼è¢«å­˜å‚¨åœ¨ curr_value ç»“æ„ä½“ä¸­ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 37 alarm unsigned int alarm(unsigned int seconds); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œåœ¨æŒ‡å®šçš„ seconds ç§’åå‘è°ƒç”¨è¿›ç¨‹å‘é€ SIGALRM ä¿¡å·ã€‚å¦‚æœ seconds ä¸º 0ï¼Œåˆ™å–æ¶ˆä»»ä½•å¾…å®šçš„å®šæ—¶å™¨ã€‚è¿”å›å€¼ä¸ºå‰ä¸€ä¸ªå®šæ—¶å™¨å‰©ä½™çš„ç§’æ•°ã€‚ 38 setitimer int setitimer(int which, const struct itimerval *new_value, struct itimerval *old_value); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®æˆ–ä¿®æ”¹æŒ‡å®šçš„é—´éš”å®šæ—¶å™¨ã€‚which æŒ‡å®šå®šæ—¶å™¨ç±»å‹ï¼Œnew_value è®¾ç½®æ–°çš„å€¼ï¼Œè€Œ old_value åˆ™å¯é€‰åœ°ç”¨äºè·å–å‰ä¸€ä¸ªå€¼ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 39 getpid pid_t getpid(void); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–è°ƒç”¨è¿›ç¨‹çš„è¿›ç¨‹ IDã€‚è¯¥ ID åœ¨ç³»ç»ŸèŒƒå›´å†…æ˜¯å”¯ä¸€çš„ã€‚è¿”å›å€¼ä¸ºè¿›ç¨‹ IDã€‚ 40 sendfile ssize_t sendfile(int out_fd, int in_fd, off_t *offset, size_t count); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåœ¨ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¹‹é—´é›¶æ‹·è´åœ°ä¼ è¾“æ•°æ®ã€‚å®ƒç›´æ¥ä» in_fd ä¼ è¾“æœ€å¤š count å­—èŠ‚æ•°æ®åˆ° out_fdï¼Œæ— éœ€é€šè¿‡ç”¨æˆ·ç©ºé—´ç¼“å†²åŒºã€‚è¿™å¯¹äºé«˜æ•ˆåœ°ä¼ è¾“æ–‡ä»¶å†…å®¹éå¸¸æœ‰ç”¨ã€‚è¿”å›å€¼ä¸ºå®é™…ä¼ è¾“çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 41 socket int socket(int domain, int type, int protocol); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„å¥—æ¥å­—ã€‚domain å‚æ•°æŒ‡å®šåè®®æ—ï¼ˆå¦‚ AF_INET ç”¨äº IPv4ï¼‰ï¼Œtype æŒ‡å®šå¥—æ¥å­—ç±»å‹ï¼ˆå¦‚ SOCK_STREAM ç”¨äº TCPï¼‰ï¼Œprotocol é€šå¸¸ä¸º 0ã€‚æˆåŠŸè¿”å›æ–°çš„å¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 42 connect int connect(int sockfd, const struct sockaddr *addr, socklen_t addrlen); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†ä¸€ä¸ªå¥—æ¥å­—è¿æ¥åˆ°æŒ‡å®šçš„ç½‘ç»œåœ°å€ addrã€‚è¿™é€šå¸¸ç”¨äºå®¢æˆ·ç«¯ç¨‹åºå»ºç«‹ä¸æœåŠ¡å™¨çš„è¿æ¥ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 43 accept int accept(int sockfd, struct sockaddr *addr, socklen_t *addrlen); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæ¥å—ä¸€ä¸ªä¼ å…¥çš„è¿æ¥è¯·æ±‚ã€‚å®ƒä»ç›‘å¬å¥—æ¥å­— sockfd çš„é˜Ÿåˆ—ä¸­å–å‡ºä¸€ä¸ªè¿æ¥ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªæ–°çš„å·²è¿æ¥å¥—æ¥å­—ã€‚æ–°å¥—æ¥å­—çš„æ–‡ä»¶æè¿°ç¬¦è¢«è¿”å›ï¼Œå¯ç”¨äºä¸å®¢æˆ·ç«¯é€šä¿¡ã€‚æˆåŠŸè¿”å›æ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 44 sendto ssize_t sendto(int sockfd, const void *buf, size_t len, int flags, const struct sockaddr *dest_addr, socklen_t addrlen); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåœ¨æ— è¿æ¥çš„å¥—æ¥å­—ï¼ˆå¦‚ UDPï¼‰ä¸Šå‘é€æ•°æ®ã€‚å®ƒå°† buf ä¸­çš„æ•°æ®å‘é€åˆ°ç”± dest_addr æŒ‡å®šçš„ç›®æ ‡åœ°å€ã€‚è¿”å›å€¼ä¸ºå‘é€çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 45 recvfrom ssize_t recvfrom(int sockfd, void *buf, size_t len, int flags, struct sockaddr *src_addr, socklen_t *addrlen); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåœ¨æ— è¿æ¥çš„å¥—æ¥å­—ï¼ˆå¦‚ UDPï¼‰ä¸Šæ¥æ”¶æ•°æ®ã€‚å®ƒä»å¥—æ¥å­— sockfd ä¸­è¯»å–æ•°æ®å¹¶å°†å…¶å­˜å‚¨åœ¨ buf ä¸­ï¼ŒåŒæ—¶å°†å‘é€æ–¹çš„åœ°å€ä¿¡æ¯å­˜å‚¨åœ¨ src_addr ä¸­ã€‚è¿”å›å€¼ä¸ºæ¥æ”¶çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 46 sendmsg ssize_t sendmsg(int sockfd, const struct msghdr *msg, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨æä¾›äº†æ¯” sendto æ›´é€šç”¨çš„æ•°æ®å‘é€æ–¹å¼ã€‚å®ƒé€šè¿‡ msghdr ç»“æ„ä½“ï¼Œå¯ä»¥å‘é€å¤šä¸ªä¸è¿ç»­çš„ç¼“å†²åŒºï¼Œå¹¶æ”¯æŒå‘é€è¾…åŠ©æ•°æ®ï¼ˆå¦‚æ–‡ä»¶æè¿°ç¬¦ï¼‰ã€‚è¿”å›å€¼ä¸ºå‘é€çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 47 recvmsg ssize_t recvmsg(int sockfd, struct msghdr *msg, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨æä¾›äº†æ¯” recvfrom æ›´é€šç”¨çš„æ•°æ®æ¥æ”¶æ–¹å¼ã€‚å®ƒé€šè¿‡ msghdr ç»“æ„ä½“ï¼Œå¯ä»¥æ¥æ”¶å¤šä¸ªä¸è¿ç»­çš„ç¼“å†²åŒºï¼Œå¹¶æ”¯æŒæ¥æ”¶è¾…åŠ©æ•°æ®ã€‚è¿”å›å€¼ä¸ºæ¥æ”¶çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 48 shutdown int shutdown(int sockfd, int how); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºéƒ¨åˆ†æˆ–å®Œå…¨å…³é—­ä¸€ä¸ªå¥—æ¥å­—çš„è¿æ¥ã€‚how å‚æ•°æ§åˆ¶å…³é—­æ–¹å‘ï¼šSHUT_RDï¼ˆç¦æ­¢åç»­è¯»å–ï¼‰ã€SHUT_WRï¼ˆç¦æ­¢åç»­å†™å…¥ï¼‰æˆ– SHUT_RDWRï¼ˆç¦æ­¢è¯»å†™ï¼‰ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 49 bind int bind(int sockfd, const struct sockaddr *addr, socklen_t addrlen); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†ä¸€ä¸ªå¥—æ¥å­—ä¸ä¸€ä¸ªç‰¹å®šçš„æœ¬åœ°åœ°å€ï¼ˆå¦‚ IP åœ°å€å’Œç«¯å£å·ï¼‰å…³è”èµ·æ¥ã€‚è¿™é€šå¸¸ç”¨äºæœåŠ¡å™¨ç¨‹åºï¼Œä»¥ä¾¿ç›‘å¬è¯¥åœ°å€ä¸Šçš„ä¼ å…¥è¿æ¥ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 50 listen int listen(int sockfd, int backlog); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†ä¸€ä¸ªå¥—æ¥å­—è®¾ç½®ä¸ºè¢«åŠ¨æ¨¡å¼ï¼Œä»¥ä¾¿æ¥å—ä¼ å…¥çš„è¿æ¥ã€‚backlog å‚æ•°æŒ‡å®šäº†ç­‰å¾…æ¥å—çš„è¿æ¥è¯·æ±‚é˜Ÿåˆ—çš„æœ€å¤§é•¿åº¦ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 51 getsockname int getsockname(int sockfd, struct sockaddr *addr, socklen_t *addrlen); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–æŒ‡å®šå¥—æ¥å­— sockfd çš„æœ¬åœ°åœ°å€ä¿¡æ¯ã€‚åœ°å€ä¿¡æ¯è¢«å­˜å‚¨åœ¨ addr ä¸­ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 52 getpeername int getpeername(int sockfd, struct sockaddr *addr, socklen_t *addrlen); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–ä¸æŒ‡å®šå¥—æ¥å­— sockfd è¿æ¥çš„å¯¹ç«¯ï¼ˆpeerï¼‰çš„åœ°å€ä¿¡æ¯ã€‚åœ°å€ä¿¡æ¯è¢«å­˜å‚¨åœ¨ addr ä¸­ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 53 socketpair int socketpair(int domain, int type, int protocol, int sv[2]); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€å¯¹ç›¸äº’è¿æ¥çš„æ— åå¥—æ¥å­—ã€‚sv æ•°ç»„å°†åŒ…å«ä¸¤ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå®ƒä»¬å¯ä»¥ç”¨äºåŒå‘é€šä¿¡ã€‚è¿™é€šå¸¸ç”¨äºçˆ¶å­è¿›ç¨‹æˆ–åŒä¸€è¿›ç¨‹å†…çš„çº¿ç¨‹é—´é€šä¿¡ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 54 setsockopt int setsockopt(int sockfd, int level, int optname, const void *optval, socklen_t optlen); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®å¥—æ¥å­—é€‰é¡¹ã€‚level æŒ‡å®šé€‰é¡¹çš„åè®®å±‚ï¼Œoptname æŒ‡å®šé€‰é¡¹åç§°ï¼Œoptval å’Œ optlen æä¾›é€‰é¡¹å€¼ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥ç”¨æ¥è®¾ç½®å¥—æ¥å­—ä¸ºéé˜»å¡æ¨¡å¼æˆ–å¯ç”¨åœ°å€é‡ç”¨ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 55 getsockopt int getsockopt(int sockfd, int level, int optname, void *optval, socklen_t *optlen); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–å¥—æ¥å­—é€‰é¡¹ã€‚å®ƒä¸ setsockopt ç±»ä¼¼ï¼Œä½†ç”¨äºæ£€ç´¢é€‰é¡¹çš„å½“å‰å€¼ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 56 clone int clone(int (*fn)(void *), void *child_stack, int flags, void *arg, ...); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„å­è¿›ç¨‹æˆ–çº¿ç¨‹ã€‚å®ƒæ¯” fork æ›´çµæ´»ï¼Œå…è®¸è°ƒç”¨è€…ç²¾ç¡®æ§åˆ¶æ–°è¿›ç¨‹ä¸çˆ¶è¿›ç¨‹å…±äº«å“ªäº›èµ„æºï¼Œå¦‚å†…å­˜ã€æ–‡ä»¶æè¿°ç¬¦å’Œä¿¡å·å¤„ç†ç¨‹åºã€‚æˆåŠŸè¿”å›å­è¿›ç¨‹çš„ PIDï¼Œå¤±è´¥è¿”å› -1ã€‚ 57 fork pid_t fork(void); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„å­è¿›ç¨‹ï¼Œå®ƒæ˜¯è°ƒç”¨è¿›ç¨‹çš„ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„å‰¯æœ¬ã€‚å­è¿›ç¨‹ä¸çˆ¶è¿›ç¨‹æ‹¥æœ‰ç›¸åŒçš„ä»£ç ã€æ•°æ®å’Œæ–‡ä»¶æè¿°ç¬¦å‰¯æœ¬ï¼Œä½†æœ‰è‡ªå·±çš„ç‹¬ç«‹çš„åœ°å€ç©ºé—´ã€‚æˆåŠŸè¿”å›å­è¿›ç¨‹çš„ PIDï¼ˆåœ¨çˆ¶è¿›ç¨‹ä¸­ï¼‰ï¼Œæˆ– 0ï¼ˆåœ¨å­è¿›ç¨‹ä¸­ï¼‰ï¼Œå¤±è´¥è¿”å› -1ã€‚ 58 vfork pid_t vfork(void); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„å­è¿›ç¨‹ï¼Œä¸ fork ç±»ä¼¼ï¼Œä½†å®ƒåœ¨åˆ›å»ºåå…±äº«çˆ¶è¿›ç¨‹çš„åœ°å€ç©ºé—´ã€‚çˆ¶è¿›ç¨‹ä¼šé˜»å¡ï¼Œç›´åˆ°å­è¿›ç¨‹è°ƒç”¨ execve æˆ– _exitã€‚å®ƒä¸»è¦ç”¨äºå¿«é€Ÿåˆ›å»ºæ–°è¿›ç¨‹ä»¥æ‰§è¡Œæ–°ç¨‹åºã€‚è¿”å›è§„åˆ™ä¸ fork ç›¸åŒã€‚ 59 execve int execve(const char *pathname, char *const argv[], char *const envp[]); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåœ¨å½“å‰è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ä¸­æ‰§è¡Œä¸€ä¸ªæ–°çš„ç¨‹åºã€‚å®ƒåŠ è½½ pathname æŒ‡å®šçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå¹¶ç”¨ argv å’Œ envp æä¾›çš„å‚æ•°å’Œç¯å¢ƒå˜é‡æ›¿æ¢å½“å‰è¿›ç¨‹çš„æ˜ åƒã€‚å¦‚æœæˆåŠŸï¼Œå®ƒä¸ä¼šè¿”å›ï¼Œå¦‚æœå¤±è´¥ï¼Œåˆ™è¿”å› -1ã€‚ 60 exit void exit(int status); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºç»ˆæ­¢è°ƒç”¨è¿›ç¨‹ã€‚status å‚æ•°æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œä½œä¸ºè¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ç è¿”å›ç»™çˆ¶è¿›ç¨‹ã€‚å®ƒä¼šæ‰§è¡Œæ‰€æœ‰å¿…è¦çš„æ¸…ç†å·¥ä½œï¼ŒåŒ…æ‹¬å…³é—­æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦ã€‚æ­¤è°ƒç”¨æ°¸ä¸è¿”å›ã€‚ 61 wait4 pid_t wait4(pid_t pid, int *wstatus, int options, struct rusage *rusage); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºç­‰å¾…ä¸€ä¸ªå­è¿›ç¨‹çŠ¶æ€çš„æ”¹å˜ï¼ˆå¦‚ç»ˆæ­¢æˆ–åœæ­¢ï¼‰ã€‚å®ƒå¯ä»¥ç­‰å¾…æŒ‡å®š PID çš„å­è¿›ç¨‹ï¼Œæˆ–è€…ä»»ä½•å­è¿›ç¨‹ã€‚å®ƒè¿˜å¯ä»¥åœ¨ rusage ä¸­è¿”å›å­è¿›ç¨‹çš„èµ„æºä½¿ç”¨æƒ…å†µã€‚æˆåŠŸè¿”å›å·²ç»ˆæ­¢å­è¿›ç¨‹çš„ PIDï¼Œå¤±è´¥è¿”å› -1ã€‚ 62 kill int kill(pid_t pid, int sig); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå‘æŒ‡å®šçš„è¿›ç¨‹æˆ–è¿›ç¨‹ç»„å‘é€ä¿¡å·ã€‚pid æŒ‡å®šç›®æ ‡è¿›ç¨‹ï¼Œsig æŒ‡å®šè¦å‘é€çš„ä¿¡å·ã€‚å®ƒå¯ä»¥ç”¨äºç»ˆæ­¢è¿›ç¨‹ã€æš‚åœè¿›ç¨‹æˆ–æ‰§è¡Œå…¶ä»–ä¿¡å·ç›¸å…³çš„æ“ä½œã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 63 uname int uname(struct utsname *buf); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–å½“å‰ç³»ç»Ÿçš„ä¿¡æ¯ã€‚å®ƒå°†ç³»ç»Ÿåç§°ã€ç‰ˆæœ¬å·ã€å†…æ ¸ç‰ˆæœ¬ç­‰ä¿¡æ¯å¡«å……åˆ° utsname ç»“æ„ä½“ä¸­ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 64 semget int semget(key_t key, int nsems, int semflg); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„ä¿¡å·é‡é›†æˆ–è·å–ä¸€ä¸ªå·²æœ‰çš„ä¿¡å·é‡é›†ã€‚key ç”¨äºæ ‡è¯†ä¿¡å·é‡é›†ï¼Œnsems æŒ‡å®šä¿¡å·é‡çš„æ•°é‡ï¼Œsemflg åˆ™æ§åˆ¶åˆ›å»ºæ ‡å¿—å’Œæƒé™ã€‚æˆåŠŸè¿”å›ä¿¡å·é‡é›†æ ‡è¯†ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 65 semop int semop(int semid, struct sembuf *sops, size_t nsops); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåœ¨ç”± semid æ ‡è¯†çš„ä¿¡å·é‡é›†ä¸Šæ‰§è¡ŒåŸå­æ€§çš„æ“ä½œã€‚sops æ˜¯ä¸€ä¸ª sembuf ç»“æ„ä½“æ•°ç»„ï¼Œæ¯ä¸ªç»“æ„ä½“å®šä¹‰ä¸€ä¸ªæ“ä½œã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 66 semctl int semctl(int semid, int semnum, int cmd, ...); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå¯¹ç”± semid æ ‡è¯†çš„ä¿¡å·é‡é›†æ‰§è¡Œæ§åˆ¶æ“ä½œã€‚cmd å‚æ•°æŒ‡å®šè¦æ‰§è¡Œçš„æ“ä½œï¼Œä¾‹å¦‚åˆ é™¤ä¿¡å·é‡é›†ï¼ˆIPC_RMIDï¼‰æˆ–è®¾ç½®ä¿¡å·é‡å€¼ï¼ˆSETVALï¼‰ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 67 shmdt int shmdt(const void *shmaddr); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†ç”± shmaddr æŒ‡å®šçš„å…±äº«å†…å­˜æ®µä»è°ƒç”¨è¿›ç¨‹çš„åœ°å€ç©ºé—´ä¸­åˆ†ç¦»ã€‚å®ƒä¸ä¼šåˆ é™¤å…±äº«å†…å­˜æ®µï¼Œåªæ˜¯è§£é™¤è¿›ç¨‹ä¸å…¶çš„å…³è”ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 68 msgget int msgget(key_t key, int msgflg); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„æ¶ˆæ¯é˜Ÿåˆ—æˆ–è·å–ä¸€ä¸ªå·²æœ‰çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚key ç”¨äºæ ‡è¯†æ¶ˆæ¯é˜Ÿåˆ—ï¼Œmsgflg åˆ™æ§åˆ¶åˆ›å»ºæ ‡å¿—å’Œæƒé™ã€‚æˆåŠŸè¿”å›æ¶ˆæ¯é˜Ÿåˆ—æ ‡è¯†ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 69 msgsnd int msgsnd(int msqid, const void *msgp, size_t msgsz, int msgflg); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†ä¸€æ¡æ¶ˆæ¯å‘é€åˆ°ç”± msqid æ ‡è¯†çš„æ¶ˆæ¯é˜Ÿåˆ—ã€‚msgp æŒ‡å‘æ¶ˆæ¯æ•°æ®ï¼Œmsgsz æŒ‡å®šæ¶ˆæ¯å¤§å°ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 70 msgrcv ssize_t msgrcv(int msqid, void *msgp, size_t msgsz, long msgtyp, int msgflg); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºä»ç”± msqid æ ‡è¯†çš„æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¥æ”¶ä¸€æ¡æ¶ˆæ¯ã€‚msgtyp æŒ‡å®šè¦æ¥æ”¶çš„æ¶ˆæ¯ç±»å‹ã€‚æˆåŠŸè¿”å›æ¥æ”¶çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 71 msgctl int msgctl(int msqid, int cmd, struct msqid_ds *buf); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå¯¹ç”± msqid æ ‡è¯†çš„æ¶ˆæ¯é˜Ÿåˆ—æ‰§è¡Œæ§åˆ¶æ“ä½œã€‚cmd å‚æ•°æŒ‡å®šè¦æ‰§è¡Œçš„æ“ä½œï¼Œä¾‹å¦‚åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆIPC_RMIDï¼‰æˆ–è·å–çŠ¶æ€ä¿¡æ¯ï¼ˆIPC_STATï¼‰ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 72 fcntl int fcntl(int fd, int cmd, ... /* arg */); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå¯¹æ–‡ä»¶æè¿°ç¬¦ fd æ‰§è¡Œæ§åˆ¶æ“ä½œã€‚cmd å‚æ•°æŒ‡å®šè¦æ‰§è¡Œçš„æ“ä½œï¼Œå¦‚å¤åˆ¶æ–‡ä»¶æè¿°ç¬¦ï¼ˆF_DUPFDï¼‰ã€è·å–è®¾ç½®æ–‡ä»¶çŠ¶æ€æ ‡å¿—ï¼ˆF_GETFLF_SETFLï¼‰æˆ–ç®¡ç†æ–‡ä»¶é”ã€‚æˆåŠŸè¿”å›å–å†³äº cmd çš„å€¼ï¼Œå¤±è´¥è¿”å› -1ã€‚ 73 flock int flock(int fd, int operation); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå¯¹æ•´ä¸ªæ–‡ä»¶åº”ç”¨æˆ–ç§»é™¤æ–‡ä»¶é”ã€‚fd æ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œoperation æŒ‡å®šé”çš„ç±»å‹ï¼ˆå…±äº«é” LOCK_SHã€æ’ä»–é” LOCK_EXï¼‰æˆ–æ“ä½œï¼ˆè§£é” LOCK_UNï¼‰ã€‚è¯¥é”æ˜¯å»ºè®®æ€§é”ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 74 fsync int fsync(int fd); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†æ–‡ä»¶æè¿°ç¬¦ fd æ‰€ä»£è¡¨çš„æ–‡ä»¶æ‰€æœ‰è¢«ä¿®æ”¹çš„ç¼“å†²åŒºæ•°æ®å†™å…¥åº•å±‚ç£ç›˜ï¼Œå¹¶ç­‰å¾… IO å®Œæˆã€‚è¿™ç¡®ä¿äº†æ•°æ®åœ¨ç³»ç»Ÿå´©æºƒæ—¶ä¸ä¼šä¸¢å¤±ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 75 fdatasync int fdatasync(int fd); æ­¤ç³»ç»Ÿè°ƒç”¨ä¸ fsync ç±»ä¼¼ï¼Œä½†å®ƒåªåŒæ­¥æ–‡ä»¶æ•°æ®ï¼Œä¸åŒ…æ‹¬å…ƒæ•°æ®ï¼ˆå¦‚æ–‡ä»¶å¤§å°æˆ–æ—¶é—´æˆ³ï¼‰ï¼Œé™¤éè¿™äº›å…ƒæ•°æ®å¯¹äºåç»­çš„æ•°æ®è¯»å–è‡³å…³é‡è¦ã€‚è¿™é€šå¸¸æ¯” fsync æ›´å¿«ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 76 truncate int truncate(const char *path, off_t length); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†ç”± path æŒ‡å®šçš„æ–‡ä»¶æˆªæ–­ä¸ºæŒ‡å®šçš„ length å­—èŠ‚å¤§å°ã€‚å¦‚æœæ–‡ä»¶å¤§äº lengthï¼Œåˆ™å¤šä½™çš„æ•°æ®å°†è¢«ä¸¢å¼ƒï¼›å¦‚æœæ–‡ä»¶å°äº lengthï¼Œåˆ™æ–‡ä»¶å°†è¢«æ‰©å±•ï¼Œæ‰©å±•çš„éƒ¨åˆ†å°†å¡«å……é›¶ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 77 ftruncate int ftruncate(int fd, off_t length); æ­¤ç³»ç»Ÿè°ƒç”¨ä¸ truncate ç±»ä¼¼ï¼Œä½†å®ƒé€šè¿‡æ–‡ä»¶æè¿°ç¬¦ fd æ¥æ“ä½œå·²æ‰“å¼€çš„æ–‡ä»¶ã€‚å®ƒå°†æ–‡ä»¶æˆªæ–­æˆ–æ‰©å±•åˆ°æŒ‡å®šçš„ length å­—èŠ‚å¤§å°ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 78 getdents int getdents(int fd, struct linux_dirent *dirp, unsigned int count); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè¯»å–ç”±æ–‡ä»¶æè¿°ç¬¦ fd æŒ‡å®šçš„ç›®å½•ä¸­çš„ç›®å½•é¡¹ã€‚å®ƒå°†ç›®å½•é¡¹ä¿¡æ¯å¡«å……åˆ° dirp ç¼“å†²åŒºä¸­ï¼Œæœ€å¤šè¯»å– count å­—èŠ‚ã€‚è¿”å›å€¼ä¸ºå®é™…è¯»å–çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 79 getcwd char *getcwd(char *buf, size_t size); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–è°ƒç”¨è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•çš„ç»å¯¹è·¯å¾„åã€‚è·¯å¾„åè¢«å¤åˆ¶åˆ° buf ä¸­ï¼Œæœ€å¤š size å­—èŠ‚ã€‚æˆåŠŸè¿”å› bufï¼Œå¤±è´¥è¿”å› NULLã€‚ 80 chdir int chdir(const char *path); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†è°ƒç”¨è¿›ç¨‹çš„å½“å‰å·¥ä½œç›®å½•æ›´æ”¹ä¸ºç”± path æŒ‡å®šçš„ç›®å½•ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 81 fchdir int fchdir(int fd); æ­¤ç³»ç»Ÿè°ƒç”¨ä¸ chdir ç±»ä¼¼ï¼Œä½†å®ƒé€šè¿‡æ–‡ä»¶æè¿°ç¬¦ fd æ¥æ›´æ”¹å½“å‰å·¥ä½œç›®å½•ã€‚è¿™å…è®¸åœ¨ä¸æŒ‡å®šè·¯å¾„åçš„æƒ…å†µä¸‹æ›´æ”¹ç›®å½•ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 82 rename int rename(const char *oldpath, const char *newpath); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæ›´æ”¹æ–‡ä»¶æˆ–ç›®å½•çš„åç§°æˆ–ä½ç½®ã€‚å®ƒå°† oldpath æŒ‡å®šçš„æ–‡ä»¶æˆ–ç›®å½•é‡å‘½åä¸º newpathã€‚å¦‚æœ newpath å·²ç»å­˜åœ¨ï¼Œåˆ™å®ƒä¼šè¢«åŸå­æ€§åœ°æ›¿æ¢ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 83 mkdir int mkdir(const char *pathname, mode_t mode); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„ç›®å½•ã€‚pathname æŒ‡å®šæ–°ç›®å½•çš„è·¯å¾„ï¼Œmode åˆ™æŒ‡å®šæ–°ç›®å½•çš„æƒé™ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 84 rmdir int rmdir(const char *pathname); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ é™¤ä¸€ä¸ªç©ºç›®å½•ã€‚å¦‚æœç›®å½•ä¸ä¸ºç©ºï¼Œåˆ™æ­¤è°ƒç”¨ä¼šå¤±è´¥ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 85 creat int creat(const char *pathname, mode_t mode); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºå¹¶æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ã€‚å¦‚æœæ–‡ä»¶å·²ç»å­˜åœ¨ï¼Œåˆ™å…¶å†…å®¹ä¼šè¢«æˆªæ–­ä¸ºé›¶å­—èŠ‚ã€‚å®ƒç­‰åŒäº open(pathname, O_CREAT 86 link int link(const char *oldpath, const char *newpath); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€ä¸ªç¡¬é“¾æ¥ã€‚å®ƒå°† newpath æŒ‡å‘ä¸ oldpath ç›¸åŒçš„åº•å±‚æ–‡ä»¶ã€‚ç¡¬é“¾æ¥ä¸èƒ½è·¨è¶Šæ–‡ä»¶ç³»ç»Ÿï¼Œä¹Ÿä¸èƒ½é“¾æ¥åˆ°ç›®å½•ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 87 unlink int unlink(const char *pathname); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ é™¤æ–‡ä»¶ç³»ç»Ÿä¸­çš„ä¸€ä¸ªåç§°ã€‚å¦‚æœ pathname æ˜¯ä¸€ä¸ªæ–‡ä»¶çš„æœ€åä¸€ä¸ªç¡¬é“¾æ¥ï¼Œå¹¶ä¸”æ²¡æœ‰ä»»ä½•è¿›ç¨‹æ‰“å¼€è¯¥æ–‡ä»¶ï¼Œé‚£ä¹ˆæ–‡ä»¶æœ¬èº«å°†è¢«åˆ é™¤ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 88 symlink int symlink(const char *target, const char *linkpath); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€ä¸ªç¬¦å·é“¾æ¥ï¼ˆè½¯é“¾æ¥ï¼‰ã€‚å®ƒå°† linkpath åˆ›å»ºä¸ºæŒ‡å‘ target çš„ç¬¦å·é“¾æ¥ã€‚target å¯ä»¥æ˜¯æ–‡ä»¶æˆ–ç›®å½•ï¼Œå¹¶ä¸”å¯ä»¥è·¨è¶Šæ–‡ä»¶ç³»ç»Ÿã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 89 readlink ssize_t readlink(const char *pathname, char *buf, size_t bufsiz); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè¯»å–ç”± pathname æŒ‡å®šçš„ç¬¦å·é“¾æ¥çš„å€¼ï¼ˆå³å®ƒæ‰€æŒ‡å‘çš„è·¯å¾„ï¼‰ã€‚å®ƒå°†è·¯å¾„åå¤åˆ¶åˆ° buf ä¸­ï¼Œæœ€å¤š bufsiz å­—èŠ‚ã€‚æˆåŠŸè¿”å›è¯»å–çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 90 chmod int chmod(const char *pathname, mode_t mode); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæ”¹å˜ç”± pathname æŒ‡å®šçš„æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ã€‚mode å‚æ•°æŒ‡å®šæ–°çš„æƒé™ä½æ©ç ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 91 fchmod int fchmod(int fd, mode_t mode); æ­¤ç³»ç»Ÿè°ƒç”¨ä¸ chmod ç±»ä¼¼ï¼Œä½†å®ƒé€šè¿‡æ–‡ä»¶æè¿°ç¬¦ fd æ¥æ”¹å˜å·²æ‰“å¼€æ–‡ä»¶çš„æƒé™ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 92 chown int chown(const char *pathname, uid_t owner, gid_t group); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæ”¹å˜ç”± pathname æŒ‡å®šçš„æ–‡ä»¶æˆ–ç›®å½•çš„æ‰€æœ‰è€…å’Œç»„ã€‚owner å’Œ group åˆ†åˆ«æŒ‡å®šæ–°çš„ç”¨æˆ· ID å’Œç»„ IDã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 93 fchown int fchown(int fd, uid_t owner, gid_t group); æ­¤ç³»ç»Ÿè°ƒç”¨ä¸ chown ç±»ä¼¼ï¼Œä½†å®ƒé€šè¿‡æ–‡ä»¶æè¿°ç¬¦ fd æ¥æ”¹å˜å·²æ‰“å¼€æ–‡ä»¶çš„æ‰€æœ‰è€…å’Œç»„ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 94 lchown int lchown(const char *pathname, uid_t owner, gid_t group); æ­¤ç³»ç»Ÿè°ƒç”¨ä¸ chown ç±»ä¼¼ï¼Œä½†å¦‚æœ pathname æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼Œå®ƒä¼šæ”¹å˜ç¬¦å·é“¾æ¥æœ¬èº«çš„æ‰€æœ‰è€…å’Œç»„ï¼Œè€Œä¸æ˜¯å®ƒæ‰€æŒ‡å‘çš„æ–‡ä»¶ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 95 umask mode_t umask(mode_t mask); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®æ–‡ä»¶åˆ›å»ºæ©ç ï¼Œå¹¶è¿”å›æ—§çš„æ©ç ã€‚æ–‡ä»¶åˆ›å»ºæ©ç ç”¨äºé™åˆ¶æ–°æ–‡ä»¶å’Œç›®å½•çš„æƒé™ã€‚mask å‚æ•°ä¸­çš„ä½åœ¨åˆ›å»ºæ–‡ä»¶æ—¶ä¼šè¢«æ¸…é›¶ã€‚ 96 gettimeofday int gettimeofday(struct timeval *tv, struct timezone *tz); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–å½“å‰æ—¶é—´å’Œæ—¶åŒºä¿¡æ¯ã€‚tv ç»“æ„ä½“ä¸­åŒ…å«ç§’æ•°å’Œå¾®ç§’æ•°ï¼Œtz ç»“æ„ä½“ï¼ˆé€šå¸¸è¢«å¿½ç•¥ï¼‰åŒ…å«æ—¶åŒºä¿¡æ¯ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 97 getrlimit int getrlimit(int resource, struct rlimit *rlim); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–è°ƒç”¨è¿›ç¨‹çš„èµ„æºé™åˆ¶ã€‚resource æŒ‡å®šè¦æŸ¥è¯¢çš„èµ„æºç±»å‹ï¼Œä¾‹å¦‚ RLIMIT_NOFILEï¼ˆæœ€å¤§æ–‡ä»¶æè¿°ç¬¦æ•°ï¼‰ã€‚rlim ç»“æ„ä½“ç”¨äºå­˜å‚¨è½¯é™åˆ¶å’Œç¡¬é™åˆ¶ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 98 getrusage int getrusage(int who, struct rusage *usage); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–è°ƒç”¨è¿›ç¨‹æˆ–å…¶å­è¿›ç¨‹çš„èµ„æºä½¿ç”¨æƒ…å†µã€‚who å‚æ•°æŒ‡å®šè¦æŸ¥è¯¢çš„å¯¹è±¡ï¼Œä¾‹å¦‚ RUSAGE_SELFï¼ˆå½“å‰è¿›ç¨‹ï¼‰æˆ– RUSAGE_CHILDRENï¼ˆå·²ç»ˆæ­¢çš„å­è¿›ç¨‹ï¼‰ã€‚usage ç»“æ„ä½“ç”¨äºå­˜å‚¨ä½¿ç”¨æƒ…å†µã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 99 sysinfo int sysinfo(struct sysinfo *info); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–å…³äºç³»ç»Ÿæ•´ä½“çš„ç»Ÿè®¡ä¿¡æ¯ã€‚å®ƒå°†å†…å­˜ã€äº¤æ¢ç©ºé—´ã€è¿›ç¨‹æ•°ç­‰ä¿¡æ¯å¡«å……åˆ° sysinfo ç»“æ„ä½“ä¸­ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 100 times clock_t times(struct tms *buf); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–è°ƒç”¨è¿›ç¨‹åŠå…¶å·²ç»ˆæ­¢å­è¿›ç¨‹çš„ç”¨æˆ·å’Œç³»ç»Ÿ CPU æ—¶é—´ã€‚è¿™äº›æ—¶é—´ä¿¡æ¯è¢«å¡«å……åˆ° tms ç»“æ„ä½“ä¸­ã€‚æˆåŠŸè¿”å›è‡ªæŸä¸ªä»»æ„æ—¶é—´ç‚¹ï¼ˆå¦‚ç³»ç»Ÿå¯åŠ¨ï¼‰ä»¥æ¥çš„æ—¶é’Ÿæ»´ç­”æ•°ï¼Œå¤±è´¥è¿”å› (clock_t)-1ã€‚ 101 ptrace long ptrace(enum ptrace_request request, pid_t pid, void *addr, void *data); æ­¤ç³»ç»Ÿè°ƒç”¨ä¸ºè¿›ç¨‹æä¾›äº†å¯¹å¦ä¸€ä¸ªè¿›ç¨‹ï¼ˆè·Ÿè¸ªå¯¹è±¡ï¼‰çš„æ§åˆ¶ã€‚å®ƒå…è®¸ä¸€ä¸ªè¿›ç¨‹æ£€æŸ¥å’Œä¿®æ”¹å¦ä¸€ä¸ªè¿›ç¨‹çš„å†…å­˜å’Œå¯„å­˜å™¨ï¼Œå¹¶æ§åˆ¶å…¶æ‰§è¡Œã€‚è¿™é€šå¸¸ç”¨äºå®ç°è°ƒè¯•å™¨å’Œè·Ÿè¸ªå·¥å…·ã€‚æˆåŠŸè¿”å›å–å†³äº request çš„å€¼ï¼Œå¤±è´¥è¿”å› -1ã€‚ 102 getuid uid_t getuid(void); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–è°ƒç”¨è¿›ç¨‹çš„å®é™…ç”¨æˆ· IDã€‚è¿”å›å€¼ä¸ºå®é™…ç”¨æˆ· IDã€‚ 103 syslog int syslog(int type, char *bufp, int len); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºä¸å†…æ ¸æ—¥å¿—ç¼“å†²åŒºè¿›è¡Œäº¤äº’ã€‚å®ƒå¯ä»¥ç”¨äºè¯»å–ã€æ¸…ç©ºæˆ–æ§åˆ¶å†…æ ¸æ—¥å¿—ã€‚è¿”å›å€¼ä¸ºè¯»å–çš„å­—èŠ‚æ•°ï¼Œæˆ–å–å†³äº type çš„å€¼ï¼Œå¤±è´¥è¿”å› -1ã€‚ 104 getgid gid_t getgid(void); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–è°ƒç”¨è¿›ç¨‹çš„å®é™…ç»„ IDã€‚è¿”å›å€¼ä¸ºå®é™…ç»„ IDã€‚ 105 setuid int setuid(uid_t uid); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®è°ƒç”¨è¿›ç¨‹çš„å®é™…ç”¨æˆ· IDã€æœ‰æ•ˆç”¨æˆ· ID å’Œä¿å­˜çš„ç”¨æˆ· IDã€‚å¦‚æœè¿›ç¨‹å…·æœ‰é€‚å½“çš„æƒé™ï¼Œå®ƒå¯ä»¥ç”¨äºæ›´æ”¹å…¶èº«ä»½ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 106 setgid int setgid(gid_t gid); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®è°ƒç”¨è¿›ç¨‹çš„å®é™…ç»„ IDã€æœ‰æ•ˆç»„ ID å’Œä¿å­˜çš„ç»„ IDã€‚å¦‚æœè¿›ç¨‹å…·æœ‰é€‚å½“çš„æƒé™ï¼Œå®ƒå¯ä»¥ç”¨äºæ›´æ”¹å…¶ç»„èº«ä»½ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 107 geteuid uid_t geteuid(void); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–è°ƒç”¨è¿›ç¨‹çš„æœ‰æ•ˆç”¨æˆ· IDã€‚æœ‰æ•ˆç”¨æˆ· ID ç”¨äºç¡®å®šæ–‡ä»¶è®¿é—®æƒé™ã€‚è¿”å›å€¼ä¸ºæœ‰æ•ˆç”¨æˆ· IDã€‚ 108 getegid gid_t getegid(void); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–è°ƒç”¨è¿›ç¨‹çš„æœ‰æ•ˆç»„ IDã€‚æœ‰æ•ˆç»„ ID ç”¨äºç¡®å®šæ–‡ä»¶è®¿é—®æƒé™ã€‚è¿”å›å€¼ä¸ºæœ‰æ•ˆç»„ IDã€‚ 109 setpgid int setpgid(pid_t pid, pid_t pgid); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®æŒ‡å®šè¿›ç¨‹çš„è¿›ç¨‹ç»„ IDã€‚pid æŒ‡å®šç›®æ ‡è¿›ç¨‹ï¼Œpgid æŒ‡å®šæ–°çš„è¿›ç¨‹ç»„ IDã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 110 getppid pid_t getppid(void); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–è°ƒç”¨è¿›ç¨‹çš„çˆ¶è¿›ç¨‹ IDã€‚è¿”å›å€¼ä¸ºçˆ¶è¿›ç¨‹ IDã€‚ 111 getpgrp pid_t getpgrp(void); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–è°ƒç”¨è¿›ç¨‹çš„è¿›ç¨‹ç»„ IDã€‚è¿”å›å€¼ä¸ºè¿›ç¨‹ç»„ IDã€‚ 112 setsid pid_t setsid(void); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„ä¼šè¯ã€‚è°ƒç”¨è¿›ç¨‹æˆä¸ºæ–°ä¼šè¯çš„ä¼šè¯é¢†å¯¼è€…ï¼Œå¹¶æˆä¸ºä¸€ä¸ªæ–°çš„è¿›ç¨‹ç»„çš„é¢†å¯¼è€…ã€‚æ­¤è°ƒç”¨é€šå¸¸ç”¨äºåˆ›å»ºå®ˆæŠ¤è¿›ç¨‹ã€‚æˆåŠŸè¿”å›æ–°çš„ä¼šè¯ IDï¼Œå¤±è´¥è¿”å› -1ã€‚ 113 setreuid int setreuid(uid_t ruid, uid_t euid); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®è°ƒç”¨è¿›ç¨‹çš„å®é™…å’Œæœ‰æ•ˆç”¨æˆ· IDã€‚ruid è®¾ç½®å®é™…ç”¨æˆ· IDï¼Œeuid è®¾ç½®æœ‰æ•ˆç”¨æˆ· IDã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 114 setregid int setregid(gid_t rgid, gid_t egid); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®è°ƒç”¨è¿›ç¨‹çš„å®é™…å’Œæœ‰æ•ˆç»„ IDã€‚rgid è®¾ç½®å®é™…ç»„ IDï¼Œegid è®¾ç½®æœ‰æ•ˆç»„ IDã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 115 getgroups int getgroups(int gidsetsize, gid_t grouplist[]); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–è°ƒç”¨è¿›ç¨‹çš„é™„åŠ ç»„ ID åˆ—è¡¨ã€‚å®ƒå°†è¿™äº› ID å­˜å‚¨åœ¨ grouplist æ•°ç»„ä¸­ï¼Œæœ€å¤š gidsetsize ä¸ªã€‚è¿”å›å€¼ä¸ºå®é™…è·å–çš„ç»„ ID æ•°é‡ï¼Œå¤±è´¥è¿”å› -1ã€‚ 116 setgroups int setgroups(size_t gidsetsize, const gid_t *grouplist); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®è°ƒç”¨è¿›ç¨‹çš„é™„åŠ ç»„ ID åˆ—è¡¨ã€‚å®ƒå°†åˆ—è¡¨è®¾ç½®ä¸ºç”± grouplist æŒ‡å‘çš„æ•°ç»„ï¼Œå…¶ä¸­åŒ…å« gidsetsize ä¸ª IDã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 117 setresuid int setresuid(uid_t ruid, uid_t euid, uid_t suid); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®è°ƒç”¨è¿›ç¨‹çš„å®é™…ã€æœ‰æ•ˆå’Œä¿å­˜çš„ç”¨æˆ· IDã€‚ruidã€euid å’Œ suid åˆ†åˆ«æŒ‡å®šæ–°çš„ IDã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 118 getresuid int getresuid(uid_t *ruid, uid_t *euid, uid_t *suid); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–è°ƒç”¨è¿›ç¨‹çš„å®é™…ã€æœ‰æ•ˆå’Œä¿å­˜çš„ç”¨æˆ· IDï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨ç›¸åº”çš„æŒ‡é’ˆæŒ‡å‘çš„å˜é‡ä¸­ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 119 setresgid int setresgid(gid_t rgid, gid_t egid, gid_t sgid); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®è°ƒç”¨è¿›ç¨‹çš„å®é™…ã€æœ‰æ•ˆå’Œä¿å­˜çš„ç»„ IDã€‚rgidã€egid å’Œ sgid åˆ†åˆ«æŒ‡å®šæ–°çš„ IDã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 120 getresgid int getresgid(gid_t *rgid, gid_t *egid, gid_t *sgid); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–è°ƒç”¨è¿›ç¨‹çš„å®é™…ã€æœ‰æ•ˆå’Œä¿å­˜çš„ç»„ IDï¼Œå¹¶å°†å®ƒä»¬å­˜å‚¨åœ¨ç›¸åº”çš„æŒ‡é’ˆæŒ‡å‘çš„å˜é‡ä¸­ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 121 getpgid pid_t getpgid(pid_t pid); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–æŒ‡å®šè¿›ç¨‹ pid çš„è¿›ç¨‹ç»„ IDã€‚å¦‚æœ pid ä¸º 0ï¼Œåˆ™è·å–è°ƒç”¨è¿›ç¨‹çš„è¿›ç¨‹ç»„ IDã€‚è¿”å›å€¼ä¸ºè¿›ç¨‹ç»„ IDï¼Œå¤±è´¥è¿”å› -1ã€‚ 122 setfsuid int setfsuid(uid_t fsuid); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®è°ƒç”¨è¿›ç¨‹çš„æ–‡ä»¶ç³»ç»Ÿç”¨æˆ· IDã€‚æ–‡ä»¶ç³»ç»Ÿç”¨æˆ· ID ç”¨äºåœ¨æ–‡ä»¶ç³»ç»Ÿæ“ä½œæ—¶æ£€æŸ¥æƒé™ã€‚å®ƒé€šå¸¸ä¸æœ‰æ•ˆç”¨æˆ· ID ç›¸åŒã€‚æˆåŠŸè¿”å›æ—§çš„æ–‡ä»¶ç³»ç»Ÿç”¨æˆ· IDï¼Œå¤±è´¥è¿”å› -1ã€‚ 123 setfsgid int setfsgid(gid_t fsgid); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®è°ƒç”¨è¿›ç¨‹çš„æ–‡ä»¶ç³»ç»Ÿç»„ IDã€‚æ–‡ä»¶ç³»ç»Ÿç»„ ID ç”¨äºåœ¨æ–‡ä»¶ç³»ç»Ÿæ“ä½œæ—¶æ£€æŸ¥æƒé™ã€‚å®ƒé€šå¸¸ä¸æœ‰æ•ˆç»„ ID ç›¸åŒã€‚æˆåŠŸè¿”å›æ—§çš„æ–‡ä»¶ç³»ç»Ÿç»„ IDï¼Œå¤±è´¥è¿”å› -1ã€‚ 124 getsid pid_t getsid(pid_t pid); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–æŒ‡å®šè¿›ç¨‹ pid çš„ä¼šè¯ IDã€‚å¦‚æœ pid ä¸º 0ï¼Œåˆ™è·å–è°ƒç”¨è¿›ç¨‹çš„ä¼šè¯ IDã€‚è¿”å›å€¼ä¸ºä¼šè¯ IDï¼Œå¤±è´¥è¿”å› -1ã€‚ 125 capget int capget(cap_user_header_t header, cap_user_data_t data); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–è°ƒç”¨çº¿ç¨‹æˆ–æŒ‡å®šçº¿ç¨‹çš„èƒ½åŠ›ã€‚header ç»“æ„ä½“æä¾›ç‰ˆæœ¬ä¿¡æ¯ï¼Œdata ç»“æ„ä½“ç”¨äºå­˜å‚¨è·å–çš„èƒ½åŠ›ä½æ©ç ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 126 capset int capset(cap_user_header_t header, const cap_user_data_t data); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®è°ƒç”¨çº¿ç¨‹æˆ–æŒ‡å®šçº¿ç¨‹çš„èƒ½åŠ›ã€‚header ç»“æ„ä½“æä¾›ç‰ˆæœ¬ä¿¡æ¯ï¼Œdata ç»“æ„ä½“ç”¨äºæŒ‡å®šè¦è®¾ç½®çš„èƒ½åŠ›ä½æ©ç ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 127 rt_sigpending int rt_sigpending(sigset_t *set, size_t sigsetsize); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–å½“å‰æŒ‚èµ·çš„ã€è¢«é˜»å¡çš„ä¿¡å·é›†åˆã€‚set ç»“æ„ä½“ç”¨äºå­˜å‚¨è¿™äº›ä¿¡å·ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 128 rt_sigtimedwait int rt_sigtimedwait(const sigset_t *set, siginfo_t *info, const struct timespec *timeout, size_t sigsetsize); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºç­‰å¾… set é›†åˆä¸­çš„ä»»ä½•ä¿¡å·ä¼ é€’ã€‚å¦‚æœä¸€ä¸ªä¿¡å·è¢«æ¥æ”¶ï¼Œè¯¥è°ƒç”¨ä¼šè¿”å›ï¼Œä¿¡å·ä¿¡æ¯å­˜å‚¨åœ¨ info ä¸­ã€‚timeout å‚æ•°æŒ‡å®šç­‰å¾…çš„è¶…æ—¶æ—¶é—´ã€‚æˆåŠŸè¿”å›ä¿¡å·ç¼–å·ï¼Œå¤±è´¥è¿”å› -1ã€‚ 129 rt_sigqueueinfo int rt_sigqueueinfo(pid_t pid, int sig, siginfo_t *uinfo); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå‘æŒ‡å®šçš„è¿›ç¨‹ pid å‘é€ä¸€ä¸ªä¿¡å· sigï¼Œå¹¶ä¼ é€’ä¸€ä¸ª siginfo_t ç»“æ„ä½“ã€‚è¿™å…è®¸åœ¨ä¿¡å·ä¸­æºå¸¦é¢å¤–çš„ä¿¡æ¯ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 130 rt_sigsuspend int rt_sigsuspend(const sigset_t *set, size_t sigsetsize); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºä¸´æ—¶æ›¿æ¢è¿›ç¨‹çš„ä¿¡å·æ©ç ï¼Œå¹¶ä½¿è¿›ç¨‹è¿›å…¥ç¡çœ çŠ¶æ€ï¼Œç›´åˆ°æ¥æ”¶åˆ°ä¸€ä¸ªæœªè¢«é˜»å¡çš„ä¿¡å·ã€‚æˆåŠŸæ—¶ï¼Œæ­¤è°ƒç”¨æ°¸è¿œä¸ä¼šè¿”å›ã€‚å¦‚æœè¢«ä¿¡å·ä¸­æ–­ï¼Œå®ƒè¿”å› -1 å¹¶è®¾ç½® errno ä¸º EINTRã€‚ 131 sigaltstack int sigaltstack(const stack_t *ss, stack_t *old_ss); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®æˆ–è·å–ä¿¡å·å¤„ç†ç¨‹åºçš„å¤‡ç”¨æ ˆã€‚è¿™å¯ä»¥ç”¨äºå¤„ç† SIGSEGV æˆ– SIGBUS ç­‰ä¿¡å·ï¼Œä»¥é¿å…åœ¨ä¸»æ ˆä¸Šå¤„ç†ä¿¡å·æ—¶å‡ºç°æ ˆæº¢å‡ºã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 132 utime int utime(const char *filename, const struct utimbuf *times); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæ”¹å˜æŒ‡å®šæ–‡ä»¶ filename çš„è®¿é—®å’Œä¿®æ”¹æ—¶é—´ã€‚times ç»“æ„ä½“åŒ…å«äº†æ–°çš„è®¿é—®æ—¶é—´å’Œä¿®æ”¹æ—¶é—´ã€‚å¦‚æœ times ä¸º NULLï¼Œåˆ™æ—¶é—´å°†è¢«è®¾ç½®ä¸ºå½“å‰æ—¶é—´ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 133 mknod int mknod(const char *pathname, mode_t mode, dev_t dev); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåœ¨æ–‡ä»¶ç³»ç»Ÿä¸Šåˆ›å»ºä¸€ä¸ªç‰¹æ®Šæ–‡ä»¶ã€‚pathname æŒ‡å®šè·¯å¾„ï¼Œmode æŒ‡å®šæ–‡ä»¶ç±»å‹å’Œæƒé™ï¼Œdev ç”¨äºè®¾å¤‡æ–‡ä»¶ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 134 uselib int uselib(const char *library); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåŠ è½½å…±äº«åº“ã€‚å®ƒå·²ç»è¢«å¼ƒç”¨ï¼Œä¸å†æ¨èä½¿ç”¨ã€‚ 135 personality int personality(unsigned long persona); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–æˆ–è®¾ç½®è°ƒç”¨è¿›ç¨‹çš„æ‰§è¡ŒåŸŸï¼ˆpersonalityï¼‰ã€‚æ‰§è¡ŒåŸŸä¼šå½±å“æŸäº›ç³»ç»Ÿè°ƒç”¨çš„è¡Œä¸ºï¼Œä¾‹å¦‚ fork å’Œ execveã€‚æˆåŠŸè¿”å›æ—§çš„ persona å€¼ï¼Œå¤±è´¥è¿”å› -1ã€‚ 136 ustat int ustat(dev_t dev, struct ustat *ubuf); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–ä¸€ä¸ªæŒ‚è½½æ–‡ä»¶ç³»ç»Ÿçš„ç»Ÿè®¡ä¿¡æ¯ã€‚dev æŒ‡å®šè®¾å¤‡å·ï¼Œubuf ç»“æ„ä½“ç”¨äºå­˜å‚¨å¯ç”¨å—æ•°å’Œå¯ç”¨èŠ‚ç‚¹æ•°ç­‰ä¿¡æ¯ã€‚æ­¤è°ƒç”¨å·²è¢«å¼ƒç”¨ï¼Œæ¨èä½¿ç”¨ statfs æˆ– fstatfsã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 137 statfs int statfs(const char *path, struct statfs *buf); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–åŒ…å« path çš„æ–‡ä»¶ç³»ç»Ÿçš„ç»Ÿè®¡ä¿¡æ¯ã€‚buf ç»“æ„ä½“ç”¨äºå­˜å‚¨æ–‡ä»¶ç³»ç»Ÿç±»å‹ã€æ€»å—æ•°ã€ç©ºé—²å—æ•°ç­‰ä¿¡æ¯ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 138 fstatfs int fstatfs(int fd, struct statfs *buf); æ­¤ç³»ç»Ÿè°ƒç”¨ä¸ statfs ç±»ä¼¼ï¼Œä½†å®ƒé€šè¿‡æ–‡ä»¶æè¿°ç¬¦ fd æ¥è·å–æ–‡ä»¶ç³»ç»Ÿçš„ç»Ÿè®¡ä¿¡æ¯ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 139 sysfs int sysfs(int option, ...); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–æˆ–è®¾ç½®å†…æ ¸çš„ sysfs æ–‡ä»¶ç³»ç»Ÿç›¸å…³ä¿¡æ¯ã€‚å®ƒä¸»è¦ç”¨äºè·å–æ–‡ä»¶ç³»ç»Ÿçš„ç±»å‹æˆ–æŒ‚è½½ç‚¹ä¿¡æ¯ã€‚æ­¤è°ƒç”¨å·²è¢«å¼ƒç”¨ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 140 getpriority int getpriority(int which, id_t who); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–è¿›ç¨‹ã€è¿›ç¨‹ç»„æˆ–ç”¨æˆ·ä¼˜å…ˆçº§ã€‚which æŒ‡å®šè¦æŸ¥è¯¢çš„å¯¹è±¡ç±»å‹ï¼Œwho æŒ‡å®šå…¶ IDã€‚è¿”å›å€¼ä¸ºä¼˜å…ˆçº§å€¼ï¼Œå¤±è´¥è¿”å› -1ã€‚ 141 setpriority int setpriority(int which, id_t who, int prio); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®è¿›ç¨‹ã€è¿›ç¨‹ç»„æˆ–ç”¨æˆ·ä¼˜å…ˆçº§ã€‚prio å‚æ•°æŒ‡å®šæ–°çš„ä¼˜å…ˆçº§å€¼ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 142 sched_setparam int sched_setparam(pid_t pid, const struct sched_param *param); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®æŒ‡å®šè¿›ç¨‹çš„è°ƒåº¦å‚æ•°ã€‚pid æŒ‡å®šç›®æ ‡è¿›ç¨‹ï¼Œparam ç»“æ„ä½“åŒ…å«äº†è°ƒåº¦å‚æ•°ï¼ˆå¦‚ä¼˜å…ˆçº§ï¼‰ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 143 sched_getparam int sched_getparam(pid_t pid, struct sched_param *param); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–æŒ‡å®šè¿›ç¨‹çš„è°ƒåº¦å‚æ•°ã€‚param ç»“æ„ä½“ç”¨äºå­˜å‚¨è·å–çš„å‚æ•°ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 144 sched_setscheduler int sched_setscheduler(pid_t pid, int policy, const struct sched_param *param); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®æŒ‡å®šè¿›ç¨‹çš„è°ƒåº¦ç­–ç•¥å’Œå‚æ•°ã€‚policy æŒ‡å®šè°ƒåº¦ç­–ç•¥ï¼Œå¦‚ SCHED_FIFO æˆ– SCHED_RRã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 145 sched_getscheduler int sched_getscheduler(pid_t pid); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–æŒ‡å®šè¿›ç¨‹çš„è°ƒåº¦ç­–ç•¥ã€‚è¿”å›å€¼ä¸ºè°ƒåº¦ç­–ç•¥ï¼ˆå¦‚ SCHED_FIFO æˆ– SCHED_RRï¼‰ï¼Œå¤±è´¥è¿”å› -1ã€‚ 146 sched_get_priority_max int sched_get_priority_max(int policy); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–æŒ‡å®šè°ƒåº¦ç­–ç•¥çš„æœ€é«˜ä¼˜å…ˆçº§å€¼ã€‚è¿”å›å€¼ä¸ºæœ€é«˜ä¼˜å…ˆçº§å€¼ï¼Œå¤±è´¥è¿”å› -1ã€‚ 147 sched_get_priority_min int sched_get_priority_min(int policy); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–æŒ‡å®šè°ƒåº¦ç­–ç•¥çš„æœ€ä½ä¼˜å…ˆçº§å€¼ã€‚è¿”å›å€¼ä¸ºæœ€ä½ä¼˜å…ˆçº§å€¼ï¼Œå¤±è´¥è¿”å› -1ã€‚ 148 sched_rr_get_interval int sched_rr_get_interval(pid_t pid, struct timespec *tp); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–æŒ‡å®šè¿›ç¨‹çš„ SCHED_RR è°ƒåº¦ç­–ç•¥çš„æ—¶é—´ç‰‡ï¼ˆtime sliceï¼‰é—´éš”ã€‚tp ç»“æ„ä½“ç”¨äºå­˜å‚¨è¯¥é—´éš”ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 149 mlock int mlock(const void *addr, size_t len); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†æŒ‡å®šå†…å­˜åŒºåŸŸé”å®šåœ¨ç‰©ç†å†…å­˜ä¸­ã€‚è¿™å¯ä»¥é˜²æ­¢è¯¥åŒºåŸŸè¢«æ¢å‡ºåˆ°äº¤æ¢ç©ºé—´ï¼Œå¯¹äºéœ€è¦å®æ—¶æ€§èƒ½çš„åº”ç”¨éå¸¸æœ‰ç”¨ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 150 munlock int munlock(const void *addr, size_t len); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè§£é™¤å¯¹æŒ‡å®šå†…å­˜åŒºåŸŸçš„é”å®šï¼Œå…è®¸å…¶è¢«æ¢å‡ºåˆ°äº¤æ¢ç©ºé—´ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 151 mlockall int mlockall(int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºé”å®šè°ƒç”¨è¿›ç¨‹çš„æ‰€æœ‰å½“å‰å’Œæœªæ¥çš„å†…å­˜ã€‚flags å‚æ•°æ§åˆ¶é”å®šèŒƒå›´ï¼Œä¾‹å¦‚ MCL_CURRENTï¼ˆå½“å‰å†…å­˜ï¼‰å’Œ MCL_FUTUREï¼ˆæœªæ¥å†…å­˜ï¼‰ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 152 munlockall int munlockall(void); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè§£é™¤å¯¹è°ƒç”¨è¿›ç¨‹æ‰€æœ‰å†…å­˜çš„é”å®šã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 153 vhangup int vhangup(void); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæ¨¡æ‹Ÿè™šæ‹Ÿç»ˆç«¯çš„æŒ‚æ–­æ“ä½œï¼Œä»è€Œå…³é—­æ‰€æœ‰ä¸å½“å‰è™šæ‹Ÿç»ˆç«¯ç›¸å…³çš„ç»ˆç«¯è®¾å¤‡ã€‚è¿™ä¸»è¦ç”± init è¿›ç¨‹ç”¨äºç³»ç»Ÿé‡å¯ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 154 modify_ldt int modify_ldt(int func, void *ptr, unsigned long bytecount); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºä¿®æ”¹æœ¬åœ°æè¿°ç¬¦è¡¨ï¼ˆLDTï¼‰ã€‚func æŒ‡å®šæ“ä½œç±»å‹ï¼ˆå¦‚è¯»æˆ–å†™ï¼‰ï¼Œptr æŒ‡å‘æ•°æ®ï¼Œbytecount æŒ‡å®šå­—èŠ‚æ•°ã€‚æ­¤è°ƒç”¨é€šå¸¸ç”± C åº“ä½¿ç”¨ï¼Œä¸åº”ç”±æ™®é€šåº”ç”¨ç¨‹åºç›´æ¥è°ƒç”¨ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 155 pivot_root int pivot_root(const char *new_root, const char *put_old); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæ”¹å˜è¿›ç¨‹çš„æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚å®ƒå°†å½“å‰æ ¹æ–‡ä»¶ç³»ç»Ÿç§»åŠ¨åˆ° put_oldï¼Œå¹¶å°† new_root è®¾ç½®ä¸ºæ–°çš„æ ¹æ–‡ä»¶ç³»ç»Ÿã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 156 _sysctl int _sysctl(struct __sysctl_args *args); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåœ¨è¿è¡Œæ—¶é…ç½®å†…æ ¸å‚æ•°ã€‚å®ƒé€šè¿‡ __sysctl_args ç»“æ„ä½“æ¥æŒ‡å®šè¦æ“ä½œçš„å‚æ•°ã€‚æ­¤è°ƒç”¨å·²è¢«å¼ƒç”¨ï¼Œæ¨èä½¿ç”¨ /proc/sys æ–‡ä»¶ç³»ç»Ÿã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 157 prctl int prctl(int option, unsigned long arg2, unsigned long arg3, unsigned long arg4, unsigned long arg5); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå¯¹è°ƒç”¨è¿›ç¨‹æ‰§è¡Œç‰¹å®šçš„æ“ä½œã€‚option æŒ‡å®šæ“ä½œç±»å‹ï¼Œä¾‹å¦‚è®¾ç½®è¿›ç¨‹çš„åç§°ï¼ˆPR_SET_NAMEï¼‰æˆ–æ§åˆ¶å…¶èƒ½åŠ›ã€‚è¿”å›å€¼ä¸º option ç›¸å…³çš„ç»“æœï¼Œå¤±è´¥è¿”å› -1ã€‚ 158 arch_prctl int arch_prctl(int code, unsigned long addr); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå¯¹è¿›ç¨‹æ‰§è¡Œç‰¹å®šäºæ¶æ„çš„æ“ä½œã€‚code æŒ‡å®šæ“ä½œç±»å‹ï¼Œä¾‹å¦‚è®¾ç½® fs æˆ– gs æ®µå¯„å­˜å™¨çš„åŸºå€ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 159 adjtimex int adjtimex(struct timex *buf); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè°ƒæ•´ç³»ç»Ÿæ—¶é’Ÿã€‚timex ç»“æ„ä½“åŒ…å«äº†ç”¨äºè°ƒæ•´æ—¶é’Ÿé¢‘ç‡å’Œç›¸ä½çš„å‚æ•°ã€‚è¿™é€šå¸¸ç”¨äºå®ç° NTPï¼ˆç½‘ç»œæ—¶é—´åè®®ï¼‰å®ˆæŠ¤è¿›ç¨‹ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 160 setrlimit int setrlimit(int resource, const struct rlimit *rlim); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®è°ƒç”¨è¿›ç¨‹çš„èµ„æºé™åˆ¶ã€‚resource æŒ‡å®šè¦ä¿®æ”¹çš„èµ„æºç±»å‹ï¼Œrlim ç»“æ„ä½“åŒ…å«æ–°çš„è½¯é™åˆ¶å’Œç¡¬é™åˆ¶ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 161 chroot int chroot(const char *path); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæ”¹å˜è°ƒç”¨è¿›ç¨‹çš„æ ¹ç›®å½•ã€‚è¿™æœ‰æ•ˆåœ°å°†è¿›ç¨‹åŠå…¶å­è¿›ç¨‹é™åˆ¶åœ¨ç”± path æŒ‡å®šçš„ç›®å½•å­æ ‘ä¸­ã€‚éœ€è¦è¶…çº§ç”¨æˆ·æƒé™ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 162 sync void sync(void); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†æ‰€æœ‰æ–‡ä»¶ç³»ç»Ÿç¼“å­˜æ•°æ®å†™å…¥åº•å±‚ç£ç›˜ã€‚å®ƒå¯åŠ¨åŒæ­¥æ“ä½œï¼Œä½†ä¸ä¼šç­‰å¾… IO å®Œæˆã€‚ 163 acct int acct(const char *filename); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå¯ç”¨æˆ–ç¦ç”¨è¿›ç¨‹ä¼šè®¡ã€‚å½“å¯ç”¨æ—¶ï¼Œå†…æ ¸ä¼šä¸ºæ¯ä¸ªç»ˆæ­¢çš„è¿›ç¨‹å†™å…¥ä¸€ä¸ªè®°å½•ã€‚filename æŒ‡å®šä¼šè®¡æ–‡ä»¶çš„è·¯å¾„ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 164 settimeofday int settimeofday(const struct timeval *tv, const struct timezone *tz); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®ç³»ç»Ÿæ—¶é—´å’Œæ—¶åŒºã€‚tv ç»“æ„ä½“åŒ…å«äº†æ–°çš„æ—¶é—´ï¼Œtz ç»“æ„ä½“åŒ…å«äº†æ–°çš„æ—¶åŒºä¿¡æ¯ã€‚éœ€è¦é€‚å½“çš„æƒé™ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 165 mount int mount(const char *source, const char *target, const char *filesystemtype, unsigned long mountflags, const void *data); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†ä¸€ä¸ªæ–‡ä»¶ç³»ç»ŸæŒ‚è½½åˆ°æŒ‡å®šä½ç½®ã€‚source æŒ‡å®šè®¾å¤‡æˆ–æ–‡ä»¶ï¼Œtarget æŒ‡å®šæŒ‚è½½ç‚¹ï¼Œfilesystemtype æŒ‡å®šæ–‡ä»¶ç³»ç»Ÿç±»å‹ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 166 umount2 int umount2(const char *target, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå¸è½½ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿã€‚target æŒ‡å®šæŒ‚è½½ç‚¹ã€‚flags å‚æ•°æä¾›äº†é¢å¤–çš„å¸è½½é€‰é¡¹ï¼Œå¦‚å»¶è¿Ÿå¸è½½ï¼ˆMNT_DETACHï¼‰ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 167 swapon int swapon(const char *path, int swapflags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå¯ç”¨ä¸€ä¸ªäº¤æ¢è®¾å¤‡æˆ–æ–‡ä»¶ã€‚path æŒ‡å®šäº¤æ¢è®¾å¤‡çš„è·¯å¾„ï¼Œswapflags æä¾›é€‰é¡¹ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 168 swapoff int swapoff(const char *path); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºç¦ç”¨ä¸€ä¸ªäº¤æ¢è®¾å¤‡æˆ–æ–‡ä»¶ã€‚path æŒ‡å®šäº¤æ¢è®¾å¤‡çš„è·¯å¾„ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 169 reboot int reboot(int magic, int magic2, int cmd, void *arg); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºé‡å¯ã€å…³é—­æˆ–æŒ‚èµ·ç³»ç»Ÿã€‚magic å’Œ magic2 æ˜¯ç‰¹å®šçš„é­”æœ¯æ•°å­—ï¼Œcmd æŒ‡å®šè¦æ‰§è¡Œçš„æ“ä½œï¼ˆå¦‚ LINUX_REBOOT_CMD_RESTARTï¼‰ã€‚éœ€è¦é€‚å½“çš„æƒé™ã€‚æˆåŠŸåæ°¸ä¸è¿”å›ï¼Œå¤±è´¥è¿”å› -1ã€‚ 170 sethostname int sethostname(const char *name, size_t len); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®ç³»ç»Ÿçš„ä¸»æœºåã€‚name æŒ‡å‘æ–°çš„ä¸»æœºåï¼Œlen æ˜¯å…¶é•¿åº¦ã€‚éœ€è¦é€‚å½“çš„æƒé™ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 171 setdomainname int setdomainname(const char *name, size_t len); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®ç³»ç»Ÿçš„åŸŸåã€‚name æŒ‡å‘æ–°çš„åŸŸåï¼Œlen æ˜¯å…¶é•¿åº¦ã€‚éœ€è¦é€‚å½“çš„æƒé™ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 172 iopl int iopl(int level); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæ”¹å˜è°ƒç”¨è¿›ç¨‹çš„ IO ç‰¹æƒçº§åˆ«ã€‚level æŒ‡å®šæ–°çš„ç‰¹æƒçº§åˆ«ã€‚æ­¤è°ƒç”¨ä»…åœ¨ x86 æ¶æ„ä¸Šå¯ç”¨ï¼Œä¸”éœ€è¦é€‚å½“çš„æƒé™ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 173 ioperm int ioperm(unsigned long from, unsigned long num, int turn_on); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®æˆ–ç§»é™¤å¯¹ IO ç«¯å£çš„è®¿é—®æƒé™ã€‚from å’Œ num æŒ‡å®š IO ç«¯å£çš„èŒƒå›´ï¼Œturn_on æ§åˆ¶æ˜¯å¯ç”¨è¿˜æ˜¯ç¦ç”¨æƒé™ã€‚æ­¤è°ƒç”¨ä»…åœ¨ x86 æ¶æ„ä¸Šå¯ç”¨ï¼Œä¸”éœ€è¦é€‚å½“çš„æƒé™ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 174 create_module int create_module(const char *name, size_t size); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåœ¨å†…æ ¸ä¸­åˆ›å»ºä¸€ä¸ªç©ºçš„æ¨¡å—ç©ºé—´ã€‚æ­¤è°ƒç”¨å·²è¢«å¼ƒç”¨ï¼Œæ¨èä½¿ç”¨ init_moduleã€‚ 175 init_module int init_module(const void *module_image, unsigned long len, const char *param_values); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†ä¸€ä¸ªå†…æ ¸æ¨¡å—åŠ è½½åˆ°å†…æ ¸ã€‚module_image æŒ‡å‘æ¨¡å—çš„äºŒè¿›åˆ¶æ˜ åƒï¼Œlen æ˜¯å…¶å¤§å°ï¼Œparam_values æ˜¯æ¨¡å—å‚æ•°ã€‚éœ€è¦é€‚å½“çš„æƒé™ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 176 delete_module int delete_module(const char *name, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºä»å†…æ ¸ä¸­ç§»é™¤ä¸€ä¸ªå·²åŠ è½½çš„æ¨¡å—ã€‚name æŒ‡å®šæ¨¡å—åç§°ï¼Œflags æä¾›å¸è½½é€‰é¡¹ã€‚éœ€è¦é€‚å½“çš„æƒé™ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 177 get_kernel_syms int get_kernel_syms(struct kernel_sym *table); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–å†…æ ¸ç¬¦å·è¡¨ã€‚æ­¤è°ƒç”¨å·²è¢«å¼ƒç”¨ï¼Œæ¨èä½¿ç”¨ /proc/kallsymsã€‚ 178 query_module int query_module(const char *name, int what, void *buf, size_t bufsize, size_t *ret); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæŸ¥è¯¢å†…æ ¸æ¨¡å—çš„ä¿¡æ¯ã€‚æ­¤è°ƒç”¨å·²è¢«å¼ƒç”¨ã€‚ 179 quotactl int quotactl(int cmd, const char *special, qid_t id, void *addr); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºç®¡ç†æ–‡ä»¶ç³»ç»Ÿé…é¢ã€‚cmd æŒ‡å®šæ“ä½œï¼Œspecial æ˜¯è®¾å¤‡åç§°ï¼Œid æ˜¯ç”¨æˆ·æˆ–ç»„ IDã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 180 nfsservctl long nfsservctl(int cmd, struct nfsctl_arg *argp, union nfsctl_res *resp); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæ§åˆ¶ NFS æœåŠ¡å™¨ã€‚æ­¤è°ƒç”¨å·²è¢«å¼ƒç”¨ã€‚ 181 getpmsg int getpmsg(void); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ä¸æµï¼ˆstreamï¼‰ç›¸å…³çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå·²è¿‡æ—¶ã€‚ 182 putpmsg int putpmsg(void); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ä¸æµï¼ˆstreamï¼‰ç›¸å…³çš„ç³»ç»Ÿè°ƒç”¨ï¼Œå·²è¿‡æ—¶ã€‚ 183 afs_syscall int afs_syscall(void); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ AFSï¼ˆAndrew File Systemï¼‰ä¸“ç”¨çš„ï¼Œç”¨äºæ‰§è¡Œç‰¹å®šäº AFS çš„æ“ä½œã€‚ 184 tuxcall int tuxcall(void); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ TUX ç½‘ç»œæœåŠ¡å™¨ä¸“ç”¨çš„ã€‚ 185 security int security(void); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºä¸ Linux å®‰å…¨æ¨¡å—ï¼ˆLSMï¼‰è¿›è¡Œäº¤äº’ã€‚å®ƒå·²è¿‡æ—¶ï¼Œç›¸å…³åŠŸèƒ½å·²é›†æˆåˆ°å…¶ä»–ç³»ç»Ÿè°ƒç”¨ä¸­ã€‚ 186 gettid pid_t gettid(void); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–è°ƒç”¨çº¿ç¨‹çš„çº¿ç¨‹ IDï¼ˆTIDï¼‰ã€‚çº¿ç¨‹ ID åœ¨ç³»ç»ŸèŒƒå›´å†…æ˜¯å”¯ä¸€çš„ï¼Œä½†ä¸è¿›ç¨‹ IDï¼ˆPIDï¼‰ä¸åŒã€‚è¿”å›å€¼ä¸ºçº¿ç¨‹ IDã€‚ 187 readahead ssize_t readahead(int fd, off64_t offset, size_t count); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºé¢„è¯»æ–‡ä»¶æ•°æ®åˆ°é¡µé¢ç¼“å­˜ä¸­ã€‚å®ƒä»æ–‡ä»¶æè¿°ç¬¦ fd çš„ offset å¤„å¼€å§‹ï¼Œé¢„è¯» count å­—èŠ‚æ•°æ®ã€‚è¿™å¯ä»¥å¸®åŠ©å‡å°‘åç»­ read è°ƒç”¨çš„å»¶è¿Ÿã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 188 setxattr int setxattr(const char *path, const char *name, const void *value, size_t size, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®æ–‡ä»¶æˆ–ç›®å½•çš„æ‰©å±•å±æ€§ã€‚path æŒ‡å®šæ–‡ä»¶ï¼Œname æŒ‡å®šå±æ€§åï¼Œvalue å’Œ size æŒ‡å®šå±æ€§å€¼ã€‚flags æä¾›é€‰é¡¹ï¼Œå¦‚ XATTR_CREATEï¼ˆåªåœ¨å±æ€§ä¸å­˜åœ¨æ—¶åˆ›å»ºï¼‰ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 189 lsetxattr int lsetxattr(const char *path, const char *name, const void *value, size_t size, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ä¸ setxattr ç±»ä¼¼ï¼Œä½†å¦‚æœ path æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼Œå®ƒä¼šæ”¹å˜ç¬¦å·é“¾æ¥æœ¬èº«çš„æ‰©å±•å±æ€§ï¼Œè€Œä¸æ˜¯å®ƒæ‰€æŒ‡å‘çš„æ–‡ä»¶ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 190 fsetxattr int fsetxattr(int fd, const char *name, const void *value, size_t size, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ä¸ setxattr ç±»ä¼¼ï¼Œä½†å®ƒé€šè¿‡æ–‡ä»¶æè¿°ç¬¦ fd æ¥è®¾ç½®å·²æ‰“å¼€æ–‡ä»¶çš„æ‰©å±•å±æ€§ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 191 getxattr ssize_t getxattr(const char *path, const char *name, void *value, size_t size); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–æ–‡ä»¶æˆ–ç›®å½•çš„æ‰©å±•å±æ€§å€¼ã€‚path æŒ‡å®šæ–‡ä»¶ï¼Œname æŒ‡å®šå±æ€§åã€‚å±æ€§å€¼è¢«å¤åˆ¶åˆ° value ç¼“å†²åŒºä¸­ï¼Œæœ€å¤š size å­—èŠ‚ã€‚è¿”å›å€¼ä¸ºå±æ€§å€¼çš„å¤§å°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 192 lgetxattr ssize_t lgetxattr(const char *path, const char *name, void *value, size_t size); æ­¤ç³»ç»Ÿè°ƒç”¨ä¸ getxattr ç±»ä¼¼ï¼Œä½†å¦‚æœ path æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼Œå®ƒä¼šè·å–ç¬¦å·é“¾æ¥æœ¬èº«çš„æ‰©å±•å±æ€§ã€‚è¿”å›å€¼ä¸ºå±æ€§å€¼çš„å¤§å°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 193 fgetxattr ssize_t fgetxattr(int fd, const char *name, void *value, size_t size); æ­¤ç³»ç»Ÿè°ƒç”¨ä¸ getxattr ç±»ä¼¼ï¼Œä½†å®ƒé€šè¿‡æ–‡ä»¶æè¿°ç¬¦ fd æ¥è·å–å·²æ‰“å¼€æ–‡ä»¶çš„æ‰©å±•å±æ€§å€¼ã€‚è¿”å›å€¼ä¸ºå±æ€§å€¼çš„å¤§å°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 194 listxattr ssize_t listxattr(const char *path, char *list, size_t size); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–æ–‡ä»¶æˆ–ç›®å½•æ‰€æœ‰æ‰©å±•å±æ€§çš„åç§°åˆ—è¡¨ã€‚å±æ€§åè¢«å¤åˆ¶åˆ° list ç¼“å†²åŒºä¸­ï¼Œä»¥ç©ºå­—ç¬¦åˆ†éš”ã€‚è¿”å›å€¼ä¸ºåˆ—è¡¨çš„æ€»å¤§å°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 195 llistxattr ssize_t llistxattr(const char *path, char *list, size_t size); æ­¤ç³»ç»Ÿè°ƒç”¨ä¸ listxattr ç±»ä¼¼ï¼Œä½†å¦‚æœ path æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼Œå®ƒä¼šè·å–ç¬¦å·é“¾æ¥æœ¬èº«çš„æ‰©å±•å±æ€§åç§°åˆ—è¡¨ã€‚è¿”å›å€¼ä¸ºåˆ—è¡¨çš„æ€»å¤§å°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 196 flistxattr ssize_t flistxattr(int fd, char *list, size_t size); æ­¤ç³»ç»Ÿè°ƒç”¨ä¸ listxattr ç±»ä¼¼ï¼Œä½†å®ƒé€šè¿‡æ–‡ä»¶æè¿°ç¬¦ fd æ¥è·å–å·²æ‰“å¼€æ–‡ä»¶çš„æ‰©å±•å±æ€§åç§°åˆ—è¡¨ã€‚è¿”å›å€¼ä¸ºåˆ—è¡¨çš„æ€»å¤§å°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 197 removexattr int removexattr(const char *path, const char *name); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºç§»é™¤æ–‡ä»¶æˆ–ç›®å½•çš„æ‰©å±•å±æ€§ã€‚path æŒ‡å®šæ–‡ä»¶ï¼Œname æŒ‡å®šè¦ç§»é™¤çš„å±æ€§åã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 198 lremovexattr int lremovexattr(const char *path, const char *name); æ­¤ç³»ç»Ÿè°ƒç”¨ä¸ removexattr ç±»ä¼¼ï¼Œä½†å¦‚æœ path æ˜¯ä¸€ä¸ªç¬¦å·é“¾æ¥ï¼Œå®ƒä¼šç§»é™¤ç¬¦å·é“¾æ¥æœ¬èº«çš„æ‰©å±•å±æ€§ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 199 fremovexattr int fremovexattr(int fd, const char *name); æ­¤ç³»ç»Ÿè°ƒç”¨ä¸ removexattr ç±»ä¼¼ï¼Œä½†å®ƒé€šè¿‡æ–‡ä»¶æè¿°ç¬¦ fd æ¥ç§»é™¤å·²æ‰“å¼€æ–‡ä»¶çš„æ‰©å±•å±æ€§ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 200 tkill int tkill(int tid, int sig); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå‘æŒ‡å®šçš„çº¿ç¨‹ tid å‘é€ä¿¡å·ã€‚å®ƒæ¯” kill æ›´ç²¾ç¡®ï¼Œå› ä¸ºå®ƒç›´æ¥é’ˆå¯¹å•ä¸ªçº¿ç¨‹ã€‚æ­¤è°ƒç”¨å·²è¢«å¼ƒç”¨ï¼Œæ¨èä½¿ç”¨ tgkillã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 201 time time_t time(time_t *tloc); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–è‡ª Epochï¼ˆ1970-01-01 00:00:00 +0000 (UTC)ï¼‰ä»¥æ¥çš„ç§’æ•°ã€‚å¦‚æœ tloc éç©ºï¼Œåˆ™è¯¥å€¼ä¹Ÿä¼šå­˜å‚¨åœ¨ tloc ä¸­ã€‚è¿”å›å€¼ä¸ºç§’æ•°ï¼Œå¤±è´¥è¿”å› (time_t)-1ã€‚ 202 futex int futex(int *uaddr, int futex_op, int val, const struct timespec *timeout, int *uaddr2, int val3); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå®ç°ç”¨æˆ·ç©ºé—´çš„å¿«é€Ÿäº’æ–¥é”ï¼ˆfast user-space mutexesï¼‰ã€‚å®ƒåœ¨ç”¨æˆ·ç©ºé—´æä¾›åŸå­æ“ä½œï¼Œå¹¶ä¸”åªåœ¨å¿…è¦æ—¶æ‰è°ƒç”¨å†…æ ¸ã€‚futex_op æŒ‡å®šæ“ä½œç±»å‹ï¼Œå¦‚ç­‰å¾…ï¼ˆFUTEX_WAITï¼‰æˆ–å”¤é†’ï¼ˆFUTEX_WAKEï¼‰ã€‚æˆåŠŸè¿”å›å–å†³äºæ“ä½œç±»å‹ï¼Œå¤±è´¥è¿”å› -1ã€‚ 203 sched_setaffinity int sched_setaffinity(pid_t pid, size_t cpusize, cpu_set_t *mask); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®æŒ‡å®šè¿›ç¨‹çš„ CPU äº²å’ŒåŠ›æ©ç ã€‚mask æŒ‡å®šè¿›ç¨‹å¯ä»¥åœ¨å“ªäº› CPU ä¸Šè¿è¡Œã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 204 sched_getaffinity int sched_getaffinity(pid_t pid, size_t cpusize, cpu_set_t *mask); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–æŒ‡å®šè¿›ç¨‹çš„ CPU äº²å’ŒåŠ›æ©ç ã€‚mask ç»“æ„ä½“ç”¨äºå­˜å‚¨è¯¥æ©ç ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 205 set_thread_area int set_thread_area(struct user_desc *u_info); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®çº¿ç¨‹çš„æœ¬åœ°å­˜å‚¨ï¼ˆTLSï¼‰åŒºåŸŸã€‚å®ƒç”¨äºå®ç°çº¿ç¨‹å±€éƒ¨å˜é‡ã€‚æ­¤è°ƒç”¨ä»…åœ¨ x86 æ¶æ„ä¸Šå¯ç”¨ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 206 io_setup int io_setup(unsigned nr_events, aio_context_t *ctxp); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®å¼‚æ­¥ IO ä¸Šä¸‹æ–‡ã€‚nr_events æŒ‡å®šé˜Ÿåˆ—ä¸­çš„æœ€å¤§äº‹ä»¶æ•°ï¼Œctxp ç”¨äºå­˜å‚¨ä¸Šä¸‹æ–‡å¥æŸ„ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 207 io_destroy int io_destroy(aio_context_t ctx); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºé”€æ¯æŒ‡å®šçš„å¼‚æ­¥ IO ä¸Šä¸‹æ–‡ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 208 io_getevents int io_getevents(aio_context_t ctx_id, long min_nr, long nr, struct io_event *events, struct timespec *timeout); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºä»å¼‚æ­¥ IO ä¸Šä¸‹æ–‡ä¸­æ£€ç´¢å·²å®Œæˆçš„äº‹ä»¶ã€‚events ç»“æ„ä½“ç”¨äºå­˜å‚¨äº‹ä»¶ä¿¡æ¯ã€‚è¿”å›å€¼ä¸ºè·å–çš„äº‹ä»¶æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 209 io_submit int io_submit(aio_context_t ctx_id, long nr, struct iocb **iocbpp); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå‘å¼‚æ­¥ IO ä¸Šä¸‹æ–‡æäº¤ IO è¯·æ±‚ã€‚iocbpp æ˜¯æŒ‡å‘ iocb ç»“æ„ä½“æŒ‡é’ˆæ•°ç»„çš„æŒ‡é’ˆï¼Œæ¯ä¸ªç»“æ„ä½“æè¿°ä¸€ä¸ª IO æ“ä½œã€‚è¿”å›å€¼ä¸ºæäº¤çš„è¯·æ±‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 210 io_cancel int io_cancel(aio_context_t ctx_id, struct iocb *iocb, struct io_event *result); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå–æ¶ˆä¸€ä¸ªå·²æäº¤çš„å¼‚æ­¥ IO è¯·æ±‚ã€‚iocb ç»“æ„ä½“æŒ‡å®šè¦å–æ¶ˆçš„è¯·æ±‚ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 211 get_thread_area int get_thread_area(struct user_desc *u_info); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–çº¿ç¨‹çš„æœ¬åœ°å­˜å‚¨ï¼ˆTLSï¼‰åŒºåŸŸã€‚å®ƒç”¨äºè·å–ç”± set_thread_area è®¾ç½®çš„ä¿¡æ¯ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 212 lookup_dcookie int lookup_dcookie(u64 cookie, char *buffer, size_t len); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†ä¸€ä¸ªç›®å½• â€œcookieâ€ è½¬æ¢ä¸ºå…¶è·¯å¾„åã€‚cookie æ˜¯ä¸€ä¸ªå†…æ ¸å†…éƒ¨æ ‡è¯†ç¬¦ã€‚æˆåŠŸè¿”å›è·¯å¾„åçš„é•¿åº¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 213 epoll_create int epoll_create(int size); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€ä¸ª epoll å®ä¾‹ã€‚size å‚æ•°ç°åœ¨å·²è¢«å¿½ç•¥ï¼Œä½†å¿…é¡»å¤§äº 0ã€‚è¿”å›ä¸€ä¸ª epoll å®ä¾‹çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 214 epoll_ctl_old int epoll_ctl_old(void); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ epoll_ctl çš„æ—§ç‰ˆæœ¬ï¼Œå·²è¿‡æ—¶ã€‚ 215 epoll_wait_old int epoll_wait_old(void); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ epoll_wait çš„æ—§ç‰ˆæœ¬ï¼Œå·²è¿‡æ—¶ã€‚ 216 remap_file_pages int remap_file_pages(unsigned long start, unsigned long size, unsigned long prot, unsigned long pgoff, unsigned long flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†æ–‡ä»¶æ˜ å°„åŒºåŸŸçš„é¡µé¢é‡æ–°æ˜ å°„åˆ°æ–°çš„è™šæ‹Ÿåœ°å€ã€‚æ­¤è°ƒç”¨å·²è¢«å¼ƒç”¨ã€‚ 217 getdents64 int getdents64(int fd, struct linux_dirent64 *dirp, unsigned int count); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ getdents çš„ 64 ä½ç‰ˆæœ¬ï¼Œç”¨äºè¯»å–ç›®å½•é¡¹ã€‚å®ƒç”¨äºå¤„ç†å…·æœ‰ 64 ä½ inode å·çš„æ–‡ä»¶ç³»ç»Ÿã€‚è¿”å›å€¼ä¸ºå®é™…è¯»å–çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 218 set_tid_address long set_tid_address(int *tidptr); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®ä¸€ä¸ªåœ°å€ï¼Œå½“çº¿ç¨‹ç»ˆæ­¢æ—¶ï¼Œå†…æ ¸ä¼šå°†çº¿ç¨‹çš„ TID å†™å…¥è¯¥åœ°å€ï¼Œå¹¶å¯èƒ½å‘é€ä¸€ä¸ªä¿¡å·ã€‚è¿™å¯¹äºå®ç°çº¿ç¨‹åº“éå¸¸æœ‰ç”¨ã€‚è¿”å›å€¼ä¸ºçº¿ç¨‹ IDã€‚ 219 restart_syscall long restart_syscall(void); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåœ¨ä»ä¿¡å·å¤„ç†å‡½æ•°è¿”å›åé‡æ–°å¯åŠ¨ä¸€ä¸ªè¢«ä¸­æ–­çš„ç³»ç»Ÿè°ƒç”¨ã€‚å®ƒé€šå¸¸ç”±å†…æ ¸åœ¨åå°è‡ªåŠ¨è°ƒç”¨ã€‚ 220 semtimedop int semtimedop(int semid, struct sembuf *sops, size_t nsops, const struct timespec *timeout); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ semop çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒå…è®¸æŒ‡å®šä¸€ä¸ªè¶…æ—¶æ—¶é—´ã€‚å¦‚æœä¿¡å·é‡æ“ä½œæ— æ³•åœ¨è¶…æ—¶æ—¶é—´å†…å®Œæˆï¼Œåˆ™è°ƒç”¨ä¼šè¿”å›ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 221 fadvise64 int fadvise64(int fd, off64_t offset, off64_t len, int advice); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå¯¹æ–‡ä»¶æ•°æ®è¿›è¡Œé¢„è¯»å’Œç¼“å­˜ç­–ç•¥çš„å»ºè®®ã€‚å®ƒå‘Šè¯‰å†…æ ¸åº”ç”¨ç¨‹åºå°†å¦‚ä½•è®¿é—®æ–‡ä»¶ï¼Œä»¥ä¾¿å†…æ ¸å¯ä»¥ä¼˜åŒ–å…¶ IO è¡Œä¸ºã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 222 timer_create int timer_create(clockid_t clockid, struct sigevent *sevp, timer_t *timerid); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„ POSIX è®¡æ—¶å™¨ã€‚clockid æŒ‡å®šæ—¶é’Ÿç±»å‹ï¼Œsevp æŒ‡å®šè®¡æ—¶å™¨åˆ°æœŸæ—¶è¦å‘é€çš„é€šçŸ¥äº‹ä»¶ï¼Œtimerid ç”¨äºå­˜å‚¨æ–°çš„è®¡æ—¶å™¨ IDã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 223 timer_settime int timer_settime(timer_t timerid, int flags, const struct itimerspec *new_value, struct itimerspec *old_value); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®æˆ–ä¿®æ”¹æŒ‡å®šçš„ POSIX è®¡æ—¶å™¨ã€‚timerid æŒ‡å®šè®¡æ—¶å™¨ï¼Œnew_value è®¾ç½®æ–°çš„åˆ°æœŸæ—¶é—´å’Œé—´éš”ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 224 timer_gettime int timer_gettime(timer_t timerid, struct itimerspec *curr_value); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–æŒ‡å®šçš„ POSIX è®¡æ—¶å™¨çš„å½“å‰å€¼ã€‚curr_value ç»“æ„ä½“ç”¨äºå­˜å‚¨å‰©ä½™æ—¶é—´å’Œé—´éš”ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 225 timer_getoverrun int timer_getoverrun(timer_t timerid); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–æŒ‡å®šçš„ POSIX è®¡æ—¶å™¨çš„åˆ°æœŸæº¢å‡ºè®¡æ•°ã€‚å®ƒè¿”å›è®¡æ—¶å™¨åˆ°æœŸæ—¶ï¼Œç”±äºè¿›ç¨‹æœªåŠæ—¶å¤„ç†è€Œé”™è¿‡çš„ä¿¡å·æ•°ã€‚è¿”å›å€¼ä¸ºæº¢å‡ºè®¡æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 226 timer_delete int timer_delete(timer_t timerid); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ é™¤æŒ‡å®šçš„ POSIX è®¡æ—¶å™¨ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 227 clock_settime int clock_settime(clockid_t clockid, const struct timespec *tp); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®æŒ‡å®šæ—¶é’Ÿçš„æ—¶é—´ã€‚clockid æŒ‡å®šæ—¶é’Ÿç±»å‹ï¼Œtp ç»“æ„ä½“åŒ…å«äº†æ–°çš„æ—¶é—´ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 228 clock_gettime int clock_gettime(clockid_t clockid, struct timespec *tp); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–æŒ‡å®šæ—¶é’Ÿçš„å½“å‰æ—¶é—´ã€‚tp ç»“æ„ä½“ç”¨äºå­˜å‚¨æ—¶é—´ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 229 clock_getres int clock_getres(clockid_t clockid, struct timespec *res); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–æŒ‡å®šæ—¶é’Ÿçš„åˆ†è¾¨ç‡ï¼ˆå³æœ€å°å¯æµ‹é‡çš„æ—¶é—´é—´éš”ï¼‰ã€‚res ç»“æ„ä½“ç”¨äºå­˜å‚¨åˆ†è¾¨ç‡ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 230 clock_nanosleep int clock_nanosleep(clockid_t clockid, int flags, const struct timespec *request, struct timespec *remain); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåœ¨é«˜ç²¾åº¦æ—¶é’Ÿä¸Šæš‚åœæ‰§è¡Œã€‚å®ƒæ¯” nanosleep æ›´çµæ´»ï¼Œå…è®¸æŒ‡å®šæ—¶é’Ÿç±»å‹å’Œç›¸å¯¹ç»å¯¹æ—¶é—´ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 231 exit_group void exit_group(int status); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºç»ˆæ­¢è°ƒç”¨è¿›ç¨‹æ‰€å±çš„æ•´ä¸ªçº¿ç¨‹ç»„ã€‚status å‚æ•°æ˜¯ä¸€ä¸ªæ•´æ•°ï¼Œä½œä¸ºè¿›ç¨‹çš„é€€å‡ºçŠ¶æ€ç ã€‚ä¸ exit ä¸åŒï¼Œå®ƒä¼šç»ˆæ­¢æ‰€æœ‰çº¿ç¨‹ï¼Œè€Œä¸ä»…ä»…æ˜¯è°ƒç”¨çº¿ç¨‹ã€‚æ­¤è°ƒç”¨æ°¸ä¸è¿”å›ã€‚ 232 epoll_wait int epoll_wait(int epfd, struct epoll_event *events, int maxevents, int timeout); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºç­‰å¾… epoll å®ä¾‹ä¸Šçš„äº‹ä»¶ã€‚å®ƒé˜»å¡ç›´åˆ° epfd ä¸Šçš„äº‹ä»¶å‘ç”Ÿæˆ–è¶…æ—¶ã€‚å°±ç»ªçš„äº‹ä»¶è¢«å­˜å‚¨åœ¨ events æ•°ç»„ä¸­ã€‚è¿”å›å€¼ä¸ºå°±ç»ªäº‹ä»¶çš„æ•°é‡ï¼Œå¤±è´¥è¿”å› -1ã€‚ 233 epoll_ctl int epoll_ctl(int epfd, int op, int fd, struct epoll_event *event); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæ§åˆ¶ epoll å®ä¾‹ã€‚op æŒ‡å®šæ“ä½œç±»å‹ï¼Œå¦‚æ·»åŠ ï¼ˆEPOLL_CTL_ADDï¼‰ã€ä¿®æ”¹ï¼ˆEPOLL_CTL_MODï¼‰æˆ–åˆ é™¤ï¼ˆEPOLL_CTL_DELï¼‰æ–‡ä»¶æè¿°ç¬¦ fdã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 234 tgkill int tgkill(int tgid, int tid, int sig); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå‘æŒ‡å®šçš„çº¿ç¨‹ tid å‘é€ä¿¡å·ã€‚å®ƒé€šè¿‡æŒ‡å®šçº¿ç¨‹ç»„ IDï¼ˆtgidï¼‰æ¥ç¡®ä¿ç›®æ ‡çº¿ç¨‹å±äºæ­£ç¡®çš„è¿›ç¨‹ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 235 utimes int utimes(const char *filename, const struct timeval times[2]); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæ”¹å˜æŒ‡å®šæ–‡ä»¶ filename çš„è®¿é—®å’Œä¿®æ”¹æ—¶é—´ã€‚å®ƒæ¯” utime æä¾›äº†æ›´é«˜çš„ç²¾åº¦ï¼Œæ”¯æŒå¾®ç§’ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 236 vserver int vserver(void); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè™šæ‹ŸåŒ–æœåŠ¡å™¨ã€‚è¯¥è°ƒç”¨å·²è¢«å¼ƒç”¨ï¼Œå› ä¸ºè™šæ‹ŸåŒ–æŠ€æœ¯å·²ç»é€šè¿‡å…¶ä»–æ–¹å¼å®ç°ã€‚ 237 mbind long mbind(unsigned long start, unsigned long len, unsigned long mode, unsigned long *nmask, unsigned long maxnode, unsigned flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†ä¸€ä¸ªè¿›ç¨‹çš„å†…å­˜åŒºåŸŸç»‘å®šåˆ°ä¸€ç»„æŒ‡å®šçš„ NUMAï¼ˆéå‡åŒ€å†…å­˜è®¿é—®ï¼‰èŠ‚ç‚¹ã€‚è¿™æœ‰åŠ©äºåœ¨ NUMA æ¶æ„ä¸Šä¼˜åŒ–å†…å­˜è®¿é—®ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 238 set_mempolicy long set_mempolicy(int mode, const unsigned long *nmask, unsigned long maxnode); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®è°ƒç”¨è¿›ç¨‹çš„é»˜è®¤å†…å­˜åˆ†é…ç­–ç•¥ã€‚mode æŒ‡å®šç­–ç•¥ï¼Œnmask æŒ‡å®šè¦ä½¿ç”¨çš„ NUMA èŠ‚ç‚¹ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 239 get_mempolicy long get_mempolicy(int *mode, unsigned long *nmask, unsigned long maxnode, unsigned long addr, unsigned long flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–è°ƒç”¨è¿›ç¨‹çš„å†…å­˜åˆ†é…ç­–ç•¥æˆ–æŒ‡å®šåœ°å€çš„ç­–ç•¥ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 240 mq_open mqd_t mq_open(const char *name, int oflag, ...); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæ‰“å¼€æˆ–åˆ›å»ºä¸€ä¸ª POSIX æ¶ˆæ¯é˜Ÿåˆ—ã€‚name æŒ‡å®šé˜Ÿåˆ—åç§°ï¼Œoflag æŒ‡å®šæ‰“å¼€æ ‡å¿—ã€‚æˆåŠŸè¿”å›æ¶ˆæ¯é˜Ÿåˆ—æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 241 mq_unlink int mq_unlink(const char *name); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ é™¤æŒ‡å®šçš„ POSIX æ¶ˆæ¯é˜Ÿåˆ—ã€‚name æŒ‡å®šè¦åˆ é™¤çš„é˜Ÿåˆ—åç§°ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 242 mq_timedsend int mq_timedsend(mqd_t mqdes, const char *msg_ptr, size_t msg_len, unsigned int msg_prio, const struct timespec *abs_timeout); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå‘æ¶ˆæ¯é˜Ÿåˆ—å‘é€æ¶ˆæ¯ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªç»å¯¹è¶…æ—¶æ—¶é—´ã€‚å¦‚æœæ— æ³•åœ¨è¶…æ—¶æ—¶é—´å†…å‘é€æ¶ˆæ¯ï¼Œåˆ™è°ƒç”¨å¤±è´¥ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 243 mq_timedreceive ssize_t mq_timedreceive(mqd_t mqdes, char *msg_ptr, size_t msg_len, unsigned int *msg_prio, const struct timespec *abs_timeout); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºä»æ¶ˆæ¯é˜Ÿåˆ—æ¥æ”¶æ¶ˆæ¯ï¼Œå¹¶æŒ‡å®šä¸€ä¸ªç»å¯¹è¶…æ—¶æ—¶é—´ã€‚å¦‚æœæ— æ³•åœ¨è¶…æ—¶æ—¶é—´å†…æ¥æ”¶æ¶ˆæ¯ï¼Œåˆ™è°ƒç”¨å¤±è´¥ã€‚æˆåŠŸè¿”å›æ¥æ”¶çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 244 mq_notify int mq_notify(mqd_t mqdes, const struct sigevent *sevp); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæ³¨å†Œæˆ–å–æ¶ˆæ¶ˆæ¯é˜Ÿåˆ—çš„é€šçŸ¥ã€‚sevp ç»“æ„ä½“æŒ‡å®šå½“æ¶ˆæ¯åˆ°è¾¾ä¸€ä¸ªç©ºé˜Ÿåˆ—æ—¶ï¼Œè¦å‘é€çš„é€šçŸ¥ç±»å‹ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 245 mq_getsetattr int mq_getsetattr(mqd_t mqdes, const struct mq_attr *newattr, struct mq_attr *oldattr); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–æˆ–è®¾ç½®æ¶ˆæ¯é˜Ÿåˆ—çš„å±æ€§ã€‚newattr æŒ‡å®šæ–°çš„å±æ€§ï¼Œoldattr ç”¨äºè·å–æ—§çš„å±æ€§ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 246 kexec_load long kexec_load(unsigned long entry, unsigned long nr_segments, struct kexec_segment *segments, unsigned long flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåŠ è½½ä¸€ä¸ªæ–°çš„å†…æ ¸é•œåƒï¼Œä»¥ä¾¿åœ¨ä¸é‡å¯ç‰©ç†æœºå™¨çš„æƒ…å†µä¸‹å¯åŠ¨å®ƒã€‚entry æŒ‡å®šæ–°å†…æ ¸çš„å…¥å£ç‚¹ï¼Œsegments æè¿°å†…æ ¸å’Œåˆå§‹ RAM ç›˜çš„å†…å­˜å¸ƒå±€ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 247 waitid int waitid(idtype_t idtype, id_t id, siginfo_t *infop, int options); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºç­‰å¾…ä¸€ä¸ªå­è¿›ç¨‹çŠ¶æ€çš„æ”¹å˜ã€‚å®ƒæ¯” waitpid æ›´çµæ´»ï¼Œå…è®¸æŒ‡å®šè¦ç­‰å¾…çš„è¿›ç¨‹ç±»å‹å’Œ IDï¼Œå¹¶æä¾›æ›´è¯¦ç»†çš„ä¿¡å·ä¿¡æ¯ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 248 add_key key_serial_t add_key(const char *type, const char *description, const void *payload, size_t plen, key_serial_t keyring); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå‘å†…æ ¸å¯†é’¥ç¯æ·»åŠ ä¸€ä¸ªæ–°çš„å¯†é’¥ã€‚type æŒ‡å®šå¯†é’¥ç±»å‹ï¼Œdescription æä¾›äº†æè¿°ï¼Œpayload æ˜¯å¯†é’¥æ•°æ®ã€‚æˆåŠŸè¿”å›æ–°å¯†é’¥çš„åºåˆ—å·ï¼Œå¤±è´¥è¿”å› -1ã€‚ 249 request_key key_serial_t request_key(const char *type, const char *description, const char *callout_info, key_serial_t keyring); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºä»å†…æ ¸å¯†é’¥ç¯ä¸­æŸ¥æ‰¾ä¸€ä¸ªå¯†é’¥ã€‚å¦‚æœå¯†é’¥ä¸å­˜åœ¨ï¼Œå®ƒä¼šå°è¯•è°ƒç”¨ keyctl å®ç”¨ç¨‹åºæ¥è·å–ã€‚æˆåŠŸè¿”å›æ‰¾åˆ°çš„å¯†é’¥çš„åºåˆ—å·ï¼Œå¤±è´¥è¿”å› -1ã€‚ 250 keyctl long keyctl(int operation, ...); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå¯¹å†…æ ¸å¯†é’¥ç¯æ‰§è¡Œå„ç§æ“ä½œã€‚operation æŒ‡å®šæ“ä½œç±»å‹ï¼Œä¾‹å¦‚è·å–å¯†é’¥å±æ€§ï¼ˆKEYCTL_GET_KEYRING_IDï¼‰æˆ–é“¾æ¥å¯†é’¥ï¼ˆKEYCTL_LINKï¼‰ã€‚æˆåŠŸè¿”å›å–å†³äºæ“ä½œç±»å‹ï¼Œå¤±è´¥è¿”å› -1ã€‚ 251 ioprio_set int ioprio_set(int which, int who, int ioprio); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®è¿›ç¨‹ã€è¿›ç¨‹ç»„æˆ–ç”¨æˆ·çš„ IO è°ƒåº¦ä¼˜å…ˆçº§ã€‚ioprio æŒ‡å®šæ–°çš„ä¼˜å…ˆçº§å€¼ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 252 ioprio_get int ioprio_get(int which, int who); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–è¿›ç¨‹ã€è¿›ç¨‹ç»„æˆ–ç”¨æˆ·çš„ IO è°ƒåº¦ä¼˜å…ˆçº§ã€‚è¿”å›å€¼ä¸ºä¼˜å…ˆçº§å€¼ï¼Œå¤±è´¥è¿”å› -1ã€‚ 253 inotify_init int inotify_init(void); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆå§‹åŒ–ä¸€ä¸ª inotify å®ä¾‹ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚inotify å®ä¾‹ç”¨äºç›‘è§†æ–‡ä»¶ç³»ç»Ÿçš„äº‹ä»¶ã€‚è¿”å›å€¼ä¸ºæ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 254 inotify_add_watch int inotify_add_watch(int fd, const char *pathname, uint32_t mask); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå‘ inotify å®ä¾‹æ·»åŠ ä¸€ä¸ªç›‘è§†ã€‚fd æ˜¯ inotify å®ä¾‹çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œpathname æŒ‡å®šè¦ç›‘è§†çš„æ–‡ä»¶ï¼Œmask æŒ‡å®šè¦ç›‘è§†çš„äº‹ä»¶ç±»å‹ã€‚æˆåŠŸè¿”å›ç›‘è§†æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 255 inotify_rm_watch int inotify_rm_watch(int fd, int wd); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºä» inotify å®ä¾‹ä¸­ç§»é™¤ä¸€ä¸ªç›‘è§†ã€‚fd æ˜¯ inotify å®ä¾‹çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œwd æ˜¯è¦ç§»é™¤çš„ç›‘è§†æè¿°ç¬¦ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 256 migrate_pages long migrate_pages(int pid, unsigned long maxnode, const unsigned long *old_nodes, const unsigned long *new_nodes); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†æŒ‡å®šè¿›ç¨‹çš„å†…å­˜é¡µé¢ä»ä¸€ç»„ NUMA èŠ‚ç‚¹è¿ç§»åˆ°å¦ä¸€ç»„ã€‚old_nodes å’Œ new_nodes åˆ†åˆ«æŒ‡å®šæºå’Œç›®æ ‡èŠ‚ç‚¹ã€‚æˆåŠŸè¿”å›è¿ç§»çš„é¡µé¢æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 257 openat int openat(int dirfd, const char *pathname, int flags, ...); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ open çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒæ¥å—ä¸€ä¸ªç›®å½•æ–‡ä»¶æè¿°ç¬¦ dirfd ä½œä¸ºç›¸å¯¹è·¯å¾„çš„èµ·ç‚¹ã€‚è¿™å¯ä»¥é˜²æ­¢åœ¨æ–‡ä»¶è·¯å¾„ä¸­å­˜åœ¨ç¬¦å·é“¾æ¥æ”»å‡»ã€‚æˆåŠŸè¿”å›æ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 258 mkdirat int mkdirat(int dirfd, const char *pathname, mode_t mode); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ mkdir çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒæ¥å—ä¸€ä¸ªç›®å½•æ–‡ä»¶æè¿°ç¬¦ dirfd ä½œä¸ºç›¸å¯¹è·¯å¾„çš„èµ·ç‚¹ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 259 mknodat int mknodat(int dirfd, const char *pathname, mode_t mode, dev_t dev); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ mknod çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒæ¥å—ä¸€ä¸ªç›®å½•æ–‡ä»¶æè¿°ç¬¦ dirfd ä½œä¸ºç›¸å¯¹è·¯å¾„çš„èµ·ç‚¹ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 260 fchownat int fchownat(int dirfd, const char *pathname, uid_t owner, gid_t group, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ chown çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒæ¥å—ä¸€ä¸ªç›®å½•æ–‡ä»¶æè¿°ç¬¦ dirfd ä½œä¸ºç›¸å¯¹è·¯å¾„çš„èµ·ç‚¹ï¼Œå¹¶æ”¯æŒé¢å¤–çš„æ ‡å¿—ï¼Œå¦‚ AT_EMPTY_PATHã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 261 futimesat int futimesat(int dirfd, const char *pathname, const struct timeval times[2]); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ utimes çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒæ¥å—ä¸€ä¸ªç›®å½•æ–‡ä»¶æè¿°ç¬¦ dirfd ä½œä¸ºç›¸å¯¹è·¯å¾„çš„èµ·ç‚¹ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 262 newfstatat int newfstatat(int dirfd, const char *pathname, struct stat *statbuf, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ fstatat çš„ä¸€ä¸ªç‰ˆæœ¬ã€‚å®ƒè·å–æŒ‡å®šæ–‡ä»¶çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¹¶æ”¯æŒé¢å¤–çš„æ ‡å¿—ï¼Œå¦‚ AT_SYMLINK_NOFOLLOWã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 263 unlinkat int unlinkat(int dirfd, const char *pathname, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ unlink çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒæ¥å—ä¸€ä¸ªç›®å½•æ–‡ä»¶æè¿°ç¬¦ dirfd ä½œä¸ºç›¸å¯¹è·¯å¾„çš„èµ·ç‚¹ã€‚flags å‚æ•°å¯ç”¨äºæŒ‡å®šæ˜¯åˆ é™¤æ–‡ä»¶è¿˜æ˜¯ç›®å½•ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 264 renameat int renameat(int olddirfd, const char *oldpath, int newdirfd, const char *newpath); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ rename çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒå…è®¸åœ¨ä¸¤ä¸ªä¸åŒçš„ç›®å½•ä¸­è¿›è¡Œé‡å‘½åæ“ä½œã€‚olddirfd å’Œ newdirfd åˆ†åˆ«æŒ‡å®šæºå’Œç›®æ ‡ç›®å½•ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 265 linkat int linkat(int olddirfd, const char *oldpath, int newdirfd, const char *newpath, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ link çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒå…è®¸åœ¨ä¸¤ä¸ªä¸åŒçš„ç›®å½•ä¸­åˆ›å»ºç¡¬é“¾æ¥ã€‚flags å‚æ•°å¯ç”¨äºæ§åˆ¶ç¬¦å·é“¾æ¥çš„è¡Œä¸ºã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 266 symlinkat int symlinkat(const char *target, int newdirfd, const char *linkpath); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ symlink çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒå…è®¸åœ¨æŒ‡å®šçš„ç›®å½•ä¸­åˆ›å»ºç¬¦å·é“¾æ¥ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 267 readlinkat ssize_t readlinkat(int dirfd, const char *pathname, char *buf, size_t bufsiz); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ readlink çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒæ¥å—ä¸€ä¸ªç›®å½•æ–‡ä»¶æè¿°ç¬¦ dirfd ä½œä¸ºç›¸å¯¹è·¯å¾„çš„èµ·ç‚¹ã€‚è¿”å›å€¼ä¸ºè¯»å–çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 268 fchmodat int fchmodat(int dirfd, const char *pathname, mode_t mode, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ chmod çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒæ¥å—ä¸€ä¸ªç›®å½•æ–‡ä»¶æè¿°ç¬¦ dirfd ä½œä¸ºç›¸å¯¹è·¯å¾„çš„èµ·ç‚¹ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 269 faccessat int faccessat(int dirfd, const char *pathname, int mode, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ access çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒæ¥å—ä¸€ä¸ªç›®å½•æ–‡ä»¶æè¿°ç¬¦ dirfd ä½œä¸ºç›¸å¯¹è·¯å¾„çš„èµ·ç‚¹ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 270 pselect6 int pselect6(int nfds, fd_set *readfds, fd_set *writefds, fd_set *exceptfds, const struct timespec *timeout, const sigset_t *sigmask); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ select çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒå…è®¸åŸå­æ€§åœ°æ”¹å˜ä¿¡å·æ©ç å’Œç­‰å¾…æ–‡ä»¶æè¿°ç¬¦äº‹ä»¶ã€‚timeout å‚æ•°ä»¥çº³ç§’ä¸ºå•ä½ã€‚è¿”å›å€¼ä¸ºå°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦æ€»æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 271 ppoll int ppoll(struct pollfd *fds, nfds_t nfds, const struct timespec *tmo_p, const sigset_t *sigmask); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ poll çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒå…è®¸åŸå­æ€§åœ°æ”¹å˜ä¿¡å·æ©ç å’Œç­‰å¾…æ–‡ä»¶æè¿°ç¬¦äº‹ä»¶ã€‚tmo_p å‚æ•°ä»¥çº³ç§’ä¸ºå•ä½ã€‚è¿”å›å€¼ä¸ºå°±ç»ªçš„æ–‡ä»¶æè¿°ç¬¦æ€»æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 272 unshare int unshare(int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†è°ƒç”¨è¿›ç¨‹ä»å…¶çˆ¶è¿›ç¨‹çš„å…±äº«èµ„æºä¸­åˆ†ç¦»å‡ºæ¥ï¼Œä»è€Œåˆ›å»ºæ–°çš„å‘½åç©ºé—´ã€‚flags å‚æ•°æŒ‡å®šè¦åˆ†ç¦»çš„èµ„æºç±»å‹ï¼Œå¦‚æ–‡ä»¶ç³»ç»Ÿã€PID æˆ–ç½‘ç»œã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 273 set_robust_list int set_robust_list(struct robust_list_head *head, size_t len); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºä¸ºè°ƒç”¨è¿›ç¨‹è®¾ç½®ä¸€ä¸ªå¥å£®çš„äº’æ–¥é”åˆ—è¡¨ã€‚è¯¥åˆ—è¡¨ç”¨äºåœ¨è¿›ç¨‹å´©æºƒæ—¶è‡ªåŠ¨é‡Šæ”¾äº’æ–¥é”ï¼Œä»è€Œé˜²æ­¢æ­»é”ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 274 get_robust_list int get_robust_list(int pid, struct robust_list_head **head_ptr, size_t *len_ptr); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–æŒ‡å®šè¿›ç¨‹çš„å¥å£®äº’æ–¥é”åˆ—è¡¨ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 275 splice ssize_t splice(int fd_in, loff_t *off_in, int fd_out, loff_t *off_out, size_t len, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåœ¨ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¹‹é—´ç§»åŠ¨æ•°æ®ï¼Œæ— éœ€é€šè¿‡ç”¨æˆ·ç©ºé—´ç¼“å†²åŒºã€‚å®ƒé€šè¿‡å†…æ ¸ç¼“å†²åŒºè¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œæä¾›äº†éå¸¸é«˜æ•ˆçš„é›¶æ‹·è´ IOã€‚æˆåŠŸè¿”å›ä¼ è¾“çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 276 tee ssize_t tee(int fd_in, int fd_out, size_t len, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåœ¨ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¹‹é—´å¤åˆ¶æ•°æ®ï¼Œæ— éœ€é€šè¿‡ç”¨æˆ·ç©ºé—´ç¼“å†²åŒºã€‚å®ƒä» fd_in å¤åˆ¶ len å­—èŠ‚æ•°æ®åˆ° fd_outï¼ŒåŒæ—¶ä¿æŒ fd_in ä¸Šçš„æ•°æ®ä¸å˜ã€‚æˆåŠŸè¿”å›å¤åˆ¶çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 277 sync_file_range int sync_file_range(int fd, off64_t offset, off64_t nbytes, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†æ–‡ä»¶çš„ä¸€éƒ¨åˆ†æ•°æ®ï¼ˆåœ¨æŒ‡å®šèŒƒå›´å†…ï¼‰åŒæ­¥åˆ°ç£ç›˜ã€‚å®ƒæä¾›äº†æ¯” fsync æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œå¯ä»¥åªåŒæ­¥æ–‡ä»¶çš„éƒ¨åˆ†åŒºåŸŸã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 278 vmsplice ssize_t vmsplice(int fd, const struct iovec *iov, unsigned long nr_segs, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†ç”¨æˆ·ç©ºé—´ç¼“å†²åŒºä¸­çš„æ•°æ®ç§»åŠ¨åˆ°å†…æ ¸ç¼“å†²åŒºï¼Œå¹¶å°†å…¶é“¾æ¥åˆ°æ–‡ä»¶æè¿°ç¬¦ã€‚å®ƒå…è®¸é«˜æ•ˆåœ°å°†å¤šä¸ªä¸è¿ç»­çš„å†…å­˜åŒºåŸŸä¼ è¾“åˆ°æ–‡ä»¶æˆ–å¥—æ¥å­—ã€‚æˆåŠŸè¿”å›ä¼ è¾“çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 279 move_pages long move_pages(int pid, unsigned long nr_pages, const void **pages, const int *nodes, int *status, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†æŒ‡å®šè¿›ç¨‹çš„å†…å­˜é¡µé¢ç§»åŠ¨åˆ°æŒ‡å®šçš„ NUMA èŠ‚ç‚¹ã€‚è¿™å¯ä»¥ç”¨äºä¼˜åŒ– NUMA æ¶æ„ä¸Šçš„å†…å­˜è®¿é—®ã€‚æˆåŠŸè¿”å›ç§»åŠ¨çš„é¡µé¢æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 280 utimensat int utimensat(int dirfd, const char *pathname, const struct timespec times[2], int flags); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ utimes çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒæ¥å—ä¸€ä¸ªç›®å½•æ–‡ä»¶æè¿°ç¬¦ dirfd ä½œä¸ºç›¸å¯¹è·¯å¾„çš„èµ·ç‚¹ï¼Œå¹¶ä¸”æ”¯æŒçº³ç§’ç²¾åº¦ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 281 epoll_pwait int epoll_pwait(int epfd, struct epoll_event *events, int maxevents, int timeout, const sigset_t *sigmask); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ epoll_wait çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒå…è®¸åŸå­æ€§åœ°æ”¹å˜ä¿¡å·æ©ç å¹¶ç­‰å¾…äº‹ä»¶ã€‚è¿™å¯¹äºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­å®‰å…¨åœ°å¤„ç†ä¿¡å·éå¸¸æœ‰ç”¨ã€‚è¿”å›å€¼ä¸ºå°±ç»ªäº‹ä»¶çš„æ•°é‡ï¼Œå¤±è´¥è¿”å› -1ã€‚ 282 signalfd int signalfd(int fd, const sigset_t *mask, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œç”¨äºæ¥æ”¶ä¿¡å·ã€‚å½“æŒ‡å®šä¿¡å·å‘é€åˆ°è¿›ç¨‹æ—¶ï¼Œä¿¡å·ä¿¡æ¯å°†ä»¥ signalfd_siginfo ç»“æ„ä½“çš„å½¢å¼å†™å…¥æ­¤æ–‡ä»¶æè¿°ç¬¦ã€‚è¿”å›å€¼ä¸ºæ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 283 timerfd_create int timerfd_create(int clockid, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè¯¥æè¿°ç¬¦å¯ç”¨äºæ¥æ”¶è®¡æ—¶å™¨åˆ°æœŸäº‹ä»¶ã€‚clockid æŒ‡å®šæ—¶é’Ÿç±»å‹ï¼Œflags æä¾›é€‰é¡¹ã€‚è¿”å›å€¼ä¸ºæ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 284 eventfd int eventfd(unsigned int initval, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½œä¸ºäº‹ä»¶é€šçŸ¥æœºåˆ¶ã€‚å®ƒå¯ä»¥ç”¨äºçº¿ç¨‹æˆ–è¿›ç¨‹é—´çš„åŒæ­¥ã€‚è¿”å›å€¼ä¸ºæ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 285 fallocate int fallocate(int fd, int mode, off_t offset, off_t len); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºé¢„å…ˆåˆ†é…ä¸€ä¸ªæ–‡ä»¶çš„ç£ç›˜ç©ºé—´ã€‚å®ƒç¡®ä¿æ–‡ä»¶æœ‰è¶³å¤Ÿçš„ç©ºé—´ï¼Œè€Œæ— éœ€å®é™…å†™å…¥æ•°æ®ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 286 timerfd_settime int timerfd_settime(int fd, int flags, const struct itimerspec *new_value, struct itimerspec *old_value); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®æˆ–ä¿®æ”¹ timerfd æ–‡ä»¶æè¿°ç¬¦çš„è®¡æ—¶å™¨ã€‚new_value æŒ‡å®šæ–°çš„åˆ°æœŸæ—¶é—´å’Œé—´éš”ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 287 timerfd_gettime int timerfd_gettime(int fd, struct itimerspec *curr_value); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å– timerfd æ–‡ä»¶æè¿°ç¬¦çš„è®¡æ—¶å™¨å½“å‰å€¼ã€‚curr_value ç»“æ„ä½“ç”¨äºå­˜å‚¨å‰©ä½™æ—¶é—´å’Œé—´éš”ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 288 accept4 int accept4(int sockfd, struct sockaddr *addr, socklen_t *addrlen, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ accept çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒå…è®¸åœ¨æ¥å—è¿æ¥æ—¶æŒ‡å®šé¢å¤–çš„æ ‡å¿—ï¼Œå¦‚ SOCK_NONBLOCK æˆ– SOCK_CLOEXECã€‚æˆåŠŸè¿”å›æ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 289 signalfd4 int signalfd4(int fd, const sigset_t *mask, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ signalfd çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒæ¥å—ä¸€ä¸ªé¢å¤–çš„æ ‡å¿—å‚æ•°ï¼Œä¾‹å¦‚ SFD_CLOEXECã€‚ 290 eventfd2 int eventfd2(unsigned int initval, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ eventfd çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒæ¥å—ä¸€ä¸ªé¢å¤–çš„æ ‡å¿—å‚æ•°ï¼Œä¾‹å¦‚ EFD_CLOEXECã€‚ 291 epoll_create1 int epoll_create1(int flags); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ epoll_create çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒå…è®¸æŒ‡å®šé¢å¤–çš„æ ‡å¿—ï¼Œå¦‚ EPOLL_CLOEXECã€‚è¿”å›ä¸€ä¸ª epoll å®ä¾‹çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 292 dup3 int dup3(int oldfd, int newfd, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ dup2 çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒå…è®¸æŒ‡å®šé¢å¤–çš„æ ‡å¿—ï¼Œå¦‚ O_CLOEXECã€‚æˆåŠŸè¿”å› newfdï¼Œå¤±è´¥è¿”å› -1ã€‚ 293 pipe2 int pipe2(int pipefd[2], int flags); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ pipe çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒå…è®¸æŒ‡å®šé¢å¤–çš„æ ‡å¿—ï¼Œå¦‚ O_CLOEXEC æˆ– O_NONBLOCKã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 294 inotify_init1 int inotify_init1(int flags); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ inotify_init çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒå…è®¸æŒ‡å®šé¢å¤–çš„æ ‡å¿—ï¼Œå¦‚ IN_CLOEXEC æˆ– IN_NONBLOCKã€‚è¿”å›ä¸€ä¸ª inotify å®ä¾‹çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 295 preadv ssize_t preadv(int fd, const struct iovec *iov, int iovcnt, off_t offset); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ readv çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒå…è®¸åœ¨æŒ‡å®šåç§»é‡ offset å¤„è¯»å–æ•°æ®ï¼Œè€Œæ— éœ€æ”¹å˜æ–‡ä»¶æè¿°ç¬¦çš„å½“å‰ä½ç½®ã€‚è¿”å›å€¼ä¸ºè¯»å–çš„æ€»å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 296 pwritev ssize_t pwritev(int fd, const struct iovec *iov, int iovcnt, off_t offset); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ writev çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒå…è®¸åœ¨æŒ‡å®šåç§»é‡ offset å¤„å†™å…¥æ•°æ®ï¼Œè€Œæ— éœ€æ”¹å˜æ–‡ä»¶æè¿°ç¬¦çš„å½“å‰ä½ç½®ã€‚è¿”å›å€¼ä¸ºå†™å…¥çš„æ€»å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 297 rt_tgsigqueueinfo int rt_tgsigqueueinfo(int tgid, int tid, int sig, siginfo_t *uinfo); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ rt_sigqueueinfo çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒæ¥å—çº¿ç¨‹ç»„ ID tgidï¼Œä»è€Œç¡®ä¿ä¿¡å·å‘é€åˆ°æ­£ç¡®çš„çº¿ç¨‹ç»„ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 298 perf_event_open int perf_event_open(struct perf_event_attr *attr, pid_t pid, int cpu, int group_fd, unsigned long flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºå’Œæ‰“å¼€ä¸€ä¸ªæ€§èƒ½ç›‘æ§äº‹ä»¶ã€‚å®ƒç”¨äºåˆ†æ CPU æ€§èƒ½è®¡æ•°å™¨ã€‚æˆåŠŸè¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 299 recvmmsg int recvmmsg(int sockfd, struct mmsghdr *msgvec, unsigned int vlen, unsigned int flags, struct timespec *timeout); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºä»å¥—æ¥å­—æ¥æ”¶å¤šæ¡æ¶ˆæ¯ã€‚å®ƒæ¯”å¾ªç¯è°ƒç”¨ recvmsg æ›´é«˜æ•ˆï¼Œå¯ä»¥ä¸€æ¬¡æ€§æ¥æ”¶å¤šæ¡æ¶ˆæ¯ã€‚è¿”å›å€¼ä¸ºæ¥æ”¶çš„æ¶ˆæ¯æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 300 fanotify_init int fanotify_init(unsigned int flags, unsigned int event_f_flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆå§‹åŒ–ä¸€ä¸ª fanotify å®ä¾‹ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚fanotify å®ä¾‹ç”¨äºç›‘è§†æ–‡ä»¶ç³»ç»Ÿçš„äº‹ä»¶å’Œè®¿é—®æƒé™ã€‚è¿”å›å€¼ä¸ºæ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 301 fanotify_mark int fanotify_mark(int fanotify_fd, unsigned int flags, uint64_t mask, int dfd, const char *pathname); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå‘ fanotify å®ä¾‹æ·»åŠ ã€ä¿®æ”¹æˆ–åˆ é™¤ä¸€ä¸ªç›‘è§†ã€‚å®ƒæŒ‡å®šè¦ç›‘è§†çš„æ–‡ä»¶æˆ–ç›®å½•ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 302 prlimit64 int prlimit64(pid_t pid, int resource, const struct rlimit64 *new_limit, struct rlimit64 *old_limit); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–æˆ–è®¾ç½®è¿›ç¨‹çš„èµ„æºé™åˆ¶ã€‚å®ƒæ˜¯ setrlimit çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œæ”¯æŒ 64 ä½é™åˆ¶ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 303 name_to_handle_at int name_to_handle_at(int dirfd, const char *pathname, struct file_handle *handle, int *mount_id, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–ä¸€ä¸ªæ–‡ä»¶çš„æ–‡ä»¶å¥æŸ„ã€‚æ–‡ä»¶å¥æŸ„å¯ä»¥åœ¨æ–‡ä»¶è¢«é‡å‘½åæˆ–ç§»åŠ¨åä»ç„¶ç”¨äºå¼•ç”¨è¯¥æ–‡ä»¶ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 304 open_by_handle_at int open_by_handle_at(int mount_fd, struct file_handle *handle, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºé€šè¿‡æ–‡ä»¶å¥æŸ„æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶ã€‚è¿™ä½¿å¾—å³ä½¿æ–‡ä»¶è¢«é‡å‘½åæˆ–ç§»åŠ¨ï¼Œä¹Ÿå¯ä»¥æ‰“å¼€å®ƒã€‚æˆåŠŸè¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 305 clock_adjtime int clock_adjtime(clockid_t clkid, struct timex *buf); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè°ƒæ•´æŒ‡å®šæ—¶é’Ÿçš„æ—¶é—´ã€‚å®ƒæ¯” adjtimex æ›´é€šç”¨ï¼Œæ”¯æŒå¤šç§æ—¶é’Ÿã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 306 syncfs int syncfs(int fd); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†æŒ‡å®šæ–‡ä»¶æè¿°ç¬¦æ‰€å±çš„æ–‡ä»¶ç³»ç»Ÿçš„æ‰€æœ‰è„æ•°æ®åŒæ­¥åˆ°ç£ç›˜ã€‚å®ƒæ¯” sync æ›´ç»†ç²’åº¦ï¼ŒåªåŒæ­¥ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 307 sendmmsg int sendmmsg(int sockfd, struct mmsghdr *msgvec, unsigned int vlen, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå‘å¥—æ¥å­—å‘é€å¤šæ¡æ¶ˆæ¯ã€‚å®ƒæ¯”å¾ªç¯è°ƒç”¨ sendmsg æ›´é«˜æ•ˆï¼Œå¯ä»¥ä¸€æ¬¡æ€§å‘é€å¤šæ¡æ¶ˆæ¯ã€‚æˆåŠŸè¿”å›å‘é€çš„æ¶ˆæ¯æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 308 setns int setns(int fd, int nstype); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†è°ƒç”¨è¿›ç¨‹ç§»åŠ¨åˆ°æŒ‡å®šçš„å‘½åç©ºé—´ã€‚fd æ˜¯ä¸€ä¸ªå¼•ç”¨å‘½åç©ºé—´çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œnstype æŒ‡å®šå‘½åç©ºé—´çš„ç±»å‹ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 309 getcpu int getcpu(unsigned *cpu, unsigned *node, struct getcpu_cache *tcache); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–è°ƒç”¨çº¿ç¨‹å½“å‰æ­£åœ¨è¿è¡Œçš„ CPU ç¼–å·å’Œ NUMA èŠ‚ç‚¹ç¼–å·ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 310 process_vm_readv ssize_t process_vm_readv(pid_t pid, const struct iovec *local_iov, unsigned long liovcnt, const struct iovec *remote_iov, unsigned long riovcnt, unsigned long flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºä»å¦ä¸€ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´è¯»å–æ•°æ®ã€‚å®ƒå°†ç›®æ ‡è¿›ç¨‹çš„å¤šä¸ªä¸è¿ç»­å†…å­˜åŒºåŸŸçš„æ•°æ®è¯»å–åˆ°è°ƒç”¨è¿›ç¨‹çš„å¤šä¸ªä¸è¿ç»­å†…å­˜åŒºåŸŸã€‚æˆåŠŸè¿”å›è¯»å–çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 311 process_vm_writev ssize_t process_vm_writev(pid_t pid, const struct iovec *local_iov, unsigned long liovcnt, const struct iovec *remote_iov, unsigned long riovcnt, unsigned long flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå‘å¦ä¸€ä¸ªè¿›ç¨‹çš„åœ°å€ç©ºé—´å†™å…¥æ•°æ®ã€‚å®ƒå°†è°ƒç”¨è¿›ç¨‹çš„å¤šä¸ªä¸è¿ç»­å†…å­˜åŒºåŸŸçš„æ•°æ®å†™å…¥ç›®æ ‡è¿›ç¨‹çš„å¤šä¸ªä¸è¿ç»­å†…å­˜åŒºåŸŸã€‚æˆåŠŸè¿”å›å†™å…¥çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 312 kcmp int kcmp(pid_t pid1, pid_t pid2, int type, unsigned long idx1, unsigned long idx2); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæ¯”è¾ƒä¸¤ä¸ªè¿›ç¨‹çš„å†…æ ¸èµ„æºã€‚type æŒ‡å®šè¦æ¯”è¾ƒçš„èµ„æºç±»å‹ï¼Œä¾‹å¦‚æ–‡ä»¶æè¿°ç¬¦è¡¨æˆ–è™šæ‹Ÿå†…å­˜ç©ºé—´ã€‚æˆåŠŸè¿”å› 0 æˆ– 1ï¼Œå¤±è´¥è¿”å› -1ã€‚ 313 finit_module int finit_module(int fd, const char *param_values, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºä»å·²æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦åŠ è½½ä¸€ä¸ªå†…æ ¸æ¨¡å—ã€‚fd æ˜¯æ¨¡å—æ–‡ä»¶çš„æè¿°ç¬¦ï¼Œparam_values æ˜¯æ¨¡å—å‚æ•°ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 314 sched_setattr int sched_setattr(pid_t pid, const struct sched_attr *attr, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®è¿›ç¨‹çš„è°ƒåº¦ç­–ç•¥å’Œå‚æ•°ã€‚å®ƒæ¯” sched_setscheduler æ›´é€šç”¨ï¼Œæ”¯æŒæ›´çµæ´»çš„è°ƒåº¦ç­–ç•¥ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 315 sched_getattr int sched_getattr(pid_t pid, struct sched_attr *attr, unsigned int size, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–è¿›ç¨‹çš„è°ƒåº¦ç­–ç•¥å’Œå‚æ•°ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 316 renameat2 int renameat2(int olddirfd, const char *oldpath, int newdirfd, const char *newpath, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ renameat çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒæä¾›äº†é¢å¤–çš„æ ‡å¿—ï¼Œå¦‚ RENAME_NOREPLACEï¼ˆå¦‚æœç›®æ ‡æ–‡ä»¶å­˜åœ¨åˆ™ä¸æ›¿æ¢ï¼‰ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 317 seccomp int seccomp(unsigned int operation, unsigned int flags, const char *args); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®æˆ–è·å–å®‰å…¨è®¡ç®—æ¨¡å¼ï¼ˆseccompï¼‰çŠ¶æ€ã€‚å®ƒé™åˆ¶äº†è¿›ç¨‹å¯ä»¥è°ƒç”¨çš„ç³»ç»Ÿè°ƒç”¨ï¼Œä»è€Œå¢å¼ºå®‰å…¨æ€§ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 318 getrandom ssize_t getrandom(void *buf, size_t buflen, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºä»å†…æ ¸çš„åŠ å¯†å®‰å…¨ä¼ªéšæœºæ•°ç”Ÿæˆå™¨ä¸­è·å–éšæœºå­—èŠ‚ã€‚buf ç”¨äºå­˜å‚¨éšæœºæ•°æ®ï¼Œbuflen æŒ‡å®šé•¿åº¦ã€‚æˆåŠŸè¿”å›è·å–çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 319 memfd_create int memfd_create(const char *name, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€ä¸ªå†…å­˜æ–‡ä»¶ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚è¯¥æ–‡ä»¶åªå­˜åœ¨äºå†…å­˜ä¸­ï¼Œå¯ä»¥è¢«å…¶ä»–è¿›ç¨‹è®¿é—®ã€‚æˆåŠŸè¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 320 kexec_file_load long kexec_file_load(int kernel_fd, int initrd_fd, unsigned long cmdline_len, const char *cmdline_ptr, unsigned long flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºä»æ–‡ä»¶æè¿°ç¬¦åŠ è½½ä¸€ä¸ªå†…æ ¸é•œåƒï¼Œä»¥ä¾¿åœ¨ä¸é‡å¯ç‰©ç†æœºå™¨çš„æƒ…å†µä¸‹å¯åŠ¨å®ƒã€‚å®ƒæ¯” kexec_load æ›´å®‰å…¨ï¼Œå› ä¸ºå®ƒä½¿ç”¨æ–‡ä»¶æè¿°ç¬¦æ¥å¼•ç”¨æ–‡ä»¶ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 321 bpf int bpf(int cmd, union bpf_attr *attr, unsigned int size); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæ“ä½œ BPFï¼ˆBerkeley Packet Filterï¼‰ç¨‹åºå’Œæ˜ å°„ã€‚å®ƒå…è®¸åœ¨å†…æ ¸ä¸­æ‰§è¡Œé«˜æ•ˆçš„ã€æ²™ç›’åŒ–çš„ç¨‹åºï¼Œç”¨äºç½‘ç»œè¿‡æ»¤ã€è·Ÿè¸ªç­‰ã€‚æˆåŠŸè¿”å›å–å†³äº cmd çš„å€¼ï¼Œå¤±è´¥è¿”å› -1ã€‚ 322 execveat int execveat(int dirfd, const char *pathname, char *const argv[], char *const envp[], int flags); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ execve çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒæ¥å—ä¸€ä¸ªç›®å½•æ–‡ä»¶æè¿°ç¬¦ dirfd ä½œä¸ºç›¸å¯¹è·¯å¾„çš„èµ·ç‚¹ï¼Œå¹¶æ”¯æŒé¢å¤–çš„æ ‡å¿—ï¼Œå¦‚ AT_EMPTY_PATHã€‚æˆåŠŸæ—¶æ°¸ä¸è¿”å›ï¼Œå¤±è´¥è¿”å› -1ã€‚ 323 userfaultfd int userfaultfd(int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€ä¸ªç”¨æˆ·ç©ºé—´é¡µé¢é”™è¯¯å¤„ç†ç¨‹åºçš„æ–‡ä»¶æè¿°ç¬¦ã€‚å®ƒå…è®¸ç”¨æˆ·ç©ºé—´çš„åº”ç”¨ç¨‹åºå¤„ç†ç”±è‡ªèº«æˆ–å¦ä¸€ä¸ªè¿›ç¨‹äº§ç”Ÿçš„é¡µé¢é”™è¯¯ã€‚æˆåŠŸè¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 324 membarrier int membarrier(int cmd, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåœ¨æ‰€æœ‰çº¿ç¨‹ä¸Šæä¾›ä¸€ä¸ªå†…å­˜å±éšœï¼Œä»¥ç¡®ä¿æ‰€æœ‰ CPU çš„å†…å­˜è§†å›¾åŒæ­¥ã€‚è¿™å¯¹äºè·¨çº¿ç¨‹æˆ–è·¨è¿›ç¨‹çš„å†…å­˜ä¸€è‡´æ€§è‡³å…³é‡è¦ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 325 mlock2 int mlock2(const void *addr, size_t len, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ mlock çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒæä¾›äº†é¢å¤–çš„æ ‡å¿—ï¼Œå¦‚ MLOCK_ONFAULTï¼Œå¯ä»¥å»¶è¿Ÿé”å®šï¼Œç›´åˆ°è®¿é—®åˆ°è¯¥é¡µé¢ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 326 copy_file_range ssize_t copy_file_range(int fd_in, loff_t *off_in, int fd_out, loff_t *off_out, size_t len, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåœ¨ä¸¤ä¸ªæ–‡ä»¶æè¿°ç¬¦ä¹‹é—´å¤åˆ¶æ•°æ®ï¼Œæ— éœ€é€šè¿‡ç”¨æˆ·ç©ºé—´ç¼“å†²åŒºã€‚å®ƒé€šè¿‡å†…æ ¸è¿›è¡Œé›¶æ‹·è´å¤åˆ¶ï¼Œæä¾›äº†éå¸¸é«˜æ•ˆçš„æ–‡ä»¶å¤åˆ¶ã€‚æˆåŠŸè¿”å›å¤åˆ¶çš„å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 327 preadv2 ssize_t preadv2(int fd, const struct iovec *iov, unsigned long iovcnt, off_t offset, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ preadv çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒæä¾›äº†é¢å¤–çš„æ ‡å¿—ï¼Œå¦‚ RWF_HIPRIï¼ˆé«˜ä¼˜å…ˆçº§ï¼‰æˆ– RWF_APPENDã€‚æˆåŠŸè¿”å›è¯»å–çš„æ€»å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 328 pwritev2 ssize_t pwritev2(int fd, const struct iovec *iov, unsigned long iovcnt, off_t offset, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ pwritev çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒæä¾›äº†é¢å¤–çš„æ ‡å¿—ï¼Œå¦‚ RWF_HIPRIã€‚æˆåŠŸè¿”å›å†™å…¥çš„æ€»å­—èŠ‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 329 pkey_mprotect int pkey_mprotect(void *addr, size_t len, int prot, int pkey); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ mprotect çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒå…è®¸ä½¿ç”¨å†…å­˜ä¿æŠ¤é”®ï¼ˆpkeyï¼‰æ¥æ§åˆ¶å†…å­˜è®¿é—®ã€‚è¿™æä¾›äº†æ›´ç»†ç²’åº¦çš„å†…å­˜ä¿æŠ¤ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 330 pkey_alloc int pkey_alloc(unsigned int flags, unsigned int access_rights); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ†é…ä¸€ä¸ªæœªä½¿ç”¨çš„å†…å­˜ä¿æŠ¤é”®ã€‚flags å’Œ access_rights æŒ‡å®šé”®çš„å±æ€§ã€‚æˆåŠŸè¿”å›æ–°çš„ä¿æŠ¤é”®ï¼Œå¤±è´¥è¿”å› -1ã€‚ 331 pkey_free int pkey_free(int pkey); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºé‡Šæ”¾ä¸€ä¸ªå†…å­˜ä¿æŠ¤é”®ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 332 statx int statx(int dirfd, const char *pathname, int flags, unsigned int mask, struct statx *statxbuf); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ stat çš„ä¸€ä¸ªæ–°ç‰ˆæœ¬ï¼Œå®ƒæä¾›äº†æ›´å¤šçš„æ–‡ä»¶ä¿¡æ¯ï¼Œå¹¶å…è®¸åœ¨å•ä¸ªè°ƒç”¨ä¸­è·å–å¤šç§å±æ€§ã€‚mask æŒ‡å®šè¦è·å–çš„å±æ€§ï¼Œstatxbuf ç»“æ„ä½“ç”¨äºå­˜å‚¨ç»“æœã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 333 io_pgetevents int io_pgetevents(aio_context_t ctx_id, long min_nr, long nr, struct io_event *events, struct timespec *timeout, const sigset_t *sigmask); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ io_getevents çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒå…è®¸åŸå­æ€§åœ°æ”¹å˜ä¿¡å·æ©ç å¹¶æ£€ç´¢äº‹ä»¶ã€‚è¿™å¯¹äºå¤„ç†ä¿¡å·å’Œå¼‚æ­¥ IO äº‹ä»¶éå¸¸æœ‰ç”¨ã€‚è¿”å›å€¼ä¸ºè·å–çš„äº‹ä»¶æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 334 rseq int rseq(struct rseq *rseq, uint32_t rseq_len, int flags, uint32_t sig); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæ³¨å†Œæˆ–å–æ¶ˆä¸€ä¸ª rseqï¼ˆå¯é‡å¯åºåˆ—ï¼‰ç»“æ„ã€‚rseq æ˜¯ä¸€ç§ç”¨äºå®ç°é«˜æ•ˆç”¨æˆ·ç©ºé—´åŸå­æ“ä½œçš„æœºåˆ¶ï¼Œç‰¹åˆ«æ˜¯åœ¨ NUMA ç³»ç»Ÿä¸Šã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 335 uretprobe int uretprobe(int type, int arg); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåœ¨ç”¨æˆ·ç©ºé—´çš„å‡½æ•°è¿”å›æ—¶è®¾ç½®æ¢é’ˆã€‚æ­¤è°ƒç”¨å·²è¿‡æ—¶ï¼Œæ¨èä½¿ç”¨ bpfã€‚ 424 pidfd_send_signal int pidfd_send_signal(int pidfd, int sig, siginfo_t *info, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå‘ç”±æ–‡ä»¶æè¿°ç¬¦ pidfd æŒ‡å®šçš„è¿›ç¨‹å‘é€ä¿¡å·ã€‚pidfd æä¾›äº†æ¯”ä¼ ç»Ÿ PID æ›´å¥å£®çš„è¿›ç¨‹å¼•ç”¨æ–¹å¼ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 425 io_uring_setup int io_uring_setup(unsigned int entries, struct io_uring_params *params); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºå’Œåˆå§‹åŒ–ä¸€ä¸ª io_uring å®ä¾‹ã€‚entries æŒ‡å®šé˜Ÿåˆ—ä¸­çš„æ¡ç›®æ•°ï¼Œparams æä¾›äº†é¢å¤–çš„å‚æ•°ã€‚io_uring æ˜¯ä¸€ç§é«˜æ€§èƒ½å¼‚æ­¥ IO æ¥å£ã€‚æˆåŠŸè¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 426 io_uring_enter int io_uring_enter(int fd, unsigned int to_submit, unsigned int min_complete, unsigned int flags, sigset_t *sig); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæäº¤ io_uring å®ä¾‹ä¸­çš„è¯·æ±‚ï¼Œå¹¶ç­‰å¾…å·²å®Œæˆçš„è¯·æ±‚ã€‚å®ƒå…è®¸åº”ç”¨ç¨‹åºå°†è¯·æ±‚æ’é˜Ÿå¹¶å¼‚æ­¥åœ°å¤„ç†ç»“æœã€‚æˆåŠŸè¿”å›æäº¤çš„è¯·æ±‚æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 427 io_uring_register int io_uring_register(int fd, unsigned int opcode, const void *arg, unsigned int nr_args); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæ³¨å†Œ io_uring å®ä¾‹ä¸­çš„æ–‡ä»¶æè¿°ç¬¦æˆ–ç¼“å†²åŒºï¼Œä»¥æé«˜æ€§èƒ½ã€‚å®ƒå…è®¸å†…æ ¸å¯¹èµ„æºè¿›è¡Œé¢„å¤„ç†ï¼Œä»è€Œå‡å°‘åç»­çš„å¼€é”€ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 428 open_tree int open_tree(int dirfd, const char *pathname, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•å­æ ‘çš„å¥æŸ„ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚è¿™ä½¿å¾—åœ¨ä¸ä½¿ç”¨ chroot çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥å¯¹æ–‡ä»¶æ ‘è¿›è¡Œæ“ä½œã€‚æˆåŠŸè¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 429 move_mount int move_mount(int from_dirfd, const char *from_pathname, int to_dirfd, const char *to_pathname, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºç§»åŠ¨ä¸€ä¸ªæŒ‚è½½ç‚¹ã€‚å®ƒå°†ä¸€ä¸ªæŒ‚è½½ç‚¹ä»ä¸€ä¸ªä½ç½®ç§»åŠ¨åˆ°å¦ä¸€ä¸ªä½ç½®ï¼Œè€Œæ— éœ€å¸è½½å’Œé‡æ–°æŒ‚è½½ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 430 fsopen int fsopen(const char *fsname, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„æ–‡ä»¶ç³»ç»Ÿå®ä¾‹ã€‚å®ƒè¿”å›ä¸€ä¸ªç”¨äºé…ç½®è¯¥æ–‡ä»¶ç³»ç»Ÿçš„æ–‡ä»¶æè¿°ç¬¦ã€‚æˆåŠŸè¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 431 fsconfig int fsconfig(int fd, unsigned int cmd, const char *key, const void *value, int aux); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºé…ç½®ä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿå®ä¾‹ã€‚fd æ˜¯æ–‡ä»¶ç³»ç»Ÿå®ä¾‹çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œcmd æŒ‡å®šæ“ä½œç±»å‹ï¼Œå¦‚è®¾ç½®é€‰é¡¹æˆ–æäº¤é…ç½®ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 432 fsmount int fsmount(int fs_fd, unsigned int flags, unsigned int ms_flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæŒ‚è½½ä¸€ä¸ªå·²é…ç½®çš„æ–‡ä»¶ç³»ç»Ÿå®ä¾‹ã€‚fs_fd æ˜¯æ–‡ä»¶ç³»ç»Ÿå®ä¾‹çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œflags æä¾›æŒ‚è½½é€‰é¡¹ã€‚æˆåŠŸè¿”å›æŒ‚è½½çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 433 fspick int fspick(int dirfd, const char *path, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºä»æ–‡ä»¶æ ‘ä¸­é€‰æ‹©ä¸€ä¸ªæ–‡ä»¶æˆ–ç›®å½•ï¼Œå¹¶è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚è¿™å¯ä»¥ç”¨äºåœ¨ä¸è¿›è¡Œç¬¦å·é“¾æ¥éå†çš„æƒ…å†µä¸‹è·å–æ–‡ä»¶å¥æŸ„ã€‚æˆåŠŸè¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 434 pidfd_open int pidfd_open(pid_t pid, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºæ‰“å¼€ä¸€ä¸ªè¿›ç¨‹çš„æ–‡ä»¶æè¿°ç¬¦ã€‚pid æŒ‡å®šç›®æ ‡è¿›ç¨‹ã€‚pidfd å¯ä»¥ç”¨äºå‘è¯¥è¿›ç¨‹å‘é€ä¿¡å·æˆ–æ‰§è¡Œå…¶ä»–æ“ä½œï¼Œå³ä½¿è¿›ç¨‹çš„ PID å‘ç”Ÿå˜åŒ–ã€‚æˆåŠŸè¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 435 clone3 int clone3(struct clone_args *cl_args, size_t size); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ clone çš„ä¸€ä¸ªæ–°ç‰ˆæœ¬ï¼Œå®ƒä½¿ç”¨ä¸€ä¸ªç»“æ„ä½“æ¥ä¼ é€’å‚æ•°ï¼Œä»è€Œæä¾›äº†æ›´å¥½çš„å¯æ‰©å±•æ€§ã€‚å®ƒç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„å­è¿›ç¨‹æˆ–çº¿ç¨‹ã€‚æˆåŠŸè¿”å›å­è¿›ç¨‹çš„ PIDï¼Œå¤±è´¥è¿”å› -1ã€‚ 436 close_range int close_range(unsigned int first, unsigned int last, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå…³é—­æŒ‡å®šèŒƒå›´å†…çš„æ‰€æœ‰æ–‡ä»¶æè¿°ç¬¦ã€‚å®ƒæ¯”å¾ªç¯è°ƒç”¨ close æ›´é«˜æ•ˆï¼Œå¹¶ä¸”æ˜¯åŸå­æ€§çš„ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 437 openat2 int openat2(int dirfd, const char *pathname, struct open_how *how, size_t size); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ openat çš„ä¸€ä¸ªæ–°ç‰ˆæœ¬ï¼Œå®ƒä½¿ç”¨ä¸€ä¸ªç»“æ„ä½“æ¥ä¼ é€’å‚æ•°ï¼Œä»è€Œæä¾›äº†æ›´çµæ´»çš„æ‰“å¼€é€‰é¡¹ï¼Œå¦‚å¯¹ç¬¦å·é“¾æ¥çš„æ›´ç²¾ç»†æ§åˆ¶ã€‚æˆåŠŸè¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 438 pidfd_getfd int pidfd_getfd(int pidfd, int fd, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºä»ç”± pidfd æŒ‡å®šçš„è¿›ç¨‹ä¸­è·å–ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦çš„å‰¯æœ¬ã€‚æˆåŠŸè¿”å›æ–°çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 439 faccessat2 int faccessat2(int dirfd, const char *pathname, int mode, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ faccessat çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒæä¾›äº†é¢å¤–çš„æ ‡å¿—ï¼Œå¦‚ AT_EACCESSï¼Œç”¨äºæ ¹æ®æœ‰æ•ˆ UIDGID æ£€æŸ¥æƒé™ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 440 process_madvise int process_madvise(int pidfd, const struct iovec *iov, size_t iovcnt, int advice, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå¯¹å¦ä¸€ä¸ªè¿›ç¨‹çš„å†…å­˜åŒºåŸŸæä¾›å»ºè®®ã€‚pidfd å¼•ç”¨ç›®æ ‡è¿›ç¨‹ï¼Œiov æè¿°å†…å­˜åŒºåŸŸï¼Œadvice æä¾›å»ºè®®ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 441 epoll_pwait2 int epoll_pwait2(int epfd, struct epoll_event *events, int maxevents, const struct timespec *timeout, const sigset_t *sigmask); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ epoll_pwait çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒä½¿ç”¨ timespec ç»“æ„ä½“æ¥æŒ‡å®šè¶…æ—¶æ—¶é—´ï¼Œä»è€Œæ”¯æŒæ›´é«˜çš„ç²¾åº¦ã€‚è¿”å›å€¼ä¸ºå°±ç»ªäº‹ä»¶çš„æ•°é‡ï¼Œå¤±è´¥è¿”å› -1ã€‚ 442 mount_setattr int mount_setattr(int dirfd, const char *pathname, unsigned int flags, struct mount_attr *uattr, size_t size); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®æˆ–ä¿®æ”¹ä¸€ä¸ªæŒ‚è½½ç‚¹çš„å±æ€§ã€‚å®ƒæ¯” mount æ›´ç»†ç²’åº¦ï¼Œå¯ä»¥å•ç‹¬ä¿®æ”¹æŒ‚è½½å±æ€§ï¼Œå¦‚åªè¯»æˆ–ä¸å¯æ‰§è¡Œã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 443 quotactl_fd int quotactl_fd(unsigned int fd, unsigned int cmd, qid_t id, void *addr); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ quotactl çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒé€šè¿‡æ–‡ä»¶æè¿°ç¬¦æ¥å¼•ç”¨æ–‡ä»¶ç³»ç»Ÿã€‚è¿™å¯ä»¥é¿å…è·¯å¾„åè§£æçš„æ½œåœ¨é—®é¢˜ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 444 landlock_create_ruleset int landlock_create_ruleset(struct landlock_ruleset_attr *attr, size_t size, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€ä¸ªæ–°çš„ Landlock è§„åˆ™é›†ã€‚Landlock æ˜¯ä¸€ç§ç”¨äºé™åˆ¶è¿›ç¨‹æ–‡ä»¶ç³»ç»Ÿè®¿é—®æƒé™çš„å®‰å…¨æœºåˆ¶ã€‚æˆåŠŸè¿”å›è§„åˆ™é›†çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 445 landlock_add_rule int landlock_add_rule(int ruleset_fd, enum landlock_rule_type type, const void *attr, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå‘ä¸€ä¸ª Landlock è§„åˆ™é›†æ·»åŠ è§„åˆ™ã€‚ruleset_fd æ˜¯è§„åˆ™é›†çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œtype æŒ‡å®šè§„åˆ™ç±»å‹ï¼Œattr æä¾›äº†è§„åˆ™çš„è¯¦ç»†ä¿¡æ¯ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 446 landlock_restrict_self int landlock_restrict_self(int ruleset_fd, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå°†ä¸€ä¸ª Landlock è§„åˆ™é›†åº”ç”¨åˆ°è°ƒç”¨è¿›ç¨‹ã€‚è¿™ä¼šé™åˆ¶è¿›ç¨‹çš„æ–‡ä»¶ç³»ç»Ÿè®¿é—®æƒé™ï¼Œä¸€æ—¦åº”ç”¨ï¼Œè§„åˆ™é›†å°±æ— æ³•è¢«ä¿®æ”¹ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 447 memfd_secret int memfd_secret(unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ›å»ºä¸€ä¸ªç§˜å¯†çš„å†…å­˜æ–‡ä»¶ï¼Œå®ƒæ— æ³•è¢«å…¶ä»–è¿›ç¨‹è®¿é—®ï¼Œå³ä½¿æ˜¯å…·æœ‰é«˜æƒé™çš„è¿›ç¨‹ã€‚è¿™å¯¹äºå­˜å‚¨æ•æ„Ÿæ•°æ®éå¸¸æœ‰ç”¨ã€‚æˆåŠŸè¿”å›æ–‡ä»¶æè¿°ç¬¦ï¼Œå¤±è´¥è¿”å› -1ã€‚ 448 process_mrelease int process_mrelease(int pidfd, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºé‡Šæ”¾æŒ‡å®šè¿›ç¨‹çš„èµ„æºï¼Œä½†ä¸ä¼šç»ˆæ­¢è¿›ç¨‹ã€‚pidfd å¼•ç”¨ç›®æ ‡è¿›ç¨‹ã€‚è¿™å¯ä»¥ç”¨äºåœ¨ä¸ç­‰å¾…è¿›ç¨‹å®Œå…¨é€€å‡ºæ—¶å›æ”¶èµ„æºã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 449 futex_waitv int futex_waitv(struct futex_waitv *waitv, unsigned int nr_futexes, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ futex çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒå…è®¸åœ¨ä¸€ä¸ªåŸå­æ“ä½œä¸­ç­‰å¾…å¤šä¸ª futexã€‚è¿™å¯¹äºå®ç°å¤æ‚çš„åŒæ­¥åŸè¯­éå¸¸æœ‰ç”¨ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 450 set_mempolicy_home_node int set_mempolicy_home_node(unsigned int start, unsigned int len, unsigned int node); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®ä¸€ä¸ªè¿›ç¨‹çš„â€œå®¶â€NUMA èŠ‚ç‚¹ï¼Œå¹¶å°†å…¶å†…å­˜é¡µç»‘å®šåˆ°è¯¥èŠ‚ç‚¹ã€‚æ­¤è°ƒç”¨å·²è¿‡æ—¶ï¼Œæ¨èä½¿ç”¨ mbindã€‚ 451 cachestat int cachestat(int fd, const char *path, const struct statx *stx, unsigned int flags, struct cachestat *result); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–æ–‡ä»¶é¡µé¢ç¼“å­˜çš„ç»Ÿè®¡ä¿¡æ¯ã€‚fd å’Œ path æŒ‡å®šæ–‡ä»¶ï¼Œresult ç»“æ„ä½“ç”¨äºå­˜å‚¨ç¼“å­˜å‘½ä¸­ã€ä¸¢å¤±ç­‰ä¿¡æ¯ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 452 fchmodat2 int fchmodat2(int dirfd, const char *pathname, mode_t mode, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ fchmodat çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒæä¾›äº†é¢å¤–çš„æ ‡å¿—ï¼Œå¦‚ AT_SYMLINK_NOFOLLOWã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 453 map_shadow_stack unsigned long map_shadow_stack(unsigned long addr, unsigned long size, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºä¸ºè¿›ç¨‹åˆ›å»ºä¸€ä¸ªå½±å­æ ˆã€‚å½±å­æ ˆæ˜¯ä¸€ç§å®‰å…¨æœºåˆ¶ï¼Œç”¨äºä¿æŠ¤å‡½æ•°è¿”å›åœ°å€ä¸è¢«ç¼“å†²åŒºæº¢å‡ºç­‰æ”»å‡»ç¯¡æ”¹ã€‚æˆåŠŸè¿”å›å½±å­æ ˆçš„åœ°å€ï¼Œå¤±è´¥è¿”å› -1ã€‚ 454 futex_wake int futex_wake(int *uaddr, int nr_wake); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ futex çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œä¸“é—¨ç”¨äºå”¤é†’åœ¨æŒ‡å®š uaddr ä¸Šç­‰å¾…çš„çº¿ç¨‹ã€‚nr_wake æŒ‡å®šè¦å”¤é†’çš„æœ€å¤§çº¿ç¨‹æ•°ã€‚æˆåŠŸè¿”å›å”¤é†’çš„çº¿ç¨‹æ•°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 455 futex_wait int futex_wait(int *uaddr, int val); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ futex çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œä¸“é—¨ç”¨äºç­‰å¾…ã€‚å®ƒåœ¨ uaddr ä¸Šç­‰å¾…ï¼Œç›´åˆ°å…¶å€¼ä¸ç­‰äº valã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 456 futex_requeue int futex_requeue(int *uaddr, int nr_wake, int *uaddr2, int nr_requeue); æ­¤ç³»ç»Ÿè°ƒç”¨æ˜¯ futex çš„ä¸€ä¸ªç‰ˆæœ¬ï¼Œå®ƒå…è®¸åœ¨å•ä¸ªåŸå­æ“ä½œä¸­å”¤é†’ä¸€ä¸ª futex ä¸Šçš„çº¿ç¨‹ï¼Œå¹¶å°†å…¶ä½™çº¿ç¨‹é‡æ–°æ’é˜Ÿåˆ°å¦ä¸€ä¸ª futex ä¸Šã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 457 statmount int statmount(const char *pathname, struct statmount *statbuf); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–ä¸€ä¸ªæŒ‚è½½ç‚¹çš„çŠ¶æ€ä¿¡æ¯ã€‚æ­¤è°ƒç”¨å·²è¿‡æ—¶ã€‚ 458 listmount int listmount(const char *pathname, void *buf, size_t bufsize); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ—å‡ºä¸€ä¸ªæŒ‚è½½ç‚¹ä¸‹çš„æ‰€æœ‰å­æŒ‚è½½ç‚¹ã€‚æ­¤è°ƒç”¨å·²è¿‡æ—¶ã€‚ 459 lsm_get_self_attr int lsm_get_self_attr(const char *attr, void *value, size_t len); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè·å–å½“å‰è¿›ç¨‹çš„ Linux å®‰å…¨æ¨¡å—ï¼ˆLSMï¼‰å±æ€§ã€‚attr æŒ‡å®šå±æ€§åç§°ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 460 lsm_set_self_attr int lsm_set_self_attr(const char *attr, const void *value, size_t len, int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºè®¾ç½®å½“å‰è¿›ç¨‹çš„ Linux å®‰å…¨æ¨¡å—ï¼ˆLSMï¼‰å±æ€§ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚ 461 lsm_list_modules int lsm_list_modules(void *buf, size_t len); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºåˆ—å‡ºæ‰€æœ‰å·²å¯ç”¨çš„ Linux å®‰å…¨æ¨¡å—ï¼ˆLSMï¼‰ã€‚buf ç”¨äºå­˜å‚¨æ¨¡å—åç§°åˆ—è¡¨ã€‚æˆåŠŸè¿”å›åˆ—è¡¨çš„å¤§å°ï¼Œå¤±è´¥è¿”å› -1ã€‚ 462 mseal int mseal(void *addr, size_t len, unsigned int flags); æ­¤ç³»ç»Ÿè°ƒç”¨ç”¨äºå¯¹ä¸€ä¸ªå†…å­˜æ˜ å°„åŒºåŸŸè¿›è¡Œå¯†å°ã€‚ä¸€æ—¦å¯†å°ï¼Œè¯¥åŒºåŸŸçš„æŸäº›å±æ€§ï¼ˆå¦‚å¯å†™æ€§ï¼‰å°±æ— æ³•å†æ›´æ”¹ï¼Œä»è€Œå¢å¼ºå®‰å…¨æ€§ã€‚æˆåŠŸè¿”å› 0ï¼Œå¤±è´¥è¿”å› -1ã€‚","tags":["Linux"]},{"title":"Hello worldï¼","path":"/2025/11/12/Hello-worldï¼/","content":"ä¸€çº§æ ‡é¢˜è¿™æ˜¯ Markdown æ¸²æŸ“æµ‹è¯•æ–‡æ¡£ï¼Œç”¨äºéªŒè¯ï¼š æ™®é€šæ–‡æœ¬æ˜¯å¦æ˜¾ç¤ºæ­£å¸¸ å„ç§è¯­æ³•ï¼ˆæ ‡é¢˜ã€åˆ—è¡¨ã€é“¾æ¥ã€å›¾ç‰‡ã€ä»£ç ã€è¡¨æ ¼ç­‰ï¼‰ æ˜¯å¦æ”¯æŒæ•°å­¦å…¬å¼ï¼ˆéœ€å¯ç”¨ hexo-renderer-markdown-it + markdown-it-katex æˆ– mathjaxï¼‰ äºŒçº§æ ‡é¢˜1. æ–‡æœ¬æ ¼å¼æ™®é€šæ–‡å­—åŠ ç²—æ–‡å­—æ–œä½“æ–‡å­—~åˆ é™¤çº¿æ–‡å­—~~é«˜äº®æ–‡å­—ï¼ˆéƒ¨åˆ†ä¸»é¢˜æ”¯æŒï¼‰ è¿™æ˜¯ä¸€ä¸ªå¼•ç”¨åŒºå—ï¼Œå¯ä»¥ç”¨äºå¼ºè°ƒä¸€å¥è¯ã€‚ 2. æ— åºä¸æœ‰åºåˆ—è¡¨æ— åºåˆ—è¡¨ è‹¹æœ ğŸ é¦™è•‰ ğŸŒ è¥¿ç“œ ğŸ‰ æœ‰åºåˆ—è¡¨ ç¬¬ä¸€é¡¹ ç¬¬äºŒé¡¹ ç¬¬ä¸‰é¡¹ 3. ä»£ç å—ä¸è¯­æ³•é«˜äº®è¡Œå†…ä»£ç åœ¨è¡Œå†…å¯ä»¥ä½¿ç”¨åå¼•å·ï¼šprintf(Hello World); å¤šè¡Œä»£ç #include iostreamusing namespace std;int main() cout Hello Hexo Markdown! endl; return 0; 4. è¡¨æ ¼ å§“å å¹´é¾„ çˆ±å¥½ å°æ˜ 18 ç¯®çƒ å°çº¢ 20 é˜…è¯» å°åˆš 22 ç¼–ç¨‹ 5. é“¾æ¥ä¸å›¾ç‰‡è®¿é—® Hexo å®˜ç½‘ 6. æ•°å­¦å…¬å¼è¡Œå†…å…¬å¼è¿™æ˜¯è¡Œå†…å…¬å¼ï¼š$E mc^2$ã€‚ ç‹¬ç«‹å…¬å¼ï¼ˆå—çº§å…¬å¼ï¼‰$$\\int_{0}^{\\infty} e^{-x^2} dx \\frac{\\sqrt{\\pi}}{2}$$ $$a^2 + b^2 c^2$$ âš ï¸ æ³¨æ„ï¼šè¦æ˜¾ç¤ºæ•°å­¦å…¬å¼ï¼Œä½ éœ€è¦å¯ç”¨ MathJax æˆ– KaTeXã€‚ä¾‹å¦‚åœ¨ _config.ymlï¼ˆæˆ–ä¸»é¢˜é…ç½®ï¼‰ä¸­å¼€å¯ï¼š math: enable: true engine: mathjax 7. å¼•ç”¨ä¸æç¤ºæ¡†ï¼ˆéƒ¨åˆ†ä¸»é¢˜æ”¯æŒï¼‰ ğŸ’¡ æç¤ºï¼šHexo å¯ä»¥ç”¨æ¥å†™æŠ€æœ¯ç¬”è®°ã€æ•°å­¦åšå®¢ã€è¯»ä¹¦ç¬”è®°ç­‰ã€‚ âš ï¸ è­¦å‘Šï¼šç”Ÿæˆé™æ€æ–‡ä»¶åè®°å¾—æ‰§è¡Œ hexo clean hexo gã€‚ 8. åˆ†éš”çº¿ä¸è„šæ³¨ è¿™æ˜¯ä¸€ä¸ªè„šæ³¨ç¤ºä¾‹^1ã€‚ 9. åµŒå…¥ HTMLï¼ˆéƒ¨åˆ†ä¸»é¢˜æ”¯æŒï¼‰ è¿™æ˜¯åµŒå…¥çš„ HTML ç¤ºä¾‹ å¯ä»¥ç”¨äºå±…ä¸­å†…å®¹æˆ–è‡ªå®šä¹‰æ ·å¼ âœ… æ€»ç»“è¿™ç¯‡æ–‡ç« å±•ç¤ºäº†ä»¥ä¸‹å†…å®¹ï¼š åŠŸèƒ½ æ˜¯å¦æµ‹è¯• æ–‡æœ¬æ ¼å¼ âœ… åˆ—è¡¨ âœ… ä»£ç é«˜äº® âœ… å›¾ç‰‡ä¸é“¾æ¥ âœ… è¡¨æ ¼ âœ… æ•°å­¦å…¬å¼ âœ… HTML âœ… æ­å–œ ğŸ‰å¦‚æœä½ çš„é¡µé¢æ¸²æŸ“æ­£ç¡®ï¼Œè¯´æ˜ Hexo çš„ Markdown è§£æå™¨é…ç½®æ˜¯æ­£å¸¸çš„ï¼"},{"title":"about","path":"/about/index.html","content":"ğŸ‘‹ å…³äºæˆ‘æˆ‘æ˜¯çº¢çŸ³, Redstone6835, ä¸€ä¸ªæå…¶æ™®é€šçš„å¤§å­¦ç”Ÿã€‚ ğŸ›  æŠ€æœ¯æ ˆ Rust C++ Python STM32 MCU åµŒå…¥å¼å¼€å‘ Linux è™šæ‹ŸåŒ– ESXi æ•°å­¦ ç®—æ³• ç”µç£å­¦ ğŸ“® è”ç³»æ–¹å¼ GitHub: https://github.com/redstone6835 Bilibili: ä¸€æ’®çº¢çŸ³ç²‰ ğŸ”— å‹æƒ…é“¾æ¥ ä»¥ä¸‹æ˜¯æˆ‘çš„æœ‹å‹ä»¬çš„ç½‘ç«™ï¼š QuChenâ€™s blogğŸ‘‰ https://www.cnblogs.com/quchen-blog PositroniumğŸ‘‰ https://blog.feynmach.com/ QcN3epâ€™s blogğŸ‘‰ https://qcn3ep.github.io/ ä¸€èˆ¬è·¯è¿‡çš„æ²ƒå°”ç€çš„BlogğŸ‘‰ https://suzuran28.github.io/"}]